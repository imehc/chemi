import{bi as Bt,S as Pt,B as It,aj as Mt,k as Ut,be as Rt,p as He,as as ut,C as nt,bj as Et,a as ot,ak as Lt,T as Wt,L as ft,P as at,q as zt,X as Vt,G as Nt,f as jt,V as it}from"../../three/build/three.module.js.ZP5wlr6b.js";import{d as $e,t as Xt}from"../../troika-worker-utils/dist/troika-worker-utils.esm.js.Tf5pxf5n.js";import{S as xt}from"../../webgl-sdf-generator/dist/webgl-sdf-generator.mjs.jzOD_gnA.js";import{b as Ht}from"../../bidi-js/dist/bidi.mjs.MDv4KBiL.js";import{c as qt,v as $t}from"../../troika-three-utils/dist/troika-three-utils.esm.js.hIzUVtUy.js";function Yt(p,o,c){const{defaultFontURL:d}=c,t=Object.create(null),e=1/0,a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",r=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function i(h,b){function x(){const S=U=>{console.error(`Failure loading font ${h}${h===d?"":"; trying fallback"}`,U),h!==d&&(h=d,x())};try{const U=new XMLHttpRequest;U.open("get",h,!0),U.responseType="arraybuffer",U.onload=function(){if(U.status>=400)S(new Error(U.statusText));else if(U.status>0)try{const F=p(U.response);b(F)}catch(F){S(F)}},U.onerror=S,U.send()}catch(U){S(U)}}x()}function s(h,b){h||(h=d);let x=t[h];x?x.pending?x.pending.push(b):b(x):(t[h]={pending:[b]},i(h,S=>{let U=t[h].pending;t[h]=S,U.forEach(F=>F(S))}))}function l({text:h="",font:b=d,sdfGlyphSize:x=64,fontSize:S=1,letterSpacing:U=0,lineHeight:F="normal",maxWidth:k=e,direction:A,textAlign:O="left",textIndent:P=0,whiteSpace:m="normal",overflowWrap:C="normal",anchorX:w=0,anchorY:_=0,includeCaretPositions:D=!1,chunkedBoundsSize:I=8192,colorRanges:M=null},W,Y=!1){const G=g(),E={fontLoad:0,typesetting:0};h.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),h=h.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,U=+U,k=+k,F=F||"normal",P=+P,s(b,R=>{const X=isFinite(k);let Q=null,K=null,ae=null,H=null,J=null,V=null,B=null,z=0,fe=0,re=m!=="nowrap";const{ascender:N,descender:ne,unitsPerEm:Ae,lineGap:Je,capHeight:Ee,xHeight:ve}=R;E.fontLoad=g()-G;const Le=g(),q=S/Ae;F==="normal"&&(F=(N-ne+Je)/Ae),F=F*S;const De=(F-(N-ne)*q)/2,ke=-(N*q+De),Se=Math.min(F,(N-ne)*q),Qe=(N+ne)/2*q-Se/2;let Fe=P,se=new v;const de=[se];R.forEachGlyph(h,S,U,(L,le,Ue)=>{const j=h.charAt(Ue),ee=L.advanceWidth*q,ie=se.count;let ue;if("isEmpty"in L||(L.isWhitespace=!!j&&new RegExp(n).test(j),L.canBreakAfter=!!j&&r.test(j),L.isEmpty=L.xMin===L.xMax||L.yMin===L.yMax||a.test(j)),!L.isWhitespace&&!L.isEmpty&&fe++,re&&X&&!L.isWhitespace&&le+ee+Fe>k&&ie){if(se.glyphAt(ie-1).glyphObj.canBreakAfter)ue=new v,Fe=-le;else for(let Ie=ie;Ie--;)if(Ie===0&&C==="break-word"){ue=new v,Fe=-le;break}else if(se.glyphAt(Ie).glyphObj.canBreakAfter){ue=se.splitAt(Ie+1);const ye=ue.glyphAt(0).x;Fe-=ye;for(let Be=ue.count;Be--;)ue.glyphAt(Be).x-=ye;break}ue&&(se.isSoftWrapped=!0,se=ue,de.push(se),z=k)}let Z=se.glyphAt(se.count);Z.glyphObj=L,Z.x=le+Fe,Z.width=ee,Z.charIndex=Ue,j===`
`&&(se=new v,de.push(se),Fe=-(le+ee+U*S)+P)}),de.forEach(L=>{for(let le=L.count;le--;){let{glyphObj:Ue,x:j,width:ee}=L.glyphAt(le);if(!Ue.isWhitespace){L.width=j+ee,L.width>z&&(z=L.width);return}}});let be=0,ge=0;if(w&&(typeof w=="number"?be=-w:typeof w=="string"&&(be=-z*(w==="left"?0:w==="center"?.5:w==="right"?1:f(w)))),_){if(typeof _=="number")ge=-_;else if(typeof _=="string"){let L=de.length*F;ge=_==="top"?0:_==="top-baseline"?-ke:_==="top-cap"?-ke-Ee*q:_==="top-ex"?-ke-ve*q:_==="middle"?L/2:_==="bottom"?L:_==="bottom-baseline"?L-De+ne*q:f(_)*L}}if(!Y){const L=o.getEmbeddingLevels(h,A);Q=new Uint16Array(fe),K=new Float32Array(fe*2),ae={},V=[e,e,-e,-e],B=[];let le=ke;D&&(J=new Float32Array(h.length*3)),M&&(H=new Uint8Array(fe*3));let Ue=0,j=-1,ee=-1,ie,ue;if(de.forEach((Z,Ie)=>{let{count:ye,width:Be}=Z;if(ye>0){let We=0;for(let oe=ye;oe--&&Z.glyphAt(oe).glyphObj.isWhitespace;)We++;let ze=0,Me=0;if(O==="center")ze=(z-Be)/2;else if(O==="right")ze=z-Be;else if(O==="justify"&&Z.isSoftWrapped){let oe=0;for(let te=ye-We;te--;)Z.glyphAt(te).glyphObj.isWhitespace&&oe++;Me=(z-Be)/oe}if(Me||ze){let oe=0;for(let te=0;te<ye;te++){let xe=Z.glyphAt(te);const Te=xe.glyphObj;xe.x+=ze+oe,Me!==0&&Te.isWhitespace&&te<ye-We&&(oe+=Me,xe.width+=Me)}}const lt=o.getReorderSegments(h,L,Z.glyphAt(0).charIndex,Z.glyphAt(Z.count-1).charIndex);for(let oe=0;oe<lt.length;oe++){const[te,xe]=lt[oe];let Te=1/0,$=-1/0;for(let me=0;me<ye;me++)if(Z.glyphAt(me).charIndex>=te){let we=me,ce=me;for(;ce<ye;ce++){let pe=Z.glyphAt(ce);if(pe.charIndex>xe)break;ce<ye-We&&(Te=Math.min(Te,pe.x),$=Math.max($,pe.x+pe.width))}for(let pe=we;pe<ce;pe++){const Ce=Z.glyphAt(pe);Ce.x=$-(Ce.x+Ce.width-Te)}break}}let he;const At=oe=>he=oe;for(let oe=0;oe<ye;oe++){let te=Z.glyphAt(oe);he=te.glyphObj;const xe=he.index,Te=L.levels[te.charIndex]&1;if(Te){const $=o.getMirroredCharacter(h[te.charIndex]);$&&R.forEachGlyph($,0,0,At)}if(D){const{charIndex:$}=te,me=te.x+be,we=te.x+te.width+be;J[$*3]=Te?we:me,J[$*3+1]=Te?me:we,J[$*3+2]=le+Qe+ge;const ce=$-j;ce>1&&y(J,j,ce),j=$}if(M){const{charIndex:$}=te;for(;$>ee;)ee++,M.hasOwnProperty(ee)&&(ue=M[ee])}if(!he.isWhitespace&&!he.isEmpty){const $=Ue++;ae[xe]||(ae[xe]={path:he.path,pathBounds:[he.xMin,he.yMin,he.xMax,he.yMax]});const me=te.x+be,we=le+ge;K[$*2]=me,K[$*2+1]=we;const ce=me+he.xMin*q,pe=we+he.yMin*q,Ce=me+he.xMax*q,Ve=we+he.yMax*q;ce<V[0]&&(V[0]=ce),pe<V[1]&&(V[1]=pe),Ce>V[2]&&(V[2]=Ce),Ve>V[3]&&(V[3]=Ve),$%I===0&&(ie={start:$,end:$,rect:[e,e,-e,-e]},B.push(ie)),ie.end++;const _e=ie.rect;if(ce<_e[0]&&(_e[0]=ce),pe<_e[1]&&(_e[1]=pe),Ce>_e[2]&&(_e[2]=Ce),Ve>_e[3]&&(_e[3]=Ve),Q[$]=xe,M){const Ze=$*3;H[Ze]=ue>>16&255,H[Ze+1]=ue>>8&255,H[Ze+2]=ue&255}}}}le-=F}),J){const Z=h.length-j;Z>1&&y(J,j,Z)}}E.typesetting=g()-Le,W({glyphIds:Q,glyphPositions:K,glyphData:ae,caretPositions:J,caretHeight:Se,glyphColors:H,chunkedBounds:B,fontSize:S,unitsPerEm:Ae,ascender:N*q,descender:ne*q,capHeight:Ee*q,xHeight:ve*q,lineHeight:F,topBaseline:ke,blockBounds:[be,ge-de.length*F,be+z,ge],visibleBounds:V,timings:E})})}function u(h,b){l(h,x=>{const[S,U,F,k]=x.blockBounds;b({width:F-S,height:k-U})},{metricsOnly:!0})}function f(h){let b=h.match(/^([\d.]+)%$/),x=b?parseFloat(b[1]):NaN;return isNaN(x)?0:x/100}function y(h,b,x){const S=h[b*3],U=h[b*3+1],F=h[b*3+2],k=(U-S)/x;for(let A=0;A<x;A++){const O=(b+A)*3;h[O]=S+k*A,h[O+1]=S+k*(A+1),h[O+2]=F}}function g(){return(self.performance||Date).now()}function v(){this.data=[]}const T=["glyphObj","x","width","charIndex"];return v.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/T.length)},glyphAt(h){let b=v.flyweight;return b.data=this.data,b.index=h,b},splitAt(h){let b=new v;return b.data=this.data.splice(h*T.length),b}},v.flyweight=T.reduce((h,b,x,S)=>(Object.defineProperty(h,b,{get(){return this.data[this.index*T.length+x]},set(U){this.data[this.index*T.length+x]=U}}),h),{data:null,index:0}),{typeset:l,measure:u,loadFont:s}}const Oe=()=>(self.performance||Date).now(),Ye=xt();let ht;function Jt(p,o,c,d,t,e,a,n,r,i,s=!0){return s?Zt(p,o,c,d,t,e,a,n,r,i).then(null,l=>(ht||(console.warn("WebGL SDF generation failed, falling back to JS",l),ht=!0),ct(p,o,c,d,t,e,a,n,r,i))):ct(p,o,c,d,t,e,a,n,r,i)}const Xe=[],Qt=5;let rt=0;function Tt(){const p=Oe();for(;Xe.length&&Oe()-p<Qt;)Xe.shift()();rt=Xe.length?setTimeout(Tt,0):0}const Zt=(...p)=>new Promise((o,c)=>{Xe.push(()=>{const d=Oe();try{Ye.webgl.generateIntoCanvas(...p),o({timing:Oe()-d})}catch(t){c(t)}}),rt||(rt=setTimeout(Tt,0))}),Kt=4,er=2e3,dt={};let tr=0;function ct(p,o,c,d,t,e,a,n,r,i){const s="TroikaTextSDFGenerator_JS_"+tr++%Kt;let l=dt[s];return l||(l=dt[s]={workerModule:$e({name:s,workerId:s,dependencies:[xt,Oe],init(u,f){const y=u().javascript.generate;return function(...g){const v=f();return{textureData:y(...g),timing:f()-v}}},getTransferables(u){return[u.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(p,o,c,d,t,e).then(({textureData:u,timing:f})=>{const y=Oe(),g=new Uint8Array(u.length*4);for(let v=0;v<u.length;v++)g[v*4+i]=u[v];return Ye.webglUtils.renderImageData(a,g,n,r,p,o,1<<3-i),f+=Oe()-y,--l.requests===0&&(l.idleTimer=setTimeout(()=>{Xt(s)},er)),{timing:f}})}function rr(p){p._warm||(Ye.webgl.isSupported(p),p._warm=!0)}const nr=Ye.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function or(){return typeof window>"u"&&(self.window=self),function(p){var o={parse:function(t){var e=o._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var n=4;e.readUshort(a,n),n+=2,e.readUshort(a,n),n+=2;var r=e.readUint(a,n);n+=4;for(var i=[],s=0;s<r;s++){var l=e.readUint(a,n);n+=4,i.push(o._readFont(a,l))}return i}return[o._readFont(a,0)]},_readFont:function(t,e){var a=o._bin,n=e;a.readFixed(t,e),e+=4;var r=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:t,_offset:n},l={},u=0;u<r;u++){var f=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var y=a.readUint(t,e);e+=4;var g=a.readUint(t,e);e+=4,l[f]={offset:y,length:g}}for(u=0;u<i.length;u++){var v=i[u];l[v]&&(s[v.trim()]=o[v.trim()].parse(t,l[v].offset,l[v].length,s))}return s},_tabOffset:function(t,e,a){for(var n=o._bin,r=n.readUshort(t,a+4),i=a+12,s=0;s<r;s++){var l=n.readASCII(t,i,4);i+=4,n.readUint(t,i),i+=4;var u=n.readUint(t,i);if(i+=4,n.readUint(t,i),i+=4,l==e)return u}return 0}};o._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return o._bin.readShort(t,e)/16384},readInt:function(t,e){return o._bin._view(t).getInt32(e)},readInt8:function(t,e){return o._bin._view(t).getInt8(e)},readShort:function(t,e){return o._bin._view(t).getInt16(e)},readUshort:function(t,e){return o._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var n=[],r=0;r<a;r++)n.push(o._bin.readUshort(t,e+2*r));return n},readUint:function(t,e){return o._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*o._bin.readUint(t,e)+o._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var n="",r=0;r<a;r++)n+=String.fromCharCode(t[e+r]);return n},readUnicode:function(t,e,a){for(var n="",r=0;r<a;r++){var i=t[e++]<<8|t[e++];n+=String.fromCharCode(i)}return n},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var n=o._bin._tdec;return n&&e==0&&a==t.length?n.decode(t):o._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var n=[],r=0;r<a;r++)n.push(t[e+r]);return n},readASCIIArray:function(t,e,a){for(var n=[],r=0;r<a;r++)n.push(String.fromCharCode(t[e+r]));return n},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},o._lctf={},o._lctf.parse=function(t,e,a,n,r){var i=o._bin,s={},l=e;i.readFixed(t,e),e+=4;var u=i.readUshort(t,e);e+=2;var f=i.readUshort(t,e);e+=2;var y=i.readUshort(t,e);return e+=2,s.scriptList=o._lctf.readScriptList(t,l+u),s.featureList=o._lctf.readFeatureList(t,l+f),s.lookupList=o._lctf.readLookupList(t,l+y,r),s},o._lctf.readLookupList=function(t,e,a){var n=o._bin,r=e,i=[],s=n.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var u=n.readUshort(t,e);e+=2;var f=o._lctf.readLookupTable(t,r+u,a);i.push(f)}return i},o._lctf.readLookupTable=function(t,e,a){var n=o._bin,r=e,i={tabs:[]};i.ltype=n.readUshort(t,e),e+=2,i.flag=n.readUshort(t,e),e+=2;var s=n.readUshort(t,e);e+=2;for(var l=i.ltype,u=0;u<s;u++){var f=n.readUshort(t,e);e+=2;var y=a(t,l,r+f,i);i.tabs.push(y)}return i},o._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},o._lctf.readClassDef=function(t,e){var a=o._bin,n=[],r=a.readUshort(t,e);if(e+=2,r==1){var i=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++)n.push(i+l),n.push(i+l),n.push(a.readUshort(t,e)),e+=2}if(r==2){var u=a.readUshort(t,e);for(e+=2,l=0;l<u;l++)n.push(a.readUshort(t,e)),e+=2,n.push(a.readUshort(t,e)),e+=2,n.push(a.readUshort(t,e)),e+=2}return n},o._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var n=t[a],r=t[a+1];if(t[a+2],n<=e&&e<=r)return a}return-1},o._lctf.readCoverage=function(t,e){var a=o._bin,n={};n.fmt=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);return e+=2,n.fmt==1&&(n.tab=a.readUshorts(t,e,r)),n.fmt==2&&(n.tab=a.readUshorts(t,e,3*r)),n},o._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var n=o._lctf.getInterval(a,e);if(n!=-1)return a[n+2]+(e-a[n])}return-1},o._lctf.readFeatureList=function(t,e){var a=o._bin,n=e,r=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readASCII(t,e,4);e+=4;var u=a.readUshort(t,e);e+=2;var f=o._lctf.readFeatureTable(t,n+u);f.tag=l.trim(),r.push(f)}return r},o._lctf.readFeatureTable=function(t,e){var a=o._bin,n=e,r={},i=a.readUshort(t,e);e+=2,i>0&&(r.featureParams=n+i);var s=a.readUshort(t,e);e+=2,r.tab=[];for(var l=0;l<s;l++)r.tab.push(a.readUshort(t,e+2*l));return r},o._lctf.readScriptList=function(t,e){var a=o._bin,n=e,r={},i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readASCII(t,e,4);e+=4;var u=a.readUshort(t,e);e+=2,r[l.trim()]=o._lctf.readScriptTable(t,n+u)}return r},o._lctf.readScriptTable=function(t,e){var a=o._bin,n=e,r={},i=a.readUshort(t,e);e+=2,r.default=o._lctf.readLangSysTable(t,n+i);var s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var u=a.readASCII(t,e,4);e+=4;var f=a.readUshort(t,e);e+=2,r[u.trim()]=o._lctf.readLangSysTable(t,n+f)}return r},o._lctf.readLangSysTable=function(t,e){var a=o._bin,n={};a.readUshort(t,e),e+=2,n.reqFeature=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);return e+=2,n.features=a.readUshorts(t,e,r),n},o.CFF={},o.CFF.parse=function(t,e,a){var n=o._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var r=[];e=o.CFF.readIndex(t,e,r);for(var i=[],s=0;s<r.length-1;s++)i.push(n.readASCII(t,e+r[s],r[s+1]-r[s]));e+=r[r.length-1];var l=[];e=o.CFF.readIndex(t,e,l);var u=[];for(s=0;s<l.length-1;s++)u.push(o.CFF.readDict(t,e+l[s],e+l[s+1]));e+=l[l.length-1];var f=u[0],y=[];e=o.CFF.readIndex(t,e,y);var g=[];for(s=0;s<y.length-1;s++)g.push(n.readASCII(t,e+y[s],y[s+1]-y[s]));if(e+=y[y.length-1],o.CFF.readSubrs(t,e,f),f.CharStrings){e=f.CharStrings,y=[],e=o.CFF.readIndex(t,e,y);var v=[];for(s=0;s<y.length-1;s++)v.push(n.readBytes(t,e+y[s],y[s+1]-y[s]));f.CharStrings=v}if(f.ROS){e=f.FDArray;var T=[];for(e=o.CFF.readIndex(t,e,T),f.FDArray=[],s=0;s<T.length-1;s++){var h=o.CFF.readDict(t,e+T[s],e+T[s+1]);o.CFF._readFDict(t,h,g),f.FDArray.push(h)}e+=T[T.length-1],e=f.FDSelect,f.FDSelect=[];var b=t[e];if(e++,b!=3)throw b;var x=n.readUshort(t,e);for(e+=2,s=0;s<x+1;s++)f.FDSelect.push(n.readUshort(t,e),t[e+2]),e+=3}return f.Encoding&&(f.Encoding=o.CFF.readEncoding(t,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=o.CFF.readCharset(t,f.charset,f.CharStrings.length)),o.CFF._readFDict(t,f,g),f},o.CFF._readFDict=function(t,e,a){var n;for(var r in e.Private&&(n=e.Private[1],e.Private=o.CFF.readDict(t,n,n+e.Private[0]),e.Private.Subrs&&o.CFF.readSubrs(t,n+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(r)!=-1&&(e[r]=a[e[r]-426+35])},o.CFF.readSubrs=function(t,e,a){var n=o._bin,r=[];e=o.CFF.readIndex(t,e,r);var i,s=r.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var l=0;l<r.length-1;l++)a.Subrs.push(n.readBytes(t,e+r[l],r[l+1]-r[l]))},o.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],o.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},o.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:o.CFF.glyphByUnicode(t,o.CFF.tableSE[e])},o.CFF.readEncoding=function(t,e,a){o._bin;var n=[".notdef"],r=t[e];if(e++,r!=0)throw"error: unknown encoding format: "+r;var i=t[e];e++;for(var s=0;s<i;s++)n.push(t[e+s]);return n},o.CFF.readCharset=function(t,e,a){var n=o._bin,r=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<a;s++){var l=n.readUshort(t,e);e+=2,r.push(l)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;r.length<a;){l=n.readUshort(t,e),e+=2;var u=0;for(i==1?(u=t[e],e++):(u=n.readUshort(t,e),e+=2),s=0;s<=u;s++)r.push(l),l++}}return r},o.CFF.readIndex=function(t,e,a){var n=o._bin,r=n.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<r;s++)a.push(t[e+s]);else if(i==2)for(s=0;s<r;s++)a.push(n.readUshort(t,e+2*s));else if(i==3)for(s=0;s<r;s++)a.push(16777215&n.readUint(t,e+3*s-1));else if(r!=1)throw"unsupported offset size: "+i+", count: "+r;return(e+=r*i)-1},o.CFF.getCharString=function(t,e,a){var n=o._bin,r=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,l=null,u=null;r<=20&&(l=r,s=1),r==12&&(l=100*r+i,s=2),21<=r&&r<=27&&(l=r,s=1),r==28&&(u=n.readShort(t,e+1),s=3),29<=r&&r<=31&&(l=r,s=1),32<=r&&r<=246&&(u=r-139,s=1),247<=r&&r<=250&&(u=256*(r-247)+i+108,s=2),251<=r&&r<=254&&(u=256*-(r-251)-i-108,s=2),r==255&&(u=n.readInt(t,e+1)/65535,s=5),a.val=u??"o"+l,a.size=s},o.CFF.readCharString=function(t,e,a){for(var n=e+a,r=o._bin,i=[];e<n;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,f=null,y=null;s<=20&&(f=s,u=1),s==12&&(f=100*s+l,u=2),s!=19&&s!=20||(f=s,u=2),21<=s&&s<=27&&(f=s,u=1),s==28&&(y=r.readShort(t,e+1),u=3),29<=s&&s<=31&&(f=s,u=1),32<=s&&s<=246&&(y=s-139,u=1),247<=s&&s<=250&&(y=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(y=256*-(s-251)-l-108,u=2),s==255&&(y=r.readInt(t,e+1)/65535,u=5),i.push(y??"o"+f),e+=u}return i},o.CFF.readDict=function(t,e,a){for(var n=o._bin,r={},i=[];e<a;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,f=null,y=null;if(s==28&&(y=n.readShort(t,e+1),u=3),s==29&&(y=n.readInt(t,e+1),u=5),32<=s&&s<=246&&(y=s-139,u=1),247<=s&&s<=250&&(y=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(y=256*-(s-251)-l-108,u=2),s==255)throw y=n.readInt(t,e+1)/65535,u=5,"unknown number";if(s==30){var g=[];for(u=1;;){var v=t[e+u];u++;var T=v>>4,h=15&v;if(T!=15&&g.push(T),h!=15&&g.push(h),h==15)break}for(var b="",x=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<g.length;S++)b+=x[g[S]];y=parseFloat(b)}s<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,s==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),f!=null?(r[f]=i.length==1?i[0]:i,i=[]):i.push(y),e+=u}return r},o.cmap={},o.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var n=o._bin,r={};n.readUshort(t,e),e+=2;var i=n.readUshort(t,e);e+=2;var s=[];r.tables=[];for(var l=0;l<i;l++){var u=n.readUshort(t,e);e+=2;var f=n.readUshort(t,e);e+=2;var y=n.readUint(t,e);e+=4;var g="p"+u+"e"+f,v=s.indexOf(y);if(v==-1){var T;v=r.tables.length,s.push(y);var h=n.readUshort(t,y);h==0?T=o.cmap.parse0(t,y):h==4?T=o.cmap.parse4(t,y):h==6?T=o.cmap.parse6(t,y):h==12?T=o.cmap.parse12(t,y):console.debug("unknown format: "+h,u,f,y),r.tables.push(T)}if(r[g]!=null)throw"multiple tables for one platform+encoding";r[g]=v}return r},o.cmap.parse0=function(t,e){var a=o._bin,n={};n.format=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,n.map=[];for(var i=0;i<r-6;i++)n.map.push(t[e+i]);return n},o.cmap.parse4=function(t,e){var a=o._bin,n=e,r={};r.format=a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var l=s/2;r.searchRange=a.readUshort(t,e),e+=2,r.entrySelector=a.readUshort(t,e),e+=2,r.rangeShift=a.readUshort(t,e),e+=2,r.endCount=a.readUshorts(t,e,l),e+=2*l,e+=2,r.startCount=a.readUshorts(t,e,l),e+=2*l,r.idDelta=[];for(var u=0;u<l;u++)r.idDelta.push(a.readShort(t,e)),e+=2;for(r.idRangeOffset=a.readUshorts(t,e,l),e+=2*l,r.glyphIdArray=[];e<n+i;)r.glyphIdArray.push(a.readUshort(t,e)),e+=2;return r},o.cmap.parse6=function(t,e){var a=o._bin,n={};n.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,n.firstCode=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);e+=2,n.glyphIdArray=[];for(var i=0;i<r;i++)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},o.cmap.parse12=function(t,e){var a=o._bin,n={};n.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var r=a.readUint(t,e);e+=4,n.groups=[];for(var i=0;i<r;i++){var s=e+12*i,l=a.readUint(t,s+0),u=a.readUint(t,s+4),f=a.readUint(t,s+8);n.groups.push([l,u,f])}return n},o.glyf={},o.glyf.parse=function(t,e,a,n){for(var r=[],i=0;i<n.maxp.numGlyphs;i++)r.push(null);return r},o.glyf._parseGlyf=function(t,e){var a=o._bin,n=t._data,r=o._tabOffset(n,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=a.readShort(n,r),r+=2,i.xMin=a.readShort(n,r),r+=2,i.yMin=a.readShort(n,r),r+=2,i.xMax=a.readShort(n,r),r+=2,i.yMax=a.readShort(n,r),r+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(n,r)),r+=2;var l=a.readUshort(n,r);if(r+=2,n.length-r<l)return null;i.instructions=a.readBytes(n,r,l),r+=l;var u=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<u;s++){var f=n[r];if(r++,i.flags.push(f),(8&f)!=0){var y=n[r];r++;for(var g=0;g<y;g++)i.flags.push(f),s++}}for(i.xs=[],s=0;s<u;s++){var v=(2&i.flags[s])!=0,T=(16&i.flags[s])!=0;v?(i.xs.push(T?n[r]:-n[r]),r++):T?i.xs.push(0):(i.xs.push(a.readShort(n,r)),r+=2)}for(i.ys=[],s=0;s<u;s++)v=(4&i.flags[s])!=0,T=(32&i.flags[s])!=0,v?(i.ys.push(T?n[r]:-n[r]),r++):T?i.ys.push(0):(i.ys.push(a.readShort(n,r)),r+=2);var h=0,b=0;for(s=0;s<u;s++)h+=i.xs[s],b+=i.ys[s],i.xs[s]=h,i.ys[s]=b}else{var x;i.parts=[];do{x=a.readUshort(n,r),r+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(S),S.glyphIndex=a.readUshort(n,r),r+=2,1&x){var U=a.readShort(n,r);r+=2;var F=a.readShort(n,r);r+=2}else U=a.readInt8(n,r),r++,F=a.readInt8(n,r),r++;2&x?(S.m.tx=U,S.m.ty=F):(S.p1=U,S.p2=F),8&x?(S.m.a=S.m.d=a.readF2dot14(n,r),r+=2):64&x?(S.m.a=a.readF2dot14(n,r),r+=2,S.m.d=a.readF2dot14(n,r),r+=2):128&x&&(S.m.a=a.readF2dot14(n,r),r+=2,S.m.b=a.readF2dot14(n,r),r+=2,S.m.c=a.readF2dot14(n,r),r+=2,S.m.d=a.readF2dot14(n,r),r+=2)}while(32&x);if(256&x){var k=a.readUshort(n,r);for(r+=2,i.instr=[],s=0;s<k;s++)i.instr.push(n[r]),r++}}return i},o.GPOS={},o.GPOS.parse=function(t,e,a,n){return o._lctf.parse(t,e,a,n,o.GPOS.subt)},o.GPOS.subt=function(t,e,a,n){var r=o._bin,i=a,s={};if(s.fmt=r.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var l=r.readUshort(t,a);a+=2,s.coverage=o._lctf.readCoverage(t,l+i)}if(e==1&&s.fmt==1){var u=r.readUshort(t,a);a+=2;var f=o._lctf.numOfOnes(u);u!=0&&(s.pos=o.GPOS.readValueRecord(t,a,u))}else if(e==2&&s.fmt>=1&&s.fmt<=2){u=r.readUshort(t,a),a+=2;var y=r.readUshort(t,a);a+=2,f=o._lctf.numOfOnes(u);var g=o._lctf.numOfOnes(y);if(s.fmt==1){s.pairsets=[];var v=r.readUshort(t,a);a+=2;for(var T=0;T<v;T++){var h=i+r.readUshort(t,a);a+=2;var b=r.readUshort(t,h);h+=2;for(var x=[],S=0;S<b;S++){var U=r.readUshort(t,h);h+=2,u!=0&&(m=o.GPOS.readValueRecord(t,h,u),h+=2*f),y!=0&&(C=o.GPOS.readValueRecord(t,h,y),h+=2*g),x.push({gid2:U,val1:m,val2:C})}s.pairsets.push(x)}}if(s.fmt==2){var F=r.readUshort(t,a);a+=2;var k=r.readUshort(t,a);a+=2;var A=r.readUshort(t,a);a+=2;var O=r.readUshort(t,a);for(a+=2,s.classDef1=o._lctf.readClassDef(t,i+F),s.classDef2=o._lctf.readClassDef(t,i+k),s.matrix=[],T=0;T<A;T++){var P=[];for(S=0;S<O;S++){var m=null,C=null;u!=0&&(m=o.GPOS.readValueRecord(t,a,u),a+=2*f),y!=0&&(C=o.GPOS.readValueRecord(t,a,y),a+=2*g),P.push({val1:m,val2:C})}s.matrix.push(P)}}}else{if(e==9&&s.fmt==1){var w=r.readUshort(t,a);a+=2;var _=r.readUint(t,a);if(a+=4,n.ltype==9)n.ltype=w;else if(n.ltype!=w)throw"invalid extension substitution";return o.GPOS.subt(t,n.ltype,i+_)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},o.GPOS.readValueRecord=function(t,e,a){var n=o._bin,r=[];return r.push(1&a?n.readShort(t,e):0),e+=1&a?2:0,r.push(2&a?n.readShort(t,e):0),e+=2&a?2:0,r.push(4&a?n.readShort(t,e):0),e+=4&a?2:0,r.push(8&a?n.readShort(t,e):0),e+=8&a?2:0,r},o.GSUB={},o.GSUB.parse=function(t,e,a,n){return o._lctf.parse(t,e,a,n,o.GSUB.subt)},o.GSUB.subt=function(t,e,a,n){var r=o._bin,i=a,s={};if(s.fmt=r.readUshort(t,a),a+=2,e!=1&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var l=r.readUshort(t,a);a+=2,s.coverage=o._lctf.readCoverage(t,i+l)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=r.readShort(t,a),a+=2;else if(s.fmt==2){var u=r.readUshort(t,a);a+=2,s.newg=r.readUshorts(t,a,u),a+=2*s.newg.length}}else if(e==4){s.vals=[],u=r.readUshort(t,a),a+=2;for(var f=0;f<u;f++){var y=r.readUshort(t,a);a+=2,s.vals.push(o.GSUB.readLigatureSet(t,i+y))}}else if(e==5&&s.fmt==2){if(s.fmt==2){var g=r.readUshort(t,a);a+=2,s.cDef=o._lctf.readClassDef(t,i+g),s.scset=[];var v=r.readUshort(t,a);for(a+=2,f=0;f<v;f++){var T=r.readUshort(t,a);a+=2,s.scset.push(T==0?null:o.GSUB.readSubClassSet(t,i+T))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(f=0;f<3;f++){u=r.readUshort(t,a),a+=2;for(var h=[],b=0;b<u;b++)h.push(o._lctf.readCoverage(t,i+r.readUshort(t,a+2*b)));a+=2*u,f==0&&(s.backCvg=h),f==1&&(s.inptCvg=h),f==2&&(s.ahedCvg=h)}u=r.readUshort(t,a),a+=2,s.lookupRec=o.GSUB.readSubstLookupRecords(t,a,u)}}else{if(e==7&&s.fmt==1){var x=r.readUshort(t,a);a+=2;var S=r.readUint(t,a);if(a+=4,n.ltype==9)n.ltype=x;else if(n.ltype!=x)throw"invalid extension substitution";return o.GSUB.subt(t,n.ltype,i+S)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},o.GSUB.readSubClassSet=function(t,e){var a=o._bin.readUshort,n=e,r=[],i=a(t,e);e+=2;for(var s=0;s<i;s++){var l=a(t,e);e+=2,r.push(o.GSUB.readSubClassRule(t,n+l))}return r},o.GSUB.readSubClassRule=function(t,e){var a=o._bin.readUshort,n={},r=a(t,e),i=a(t,e+=2);e+=2,n.input=[];for(var s=0;s<r-1;s++)n.input.push(a(t,e)),e+=2;return n.substLookupRecords=o.GSUB.readSubstLookupRecords(t,e,i),n},o.GSUB.readSubstLookupRecords=function(t,e,a){for(var n=o._bin.readUshort,r=[],i=0;i<a;i++)r.push(n(t,e),n(t,e+2)),e+=4;return r},o.GSUB.readChainSubClassSet=function(t,e){var a=o._bin,n=e,r=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readUshort(t,e);e+=2,r.push(o.GSUB.readChainSubClassRule(t,n+l))}return r},o.GSUB.readChainSubClassRule=function(t,e){for(var a=o._bin,n={},r=["backtrack","input","lookahead"],i=0;i<r.length;i++){var s=a.readUshort(t,e);e+=2,i==1&&s--,n[r[i]]=a.readUshorts(t,e,s),e+=2*n[r[i]].length}return s=a.readUshort(t,e),e+=2,n.subst=a.readUshorts(t,e,2*s),e+=2*n.subst.length,n},o.GSUB.readLigatureSet=function(t,e){var a=o._bin,n=e,r=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readUshort(t,e);e+=2,r.push(o.GSUB.readLigature(t,n+l))}return r},o.GSUB.readLigature=function(t,e){var a=o._bin,n={chain:[]};n.nglyph=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);e+=2;for(var i=0;i<r-1;i++)n.chain.push(a.readUshort(t,e)),e+=2;return n},o.head={},o.head.parse=function(t,e,a){var n=o._bin,r={};return n.readFixed(t,e),e+=4,r.fontRevision=n.readFixed(t,e),e+=4,n.readUint(t,e),e+=4,n.readUint(t,e),e+=4,r.flags=n.readUshort(t,e),e+=2,r.unitsPerEm=n.readUshort(t,e),e+=2,r.created=n.readUint64(t,e),e+=8,r.modified=n.readUint64(t,e),e+=8,r.xMin=n.readShort(t,e),e+=2,r.yMin=n.readShort(t,e),e+=2,r.xMax=n.readShort(t,e),e+=2,r.yMax=n.readShort(t,e),e+=2,r.macStyle=n.readUshort(t,e),e+=2,r.lowestRecPPEM=n.readUshort(t,e),e+=2,r.fontDirectionHint=n.readShort(t,e),e+=2,r.indexToLocFormat=n.readShort(t,e),e+=2,r.glyphDataFormat=n.readShort(t,e),e+=2,r},o.hhea={},o.hhea.parse=function(t,e,a){var n=o._bin,r={};return n.readFixed(t,e),e+=4,r.ascender=n.readShort(t,e),e+=2,r.descender=n.readShort(t,e),e+=2,r.lineGap=n.readShort(t,e),e+=2,r.advanceWidthMax=n.readUshort(t,e),e+=2,r.minLeftSideBearing=n.readShort(t,e),e+=2,r.minRightSideBearing=n.readShort(t,e),e+=2,r.xMaxExtent=n.readShort(t,e),e+=2,r.caretSlopeRise=n.readShort(t,e),e+=2,r.caretSlopeRun=n.readShort(t,e),e+=2,r.caretOffset=n.readShort(t,e),e+=2,e+=8,r.metricDataFormat=n.readShort(t,e),e+=2,r.numberOfHMetrics=n.readUshort(t,e),e+=2,r},o.hmtx={},o.hmtx.parse=function(t,e,a,n){for(var r=o._bin,i={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<n.maxp.numGlyphs;u++)u<n.hhea.numberOfHMetrics&&(s=r.readUshort(t,e),e+=2,l=r.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(l);return i},o.kern={},o.kern.parse=function(t,e,a,n){var r=o._bin,i=r.readUshort(t,e);if(e+=2,i==1)return o.kern.parseV1(t,e-2,a,n);var s=r.readUshort(t,e);e+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){e+=2,a=r.readUshort(t,e),e+=2;var f=r.readUshort(t,e);e+=2;var y=f>>>8;if((y&=15)!=0)throw"unknown kern table format: "+y;e=o.kern.readFormat0(t,e,l)}return l},o.kern.parseV1=function(t,e,a,n){var r=o._bin;r.readFixed(t,e),e+=4;var i=r.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},l=0;l<i;l++){r.readUint(t,e),e+=4;var u=r.readUshort(t,e);e+=2,r.readUshort(t,e),e+=2;var f=u>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;e=o.kern.readFormat0(t,e,s)}return s},o.kern.readFormat0=function(t,e,a){var n=o._bin,r=-1,i=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var l=n.readUshort(t,e);e+=2;var u=n.readUshort(t,e);e+=2;var f=n.readShort(t,e);e+=2,l!=r&&(a.glyph1.push(l),a.rval.push({glyph2:[],vals:[]}));var y=a.rval[a.rval.length-1];y.glyph2.push(u),y.vals.push(f),r=l}return e},o.loca={},o.loca.parse=function(t,e,a,n){var r=o._bin,i=[],s=n.head.indexToLocFormat,l=n.maxp.numGlyphs+1;if(s==0)for(var u=0;u<l;u++)i.push(r.readUshort(t,e+(u<<1))<<1);if(s==1)for(u=0;u<l;u++)i.push(r.readUint(t,e+(u<<2)));return i},o.maxp={},o.maxp.parse=function(t,e,a){var n=o._bin,r={},i=n.readUint(t,e);return e+=4,r.numGlyphs=n.readUshort(t,e),e+=2,i==65536&&(r.maxPoints=n.readUshort(t,e),e+=2,r.maxContours=n.readUshort(t,e),e+=2,r.maxCompositePoints=n.readUshort(t,e),e+=2,r.maxCompositeContours=n.readUshort(t,e),e+=2,r.maxZones=n.readUshort(t,e),e+=2,r.maxTwilightPoints=n.readUshort(t,e),e+=2,r.maxStorage=n.readUshort(t,e),e+=2,r.maxFunctionDefs=n.readUshort(t,e),e+=2,r.maxInstructionDefs=n.readUshort(t,e),e+=2,r.maxStackElements=n.readUshort(t,e),e+=2,r.maxSizeOfInstructions=n.readUshort(t,e),e+=2,r.maxComponentElements=n.readUshort(t,e),e+=2,r.maxComponentDepth=n.readUshort(t,e),e+=2),r},o.name={},o.name.parse=function(t,e,a){var n=o._bin,r={};n.readUshort(t,e),e+=2;var i=n.readUshort(t,e);e+=2,n.readUshort(t,e);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=e+=2,f=0;f<i;f++){var y=n.readUshort(t,e);e+=2;var g=n.readUshort(t,e);e+=2;var v=n.readUshort(t,e);e+=2;var T=n.readUshort(t,e);e+=2;var h=n.readUshort(t,e);e+=2;var b=n.readUshort(t,e);e+=2;var x,S=l[T],U=u+12*i+b;if(y==0)x=n.readUnicode(t,U,h/2);else if(y==3&&g==0)x=n.readUnicode(t,U,h/2);else if(g==0)x=n.readASCII(t,U,h);else if(g==1)x=n.readUnicode(t,U,h/2);else if(g==3)x=n.readUnicode(t,U,h/2);else{if(y!=1)throw"unknown encoding "+g+", platformID: "+y;x=n.readASCII(t,U,h),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var F="p"+y+","+v.toString(16);r[F]==null&&(r[F]={}),r[F][S!==void 0?S:T]=x,r[F]._lang=v}for(var k in r)if(r[k].postScriptName!=null&&r[k]._lang==1033)return r[k];for(var k in r)if(r[k].postScriptName!=null&&r[k]._lang==0)return r[k];for(var k in r)if(r[k].postScriptName!=null&&r[k]._lang==3084)return r[k];for(var k in r)if(r[k].postScriptName!=null)return r[k];for(var k in r){s=k;break}return console.debug("returning name table with languageID "+r[s]._lang),r[s]},o["OS/2"]={},o["OS/2"].parse=function(t,e,a){var n=o._bin.readUshort(t,e);e+=2;var r={};if(n==0)o["OS/2"].version0(t,e,r);else if(n==1)o["OS/2"].version1(t,e,r);else if(n==2||n==3||n==4)o["OS/2"].version2(t,e,r);else{if(n!=5)throw"unknown OS/2 table version: "+n;o["OS/2"].version5(t,e,r)}return r},o["OS/2"].version0=function(t,e,a){var n=o._bin;return a.xAvgCharWidth=n.readShort(t,e),e+=2,a.usWeightClass=n.readUshort(t,e),e+=2,a.usWidthClass=n.readUshort(t,e),e+=2,a.fsType=n.readUshort(t,e),e+=2,a.ySubscriptXSize=n.readShort(t,e),e+=2,a.ySubscriptYSize=n.readShort(t,e),e+=2,a.ySubscriptXOffset=n.readShort(t,e),e+=2,a.ySubscriptYOffset=n.readShort(t,e),e+=2,a.ySuperscriptXSize=n.readShort(t,e),e+=2,a.ySuperscriptYSize=n.readShort(t,e),e+=2,a.ySuperscriptXOffset=n.readShort(t,e),e+=2,a.ySuperscriptYOffset=n.readShort(t,e),e+=2,a.yStrikeoutSize=n.readShort(t,e),e+=2,a.yStrikeoutPosition=n.readShort(t,e),e+=2,a.sFamilyClass=n.readShort(t,e),e+=2,a.panose=n.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=n.readUint(t,e),e+=4,a.ulUnicodeRange2=n.readUint(t,e),e+=4,a.ulUnicodeRange3=n.readUint(t,e),e+=4,a.ulUnicodeRange4=n.readUint(t,e),e+=4,a.achVendID=[n.readInt8(t,e),n.readInt8(t,e+1),n.readInt8(t,e+2),n.readInt8(t,e+3)],e+=4,a.fsSelection=n.readUshort(t,e),e+=2,a.usFirstCharIndex=n.readUshort(t,e),e+=2,a.usLastCharIndex=n.readUshort(t,e),e+=2,a.sTypoAscender=n.readShort(t,e),e+=2,a.sTypoDescender=n.readShort(t,e),e+=2,a.sTypoLineGap=n.readShort(t,e),e+=2,a.usWinAscent=n.readUshort(t,e),e+=2,a.usWinDescent=n.readUshort(t,e),e+=2},o["OS/2"].version1=function(t,e,a){var n=o._bin;return e=o["OS/2"].version0(t,e,a),a.ulCodePageRange1=n.readUint(t,e),e+=4,a.ulCodePageRange2=n.readUint(t,e),e+=4},o["OS/2"].version2=function(t,e,a){var n=o._bin;return e=o["OS/2"].version1(t,e,a),a.sxHeight=n.readShort(t,e),e+=2,a.sCapHeight=n.readShort(t,e),e+=2,a.usDefault=n.readUshort(t,e),e+=2,a.usBreak=n.readUshort(t,e),e+=2,a.usMaxContext=n.readUshort(t,e),e+=2},o["OS/2"].version5=function(t,e,a){var n=o._bin;return e=o["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=n.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=n.readUshort(t,e),e+=2},o.post={},o.post.parse=function(t,e,a){var n=o._bin,r={};return r.version=n.readFixed(t,e),e+=4,r.italicAngle=n.readFixed(t,e),e+=4,r.underlinePosition=n.readShort(t,e),e+=2,r.underlineThickness=n.readShort(t,e),e+=2,r},o==null&&(o={}),o.U==null&&(o.U={}),o.U.codeToGlyph=function(t,e){var a=t.cmap,n=-1;if(a.p0e4!=null?n=a.p0e4:a.p3e1!=null?n=a.p3e1:a.p1e0!=null?n=a.p1e0:a.p0e3!=null&&(n=a.p0e3),n==-1)throw"no familiar platform and encoding!";var r=a.tables[n];if(r.format==0)return e>=r.map.length?0:r.map[e];if(r.format==4){for(var i=-1,s=0;s<r.endCount.length;s++)if(e<=r.endCount[s]){i=s;break}return i==-1||r.startCount[i]>e?0:65535&(r.idRangeOffset[i]!=0?r.glyphIdArray[e-r.startCount[i]+(r.idRangeOffset[i]>>1)-(r.idRangeOffset.length-i)]:e+r.idDelta[i])}if(r.format==12){if(e>r.groups[r.groups.length-1][1])return 0;for(s=0;s<r.groups.length;s++){var l=r.groups[s];if(l[0]<=e&&e<=l[1])return l[2]+(e-l[0])}return 0}throw"unknown cmap table format "+r.format},o.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var n=t.SVG.entries[e];return n==null?a:(typeof n=="string"&&(n=o.SVG.toPath(n),t.SVG.entries[e]=n),n)}if(t.CFF){var r={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var l=0;i.FDSelect[l+2]<=e;)l+=2;s=i.FDArray[i.FDSelect[l+1]].Private}o.U._drawCFF(t.CFF.CharStrings[e],r,i,s,a)}else t.glyf&&o.U._drawGlyf(e,t,a);return a},o.U._drawGlyf=function(t,e,a){var n=e.glyf[t];n==null&&(n=e.glyf[t]=o.glyf._parseGlyf(e,t)),n!=null&&(n.noc>-1?o.U._simpleGlyph(n,a):o.U._compoGlyph(n,e,a))},o.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var n=a==0?0:t.endPts[a-1]+1,r=t.endPts[a],i=n;i<=r;i++){var s=i==n?r:i-1,l=i==r?n:i+1,u=1&t.flags[i],f=1&t.flags[s],y=1&t.flags[l],g=t.xs[i],v=t.ys[i];if(i==n)if(u){if(!f){o.U.P.moveTo(e,g,v);continue}o.U.P.moveTo(e,t.xs[s],t.ys[s])}else f?o.U.P.moveTo(e,t.xs[s],t.ys[s]):o.U.P.moveTo(e,(t.xs[s]+g)/2,(t.ys[s]+v)/2);u?f&&o.U.P.lineTo(e,g,v):y?o.U.P.qcurveTo(e,g,v,t.xs[l],t.ys[l]):o.U.P.qcurveTo(e,g,v,(g+t.xs[l])/2,(v+t.ys[l])/2)}o.U.P.closePath(e)}},o.U._compoGlyph=function(t,e,a){for(var n=0;n<t.parts.length;n++){var r={cmds:[],crds:[]},i=t.parts[n];o.U._drawGlyf(i.glyphIndex,e,r);for(var s=i.m,l=0;l<r.crds.length;l+=2){var u=r.crds[l],f=r.crds[l+1];a.crds.push(u*s.a+f*s.b+s.tx),a.crds.push(u*s.c+f*s.d+s.ty)}for(l=0;l<r.cmds.length;l++)a.cmds.push(r.cmds[l])}},o.U._getGlyphClass=function(t,e){var a=o._lctf.getInterval(e,t);return a==-1?0:e[a+2]},o.U.getPairAdjustment=function(t,e,a){var n=!1;if(t.GPOS)for(var r=t.GPOS,i=r.lookupList,s=r.featureList,l=[],u=0;u<s.length;u++){var f=s[u];if(f.tag=="kern"){n=!0;for(var y=0;y<f.tab.length;y++)if(!l[f.tab[y]]){l[f.tab[y]]=!0;for(var g=i[f.tab[y]],v=0;v<g.tabs.length;v++)if(g.tabs[v]!=null){var T,h=g.tabs[v];if((!h.coverage||(T=o._lctf.coverageIndex(h.coverage,e))!=-1)&&g.ltype!=1){if(g.ltype==2){var b=null;if(h.fmt==1){var x=h.pairsets[T];for(u=0;u<x.length;u++)x[u].gid2==a&&(b=x[u])}else if(h.fmt==2){var S=o.U._getGlyphClass(e,h.classDef1),U=o.U._getGlyphClass(a,h.classDef2);b=h.matrix[S][U]}if(b){var F=0;return b.val1&&b.val1[2]&&(F+=b.val1[2]),b.val2&&b.val2[0]&&(F+=b.val2[0]),F}}}}}}}if(t.kern&&!n){var k=t.kern.glyph1.indexOf(e);if(k!=-1){var A=t.kern.rval[k].glyph2.indexOf(a);if(A!=-1)return t.kern.rval[k].vals[A]}}return 0},o.U._applySubs=function(t,e,a,n){for(var r=t.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,l=a.tabs[i];if(!l.coverage||(s=o._lctf.coverageIndex(l.coverage,t[e]))!=-1){if(a.ltype==1)t[e],l.fmt==1?t[e]=t[e]+l.delta:t[e]=l.newg[s];else if(a.ltype==4)for(var u=l.vals[s],f=0;f<u.length;f++){var y=u[f],g=y.chain.length;if(!(g>r)){for(var v=!0,T=0,h=0;h<g;h++){for(;t[e+T+(1+h)]==-1;)T++;y.chain[h]!=t[e+T+(1+h)]&&(v=!1)}if(v){for(t[e]=y.nglyph,h=0;h<g+T;h++)t[e+h+1]=-1;break}}}else if(a.ltype==5&&l.fmt==2)for(var b=o._lctf.getInterval(l.cDef,t[e]),x=l.cDef[b+2],S=l.scset[x],U=0;U<S.length;U++){var F=S[U],k=F.input;if(!(k.length>r)){for(v=!0,h=0;h<k.length;h++){var A=o._lctf.getInterval(l.cDef,t[e+1+h]);if(b==-1&&l.cDef[A+2]!=k[h]){v=!1;break}}if(v){var O=F.substLookupRecords;for(f=0;f<O.length;f+=2)O[f],O[f+1]}}}else if(a.ltype==6&&l.fmt==3){if(!o.U._glsCovered(t,l.backCvg,e-l.backCvg.length)||!o.U._glsCovered(t,l.inptCvg,e)||!o.U._glsCovered(t,l.ahedCvg,e+l.inptCvg.length))continue;var P=l.lookupRec;for(U=0;U<P.length;U+=2){b=P[U];var m=n[P[U+1]];o.U._applySubs(t,e+b,m,n)}}}}},o.U._glsCovered=function(t,e,a){for(var n=0;n<e.length;n++)if(o._lctf.coverageIndex(e[n],t[a+n])==-1)return!1;return!0},o.U.glyphsToPath=function(t,e,a){for(var n={cmds:[],crds:[]},r=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var l=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,u=o.U.glyphToPath(t,s),f=0;f<u.crds.length;f+=2)n.crds.push(u.crds[f]+r),n.crds.push(u.crds[f+1]);for(a&&n.cmds.push(a),f=0;f<u.cmds.length;f++)n.cmds.push(u.cmds[f]);a&&n.cmds.push("X"),r+=t.hmtx.aWidth[s],i<e.length-1&&(r+=o.U.getPairAdjustment(t,s,l))}}return n},o.U.P={},o.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},o.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},o.U.P.curveTo=function(t,e,a,n,r,i,s){t.cmds.push("C"),t.crds.push(e,a,n,r,i,s)},o.U.P.qcurveTo=function(t,e,a,n,r){t.cmds.push("Q"),t.crds.push(e,a,n,r)},o.U.P.closePath=function(t){t.cmds.push("Z")},o.U._drawCFF=function(t,e,a,n,r){for(var i=e.stack,s=e.nStems,l=e.haveWidth,u=e.width,f=e.open,y=0,g=e.x,v=e.y,T=0,h=0,b=0,x=0,S=0,U=0,F=0,k=0,A=0,O=0,P={val:0,size:0};y<t.length;){o.CFF.getCharString(t,y,P);var m=P.val;if(y+=P.size,m=="o1"||m=="o18")i.length%2!=0&&!l&&(u=i.shift()+n.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(m=="o3"||m=="o23")i.length%2!=0&&!l&&(u=i.shift()+n.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(m=="o4")i.length>1&&!l&&(u=i.shift()+n.nominalWidthX,l=!0),f&&o.U.P.closePath(r),v+=i.pop(),o.U.P.moveTo(r,g,v),f=!0;else if(m=="o5")for(;i.length>0;)g+=i.shift(),v+=i.shift(),o.U.P.lineTo(r,g,v);else if(m=="o6"||m=="o7")for(var C=i.length,w=m=="o6",_=0;_<C;_++){var D=i.shift();w?g+=D:v+=D,w=!w,o.U.P.lineTo(r,g,v)}else if(m=="o8"||m=="o24"){C=i.length;for(var I=0;I+6<=C;)T=g+i.shift(),h=v+i.shift(),b=T+i.shift(),x=h+i.shift(),g=b+i.shift(),v=x+i.shift(),o.U.P.curveTo(r,T,h,b,x,g,v),I+=6;m=="o24"&&(g+=i.shift(),v+=i.shift(),o.U.P.lineTo(r,g,v))}else{if(m=="o11")break;if(m=="o1234"||m=="o1235"||m=="o1236"||m=="o1237")m=="o1234"&&(h=v,b=(T=g+i.shift())+i.shift(),O=x=h+i.shift(),U=x,k=v,g=(F=(S=(A=b+i.shift())+i.shift())+i.shift())+i.shift(),o.U.P.curveTo(r,T,h,b,x,A,O),o.U.P.curveTo(r,S,U,F,k,g,v)),m=="o1235"&&(T=g+i.shift(),h=v+i.shift(),b=T+i.shift(),x=h+i.shift(),A=b+i.shift(),O=x+i.shift(),S=A+i.shift(),U=O+i.shift(),F=S+i.shift(),k=U+i.shift(),g=F+i.shift(),v=k+i.shift(),i.shift(),o.U.P.curveTo(r,T,h,b,x,A,O),o.U.P.curveTo(r,S,U,F,k,g,v)),m=="o1236"&&(T=g+i.shift(),h=v+i.shift(),b=T+i.shift(),O=x=h+i.shift(),U=x,F=(S=(A=b+i.shift())+i.shift())+i.shift(),k=U+i.shift(),g=F+i.shift(),o.U.P.curveTo(r,T,h,b,x,A,O),o.U.P.curveTo(r,S,U,F,k,g,v)),m=="o1237"&&(T=g+i.shift(),h=v+i.shift(),b=T+i.shift(),x=h+i.shift(),A=b+i.shift(),O=x+i.shift(),S=A+i.shift(),U=O+i.shift(),F=S+i.shift(),k=U+i.shift(),Math.abs(F-g)>Math.abs(k-v)?g=F+i.shift():v=k+i.shift(),o.U.P.curveTo(r,T,h,b,x,A,O),o.U.P.curveTo(r,S,U,F,k,g,v));else if(m=="o14"){if(i.length>0&&!l&&(u=i.shift()+a.nominalWidthX,l=!0),i.length==4){var M=i.shift(),W=i.shift(),Y=i.shift(),G=i.shift(),E=o.CFF.glyphBySE(a,Y),R=o.CFF.glyphBySE(a,G);o.U._drawCFF(a.CharStrings[E],e,a,n,r),e.x=M,e.y=W,o.U._drawCFF(a.CharStrings[R],e,a,n,r)}f&&(o.U.P.closePath(r),f=!1)}else if(m=="o19"||m=="o20")i.length%2!=0&&!l&&(u=i.shift()+n.nominalWidthX),s+=i.length>>1,i.length=0,l=!0,y+=s+7>>3;else if(m=="o21")i.length>2&&!l&&(u=i.shift()+n.nominalWidthX,l=!0),v+=i.pop(),g+=i.pop(),f&&o.U.P.closePath(r),o.U.P.moveTo(r,g,v),f=!0;else if(m=="o22")i.length>1&&!l&&(u=i.shift()+n.nominalWidthX,l=!0),g+=i.pop(),f&&o.U.P.closePath(r),o.U.P.moveTo(r,g,v),f=!0;else if(m=="o25"){for(;i.length>6;)g+=i.shift(),v+=i.shift(),o.U.P.lineTo(r,g,v);T=g+i.shift(),h=v+i.shift(),b=T+i.shift(),x=h+i.shift(),g=b+i.shift(),v=x+i.shift(),o.U.P.curveTo(r,T,h,b,x,g,v)}else if(m=="o26")for(i.length%2&&(g+=i.shift());i.length>0;)T=g,h=v+i.shift(),g=b=T+i.shift(),v=(x=h+i.shift())+i.shift(),o.U.P.curveTo(r,T,h,b,x,g,v);else if(m=="o27")for(i.length%2&&(v+=i.shift());i.length>0;)h=v,b=(T=g+i.shift())+i.shift(),x=h+i.shift(),g=b+i.shift(),v=x,o.U.P.curveTo(r,T,h,b,x,g,v);else if(m=="o10"||m=="o29"){var X=m=="o10"?n:a;if(i.length==0)console.debug("error: empty stack");else{var Q=i.pop(),K=X.Subrs[Q+X.Bias];e.x=g,e.y=v,e.nStems=s,e.haveWidth=l,e.width=u,e.open=f,o.U._drawCFF(K,e,a,n,r),g=e.x,v=e.y,s=e.nStems,l=e.haveWidth,u=e.width,f=e.open}}else if(m=="o30"||m=="o31"){var ae=i.length,H=(I=0,m=="o31");for(I+=ae-(C=-3&ae);I<C;)H?(h=v,b=(T=g+i.shift())+i.shift(),v=(x=h+i.shift())+i.shift(),C-I==5?(g=b+i.shift(),I++):g=b,H=!1):(T=g,h=v+i.shift(),b=T+i.shift(),x=h+i.shift(),g=b+i.shift(),C-I==5?(v=x+i.shift(),I++):v=x,H=!0),o.U.P.curveTo(r,T,h,b,x,g,v),I+=4}else{if((m+"").charAt(0)=="o")throw console.debug("Unknown operation: "+m,t),m;i.push(m)}}}e.x=g,e.y=v,e.nStems=s,e.haveWidth=l,e.width=u,e.open=f};var c=o,d={Typr:c};return p.Typr=c,p.default=d,Object.defineProperty(p,"__esModule",{value:!0}),p}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function ar(){return function(p){var o=Uint8Array,c=Uint16Array,d=Uint32Array,t=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=function(m,C){for(var w=new c(31),_=0;_<31;++_)w[_]=C+=1<<m[_-1];var D=new d(w[30]);for(_=1;_<30;++_)for(var I=w[_];I<w[_+1];++I)D[I]=I-w[_]<<5|_;return[w,D]},r=n(t,2),i=r[0],s=r[1];i[28]=258,s[258]=28;for(var l=n(e,0)[0],u=new c(32768),f=0;f<32768;++f){var y=(43690&f)>>>1|(21845&f)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,u[f]=((65280&y)>>>8|(255&y)<<8)>>>1}var g=function(m,C,w){for(var _=m.length,D=0,I=new c(C);D<_;++D)++I[m[D]-1];var M,W=new c(C);for(D=0;D<C;++D)W[D]=W[D-1]+I[D-1]<<1;if(w){M=new c(1<<C);var Y=15-C;for(D=0;D<_;++D)if(m[D])for(var G=D<<4|m[D],E=C-m[D],R=W[m[D]-1]++<<E,X=R|(1<<E)-1;R<=X;++R)M[u[R]>>>Y]=G}else for(M=new c(_),D=0;D<_;++D)m[D]&&(M[D]=u[W[m[D]-1]++]>>>15-m[D]);return M},v=new o(288);for(f=0;f<144;++f)v[f]=8;for(f=144;f<256;++f)v[f]=9;for(f=256;f<280;++f)v[f]=7;for(f=280;f<288;++f)v[f]=8;var T=new o(32);for(f=0;f<32;++f)T[f]=5;var h=g(v,9,1),b=g(T,5,1),x=function(m){for(var C=m[0],w=1;w<m.length;++w)m[w]>C&&(C=m[w]);return C},S=function(m,C,w){var _=C/8|0;return(m[_]|m[_+1]<<8)>>(7&C)&w},U=function(m,C){var w=C/8|0;return(m[w]|m[w+1]<<8|m[w+2]<<16)>>(7&C)},F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(m,C,w){var _=new Error(C||F[m]);if(_.code=m,Error.captureStackTrace&&Error.captureStackTrace(_,k),!w)throw _;return _},A=function(m,C,w){var _=m.length;if(!_||w&&!w.l&&_<5)return C||new o(0);var D=!C||w,I=!w||w.i;w||(w={}),C||(C=new o(3*_));var M,W=function(j){var ee=C.length;if(j>ee){var ie=new o(Math.max(2*ee,j));ie.set(C),C=ie}},Y=w.f||0,G=w.p||0,E=w.b||0,R=w.l,X=w.d,Q=w.m,K=w.n,ae=8*_;do{if(!R){w.f=Y=S(m,G,1);var H=S(m,G+1,3);if(G+=3,!H){var J=m[(ve=((M=G)/8|0)+(7&M&&1)+4)-4]|m[ve-3]<<8,V=ve+J;if(V>_){I&&k(0);break}D&&W(E+J),C.set(m.subarray(ve,V),E),w.b=E+=J,w.p=G=8*V;continue}if(H==1)R=h,X=b,Q=9,K=5;else if(H==2){var B=S(m,G,31)+257,z=S(m,G+10,15)+4,fe=B+S(m,G+5,31)+1;G+=14;for(var re=new o(fe),N=new o(19),ne=0;ne<z;++ne)N[a[ne]]=S(m,G+3*ne,7);G+=3*z;var Ae=x(N),Je=(1<<Ae)-1,Ee=g(N,Ae,1);for(ne=0;ne<fe;){var ve,Le=Ee[S(m,G,Je)];if(G+=15&Le,(ve=Le>>>4)<16)re[ne++]=ve;else{var q=0,De=0;for(ve==16?(De=3+S(m,G,3),G+=2,q=re[ne-1]):ve==17?(De=3+S(m,G,7),G+=3):ve==18&&(De=11+S(m,G,127),G+=7);De--;)re[ne++]=q}}var ke=re.subarray(0,B),Se=re.subarray(B);Q=x(ke),K=x(Se),R=g(ke,Q,1),X=g(Se,K,1)}else k(1);if(G>ae){I&&k(0);break}}D&&W(E+131072);for(var Qe=(1<<Q)-1,Fe=(1<<K)-1,se=G;;se=G){var de=(q=R[U(m,G)&Qe])>>>4;if((G+=15&q)>ae){I&&k(0);break}if(q||k(2),de<256)C[E++]=de;else{if(de==256){se=G,R=null;break}var be=de-254;if(de>264){var ge=t[ne=de-257];be=S(m,G,(1<<ge)-1)+i[ne],G+=ge}var L=X[U(m,G)&Fe],le=L>>>4;if(L||k(3),G+=15&L,Se=l[le],le>3&&(ge=e[le],Se+=U(m,G)&(1<<ge)-1,G+=ge),G>ae){I&&k(0);break}D&&W(E+131072);for(var Ue=E+be;E<Ue;E+=4)C[E]=C[E-Se],C[E+1]=C[E+1-Se],C[E+2]=C[E+2-Se],C[E+3]=C[E+3-Se];E=Ue}}w.l=R,w.p=se,w.b=E,R&&(Y=1,w.m=Q,w.d=X,w.n=K)}while(!Y);return E==C.length?C:function(j,ee,ie){(ee==null||ee<0)&&(ee=0),(ie==null||ie>j.length)&&(ie=j.length);var ue=new(j instanceof c?c:j instanceof d?d:o)(ie-ee);return ue.set(j.subarray(ee,ie)),ue}(C,0,E)},O=new o(0),P=typeof TextDecoder<"u"&&new TextDecoder;try{P.decode(O,{stream:!0})}catch{}return p.convert_streams=function(m){var C=new DataView(m),w=0;function _(){var B=C.getUint16(w);return w+=2,B}function D(){var B=C.getUint32(w);return w+=4,B}function I(B){J.setUint16(V,B),V+=2}function M(B){J.setUint32(V,B),V+=4}for(var W={signature:D(),flavor:D(),length:D(),numTables:_(),reserved:_(),totalSfntSize:D(),majorVersion:_(),minorVersion:_(),metaOffset:D(),metaLength:D(),metaOrigLength:D(),privOffset:D(),privLength:D()},Y=0;Math.pow(2,Y)<=W.numTables;)Y++;Y--;for(var G=16*Math.pow(2,Y),E=16*W.numTables-G,R=12,X=[],Q=0;Q<W.numTables;Q++)X.push({tag:D(),offset:D(),compLength:D(),origLength:D(),origChecksum:D()}),R+=16;var K,ae=new Uint8Array(12+16*X.length+X.reduce(function(B,z){return B+z.origLength+4},0)),H=ae.buffer,J=new DataView(H),V=0;return M(W.flavor),I(W.numTables),I(G),I(Y),I(E),X.forEach(function(B){M(B.tag),M(B.origChecksum),M(R),M(B.origLength),B.outOffset=R,(R+=B.origLength)%4!=0&&(R+=4-R%4)}),X.forEach(function(B){var z,fe=m.slice(B.offset,B.offset+B.compLength);if(B.compLength!=B.origLength){var re=new Uint8Array(B.origLength);z=new Uint8Array(fe,2),A(z,re)}else re=new Uint8Array(fe);ae.set(re,B.outOffset);var N=0;(R=B.outOffset+B.origLength)%4!=0&&(N=4-R%4),ae.set(new Uint8Array(N).buffer,B.outOffset+B.origLength),K=R+N}),H.slice(0,K)},Object.defineProperty(p,"__esModule",{value:!0}),p}({}).convert_streams}function ir(p,o){const c={M:2,L:2,Q:4,C:6,Z:0},d={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,n=8,r=16,i=32;let s;function l(S){if(!s){const U={R:e,L:t,D:a,C:r,U:i,T:n};s=new Map;for(let F in d){let k=0;d[F].split(",").forEach(A=>{let[O,P]=A.split("+");O=parseInt(O,36),P=P?parseInt(P,36):0,s.set(k+=O,U[F]);for(let m=P;m--;)s.set(++k,U[F])})}}return s.get(S)||i}const u=1,f=2,y=3,g=4,v=[null,"isol","init","fina","medi"];function T(S){const U=new Uint8Array(S.length);let F=i,k=u,A=-1;for(let O=0;O<S.length;O++){const P=S.codePointAt(O);let m=l(P)|0,C=u;m&n||(F&(t|a|r)?m&(e|a|r)?(C=y,(k===u||k===y)&&U[A]++):m&(t|i)&&(k===f||k===g)&&U[A]--:F&(e|i)&&(k===f||k===g)&&U[A]--,k=U[O]=C,F=m,A=O,P>65535&&O++)}return U}function h(S,U){const F=[];for(let A=0;A<U.length;A++){const O=U.codePointAt(A);O>65535&&A++,F.push(p.U.codeToGlyph(S,O))}const k=S.GSUB;if(k){const{lookupList:A,featureList:O}=k;let P;const m=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,C=[];O.forEach(w=>{if(m.test(w.tag))for(let _=0;_<w.tab.length;_++){if(C[w.tab[_]])continue;C[w.tab[_]]=!0;const D=A[w.tab[_]],I=/^(isol|init|fina|medi)$/.test(w.tag);I&&!P&&(P=T(U));for(let M=0;M<F.length;M++)(!P||!I||v[P[M]]===w.tag)&&p.U._applySubs(F,M,D,A)}})}return F}function b(...S){for(let U=0;U<S.length;U++)if(typeof S[U]=="number")return S[U]}function x(S){const U=Object.create(null),F=S["OS/2"],k=S.hhea,A=S.head.unitsPerEm,O=b(F&&F.sTypoAscender,k&&k.ascender,A),P={unitsPerEm:A,ascender:O,descender:b(F&&F.sTypoDescender,k&&k.descender,0),capHeight:b(F&&F.sCapHeight,O),xHeight:b(F&&F.sxHeight,O),lineGap:b(F&&F.sTypoLineGap,k&&k.lineGap),forEachGlyph(m,C,w,_){let D=0;const I=1/P.unitsPerEm*C,M=h(S,m);let W=0,Y=-1;return M.forEach((G,E)=>{if(G!==-1){let R=U[G];if(!R){const{cmds:X,crds:Q}=p.U.glyphToPath(S,G);let K="",ae=0;for(let z=0,fe=X.length;z<fe;z++){const re=c[X[z]];K+=X[z];for(let N=1;N<=re;N++)K+=(N>1?",":"")+Q[ae++]}let H,J,V,B;if(Q.length){H=J=1/0,V=B=-1/0;for(let z=0,fe=Q.length;z<fe;z+=2){let re=Q[z],N=Q[z+1];re<H&&(H=re),N<J&&(J=N),re>V&&(V=re),N>B&&(B=N)}}else H=V=J=B=0;R=U[G]={index:G,advanceWidth:S.hmtx.aWidth[G],xMin:H,yMin:J,xMax:V,yMax:B,path:K,pathCommandCount:X.length}}Y!==-1&&(D+=p.U.getPairAdjustment(S,Y,G)*I),_.call(null,R,D,W),R.advanceWidth&&(D+=R.advanceWidth*I),w&&(D+=w*C),Y=G}W+=m.codePointAt(W)>65535?2:1}),D}};return P}return function(U){const F=new Uint8Array(U,0,4),k=p._bin.readASCII(F,0,4);if(k==="wOFF")U=o(U);else if(k==="wOF2")throw new Error("woff2 fonts not supported");return x(p.parse(U)[0])}}const sr=$e({name:"Typr Font Parser",dependencies:[or,ar,ir],init(p,o,c){const d=p(),t=o();return c(d,t)}}),Ge={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},lr=new nt;let kt=!1;function Pe(){return(self.performance||Date).now()}function Br(p){kt?console.warn("configureTextBuilder called after first font request; will be ignored."):Ct(Ge,p)}const qe=Object.create(null);function Ft(p,o){kt=!0,p=Ct({},p);const c=Pe();if(p.font=fr(p.font||Ge.defaultFontURL),p.text=""+p.text,p.sdfGlyphSize=p.sdfGlyphSize||Ge.sdfGlyphSize,p.colorRanges!=null){let l={};for(let u in p.colorRanges)if(p.colorRanges.hasOwnProperty(u)){let f=p.colorRanges[u];typeof f!="number"&&(f=lr.set(f).getHex()),l[u]=f}p.colorRanges=l}Object.freeze(p);const{textureWidth:d,sdfExponent:t}=Ge,{sdfGlyphSize:e}=p,a=d/e*4;let n=qe[e];if(!n){const l=document.createElement("canvas");l.width=d,l.height=e*256/a,n=qe[e]={glyphCount:0,sdfGlyphSize:e,sdfCanvas:l,sdfTexture:new Wt(l,void 0,void 0,void 0,ft,ft),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,ur(n)}const{sdfTexture:r,sdfCanvas:i}=n;let s=n.glyphsByFont.get(p.font);s||n.glyphsByFont.set(p.font,s=new Map),dr(p).then(l=>{const{glyphIds:u,glyphPositions:f,fontSize:y,unitsPerEm:g,timings:v}=l,T=[],h=new Float32Array(u.length*4),b=y/g;let x=0,S=0;const U=Pe();u.forEach((P,m)=>{let C=s.get(P);if(!C){const{path:I,pathBounds:M}=l.glyphData[P],W=Math.max(M[2]-M[0],M[3]-M[1])/e*(Ge.sdfMargin*e+.5),Y=n.glyphCount++,G=[M[0]-W,M[1]-W,M[2]+W,M[3]+W];s.set(P,C={path:I,atlasIndex:Y,sdfViewBox:G}),T.push(C)}const{sdfViewBox:w}=C,_=f[S++],D=f[S++];h[x++]=_+w[0]*b,h[x++]=D+w[1]*b,h[x++]=_+w[2]*b,h[x++]=D+w[3]*b,u[m]=C.atlasIndex}),v.quads=(v.quads||0)+(Pe()-U);const F=Pe();v.sdf={};const k=i.height,A=Math.ceil(n.glyphCount/a),O=Math.pow(2,Math.ceil(Math.log2(A*e)));O>k&&(console.info(`Increasing SDF texture size ${k}->${O}`),nr(i,d,O),r.dispose()),Promise.all(T.map(P=>wt(P,n,p.gpuAccelerateSDF).then(({timing:m})=>{v.sdf[P.atlasIndex]=m}))).then(()=>{T.length&&!n.contextLost&&(_t(n),r.needsUpdate=!0),v.sdfTotal=Pe()-F,v.total=Pe()-c,o(Object.freeze({parameters:p,sdfTexture:r,sdfGlyphSize:e,sdfExponent:t,glyphBounds:h,glyphAtlasIndices:u,glyphColors:l.glyphColors,caretPositions:l.caretPositions,caretHeight:l.caretHeight,chunkedBounds:l.chunkedBounds,ascender:l.ascender,descender:l.descender,lineHeight:l.lineHeight,capHeight:l.capHeight,xHeight:l.xHeight,topBaseline:l.topBaseline,blockBounds:l.blockBounds,visibleBounds:l.visibleBounds,timings:l.timings}))})}),Promise.resolve().then(()=>{n.contextLost||rr(i)})}function wt({path:p,atlasIndex:o,sdfViewBox:c},{sdfGlyphSize:d,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:n,sdfExponent:r}=Ge,i=Math.max(c[2]-c[0],c[3]-c[1]),s=Math.floor(o/4),l=s%(n/d)*d,u=Math.floor(s/(n/d))*d,f=o%4;return Jt(d,d,p,c,i,r,t,l,u,f,a)}function ur(p){const o=p.sdfCanvas;o.addEventListener("webglcontextlost",c=>{console.log("Context Lost",c),c.preventDefault(),p.contextLost=!0}),o.addEventListener("webglcontextrestored",c=>{console.log("Context Restored",c),p.contextLost=!1;const d=[];p.glyphsByFont.forEach(t=>{t.forEach(e=>{d.push(wt(e,p,!0))})}),Promise.all(d).then(()=>{_t(p),p.sdfTexture.needsUpdate=!0})})}function Pr({font:p,characters:o,sdfGlyphSize:c},d){let t=Array.isArray(o)?o.join(`
`):""+o;Ft({font:p,sdfGlyphSize:c,text:t},d)}function Ct(p,o){for(let c in o)o.hasOwnProperty(c)&&(p[c]=o[c]);return p}let Ne;function fr(p){return Ne||(Ne=typeof document>"u"?{}:document.createElement("a")),Ne.href=p,Ne.href}function _t(p){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:o,sdfTexture:c}=p,{width:d,height:t}=o,e=p.sdfCanvas.getContext("webgl");let a=c.image.data;(!a||a.length!==d*t*4)&&(a=new Uint8Array(d*t*4),c.image={width:d,height:t,data:a},c.flipY=!1,c.isDataTexture=!0),e.readPixels(0,0,d,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const hr=$e({name:"Typesetter",dependencies:[Ge,sr,Yt,Ht],init(p,o,c,d){const{defaultFontURL:t}=p;return c(o,d(),{defaultFontURL:t})}}),dr=$e({name:"Typesetter",dependencies:[hr],init(p){return function(o){return new Promise(c=>{p.typeset(o,c)})}},getTransferables(p){const o=[p.glyphPositions.buffer,p.glyphIds.buffer];return p.caretPositions&&o.push(p.caretPositions.buffer),p.glyphColors&&o.push(p.glyphColors.buffer),o}});function Ir(){Object.keys(qe).forEach(p=>{const o=qe[p].sdfCanvas,{width:c,height:d}=o;console.log("%c.",`
      background: url(${o.toDataURL()});
      background-size: ${c}px ${d}px;
      color: transparent;
      font-size: 0;
      line-height: ${d}px;
      padding-left: ${c}px;
    `)})}const pt={};function cr(p){let o=pt[p];if(!o){const c=new at(1,1,p,p),d=c.clone(),t=c.attributes,e=d.attributes,a=new zt,n=t.uv.count;for(let r=0;r<n;r++)e.position.array[r*3]*=-1,e.normal.array[r*3+2]*=-1;["position","normal","uv"].forEach(r=>{a.setAttribute(r,new Vt([...t[r].array,...e[r].array],t[r].itemSize))}),a.setIndex([...c.index.array,...d.index.array.map(r=>r+n)]),a.translate(.5,.5,0),o=pt[p]=a}return o}const pr="aTroikaGlyphBounds",vt="aTroikaGlyphIndex",vr="aTroikaGlyphColor";class gr extends Bt{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Pt,this.boundingBox=new It}computeBoundingSphere(){}computeBoundingBox(){}setSide(o){const c=this.getIndex().count;this.setDrawRange(o===Mt?c/2:0,o===Ut?c:c/2)}set detail(o){if(o!==this._detail){this._detail=o,(typeof o!="number"||o<1)&&(o=1);let c=cr(o);["position","normal","uv"].forEach(d=>{this.attributes[d]=c.attributes[d].clone()}),this.setIndex(c.getIndex().clone())}}get detail(){return this._detail}set curveRadius(o){o!==this._curveRadius&&(this._curveRadius=o,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(o,c,d,t,e){Ke(this,pr,o,4),Ke(this,vt,c,1),Ke(this,vr,e,3),this._blockBounds=d,this._chunkedBounds=t,this.instanceCount=c.length,this._updateBounds()}_updateBounds(){const o=this._blockBounds;if(o){const{curveRadius:c,boundingBox:d}=this;if(c){const{PI:t,floor:e,min:a,max:n,sin:r,cos:i}=Math,s=t/2,l=t*2,u=Math.abs(c),f=o[0]/u,y=o[2]/u,g=e((f+s)/l)!==e((y+s)/l)?-u:a(r(f)*u,r(y)*u),v=e((f-s)/l)!==e((y-s)/l)?u:n(r(f)*u,r(y)*u),T=e((f+t)/l)!==e((y+t)/l)?u*2:n(u-i(f)*u,u-i(y)*u);d.min.set(g,o[1],c<0?-T:0),d.max.set(v,o[3],c<0?0:T)}else d.min.set(o[0],o[1],0),d.max.set(o[2],o[3],0);d.getBoundingSphere(this.boundingSphere)}}applyClipRect(o){let c=this.getAttribute(vt).count,d=this._chunkedBounds;if(d)for(let t=d.length;t--;){c=d[t].end;let e=d[t].rect;if(e[1]<o.w&&e[3]>o.y&&e[0]<o.z&&e[2]>o.x)break}this.instanceCount=c}}function Ke(p,o,c,d){const t=p.getAttribute(o);c?t&&t.array.length===c.length?(t.array.set(c),t.needsUpdate=!0):(p.setAttribute(o,new Rt(c,d)),delete p._maxInstanceCount,p.dispose()):t&&p.deleteAttribute(o)}const yr=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,mr=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Sr=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,br=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Ur(p){const o=qt(p,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new He},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ut(0,0,0,0)},uTroikaClipRect:{value:new ut(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new He},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new nt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Et},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:yr,vertexTransform:mr,fragmentDefs:Sr,fragmentColorTransform:br,customRewriter({vertexShader:c,fragmentShader:d}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(d)&&(d=d.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(c)||(c=c.replace($t,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:c,fragmentShader:d}}});return o.transparent=!0,Object.defineProperties(o,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),o}const st=new Nt({color:16777215,side:Ut,transparent:!0}),gt=8421504,yt=new jt,je=new it,et=new it,Re=[],xr=new it,tt="+x+y";function mt(p){return Array.isArray(p)?p[0]:p}let Dt=()=>{const p=new ot(new at(1,1),st);return Dt=()=>p,p},Gt=()=>{const p=new ot(new at(1,1,32,1),st);return Gt=()=>p,p};const Tr={type:"syncstart"},kr={type:"synccomplete"},Ot=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Fr=Ot.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class wr extends ot{constructor(){const o=new gr;super(o,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=gt,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=tt,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(o){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(o):(this._isSyncing=!0,this.dispatchEvent(Tr),Ft({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},c=>{this._isSyncing=!1,this._textRenderInfo=c,this.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);const d=this._queuedSyncs;d&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{d.forEach(t=>t&&t())})),this.dispatchEvent(kr),o&&o()})))}onBeforeRender(o,c,d,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e),e._hadOwnSide=e.hasOwnProperty("side"),this.geometry.setSide(e._actualSide=e.side),e.side=Lt}onAfterRender(o,c,d,t,e,a){e._hadOwnSide?e.side=e._actualSide:delete e.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let o=this._derivedMaterial;const c=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=st.clone());if((!o||o.baseMaterial!==c)&&(o=this._derivedMaterial=Ur(c),c.addEventListener("dispose",function d(){c.removeEventListener("dispose",d),o.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let d=o._outlineMtl;return d||(d=o._outlineMtl=Object.create(o,{id:{value:o.id+.1}}),d.isTextOutlineMaterial=!0,d.depthWrite=!1,d.map=null,o.addEventListener("dispose",function t(){o.removeEventListener("dispose",t),d.dispose()})),[d,o]}else return o}set material(o){o&&o.isTroikaTextMaterial?(this._derivedMaterial=o,this._baseMaterial=o.baseMaterial):this._baseMaterial=o}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(o){this.geometry.detail=o}get curveRadius(){return this.geometry.curveRadius}set curveRadius(o){this.geometry.curveRadius=o}get customDepthMaterial(){return mt(this.material).getDepthMaterial()}get customDistanceMaterial(){return mt(this.material).getDistanceMaterial()}_prepareForRender(o){const c=o.isTextOutlineMaterial,d=o.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:n,blockBounds:r}=t;d.uTroikaSDFTexture.value=n,d.uTroikaSDFTextureSize.value.set(n.image.width,n.image.height),d.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,d.uTroikaSDFExponent.value=t.sdfExponent,d.uTroikaTotalBounds.value.fromArray(r),d.uTroikaUseGlyphColors.value=!c&&!!t.glyphColors;let i=0,s=0,l=0,u,f,y,g=0,v=0;if(c){let{outlineWidth:h,outlineOffsetX:b,outlineOffsetY:x,outlineBlur:S,outlineOpacity:U}=this;i=this._parsePercent(h)||0,s=Math.max(0,this._parsePercent(S)||0),u=U,g=this._parsePercent(b)||0,v=this._parsePercent(x)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(y=this.strokeColor,d.uTroikaStrokeColor.value.set(y??gt),f=this.strokeOpacity,f==null&&(f=1)),u=this.fillOpacity;d.uTroikaDistanceOffset.value=i,d.uTroikaPositionOffset.value.set(g,v),d.uTroikaBlurRadius.value=s,d.uTroikaStrokeWidth.value=l,d.uTroikaStrokeOpacity.value=f,d.uTroikaFillOpacity.value=u??1,d.uTroikaCurveRadius.value=this.curveRadius||0;let T=this.clipRect;if(T&&Array.isArray(T)&&T.length===4)d.uTroikaClipRect.value.fromArray(T);else{const h=(this.fontSize||.1)*100;d.uTroikaClipRect.value.set(r[0]-h,r[1]-h,r[2]+h,r[3]+h)}this.geometry.applyClipRect(d.uTroikaClipRect.value)}d.uTroikaSDFDebug.value=!!this.debugSDF,o.polygonOffset=!!this.depthOffset,o.polygonOffsetFactor=o.polygonOffsetUnits=this.depthOffset||0;const e=c?this.outlineColor||0:this.color;if(e==null)delete o.color;else{const n=o.hasOwnProperty("color")?o.color:o.color=new nt;(e!==n._input||typeof e=="object")&&n.set(n._input=e)}let a=this.orientation||tt;if(a!==o._orientation){let n=d.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let r=a!==tt&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,i,s,l,u]=r;je.set(0,0,0)[s]=i==="-"?1:-1,et.set(0,0,0)[u]=l==="-"?-1:1,yt.lookAt(xr,je.cross(et),et),n.setFromMatrix4(yt)}else n.identity();o._orientation=a}}_parsePercent(o){if(typeof o=="string"){let c=o.match(/^(-?[\d.]+)%$/),d=c?parseFloat(c[1]):NaN;o=(isNaN(d)?0:d/100)*this.fontSize}return o}localPositionToTextCoords(o,c=new He){c.copy(o);const d=this.curveRadius;return d&&(c.x=Math.atan2(o.x,Math.abs(d)-Math.abs(o.z))*Math.abs(d)),c}worldPositionToTextCoords(o,c=new He){return je.copy(o),this.localPositionToTextCoords(this.worldToLocal(je),c)}raycast(o,c){const{textRenderInfo:d,curveRadius:t}=this;if(d){const e=d.blockBounds,a=t?Gt():Dt(),n=a.geometry,{position:r,uv:i}=n.attributes;for(let s=0;s<i.count;s++){let l=e[0]+i.getX(s)*(e[2]-e[0]);const u=e[1]+i.getY(s)*(e[3]-e[1]);let f=0;t&&(f=t-Math.cos(l/t)*t,l=Math.sin(l/t)*t),r.setXYZ(s,l,u,f)}n.boundingSphere=this.geometry.boundingSphere,n.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Re.length=0,a.raycast(o,Re);for(let s=0;s<Re.length;s++)Re[s].object=this,c.push(Re[s])}}copy(o){const c=this.geometry;return super.copy(o),this.geometry=c,Fr.forEach(d=>{this[d]=o[d]}),this}clone(){return new this.constructor().copy(this)}}Ot.forEach(p=>{const o="_private_"+p;Object.defineProperty(wr.prototype,p,{get(){return this[o]},set(c){c!==this[o]&&(this[o]=c,this._needsSync=!0)}})});function Mr(p,o,c){let d=null;const{caretHeight:t}=p,e=Cr(p);let a=1/0;return e.forEach((n,r)=>{Math.abs(c-(r+t/2))<Math.abs(c-(a+t/2))&&(a=r)}),e.get(a).forEach(n=>{(!d||Math.abs(o-n.x)<Math.abs(o-d.x))&&(d=n)}),d}const St=new WeakMap;function Rr(p,o,c){let d;if(p){let t=St.get(p);if(t&&t.start===o&&t.end===c)return t.rects;const{caretPositions:e,caretHeight:a}=p;if(c<o){const r=o;o=c,c=r}o=Math.max(o,0),c=Math.min(c,e.length+1),d=[];let n=null;for(let r=o;r<c;r++){const i=e[r*3],s=e[r*3+1],l=Math.min(i,s),u=Math.max(i,s),f=e[r*3+2];(!n||f!==n.bottom||l>n.right||u<n.left)&&(n={left:1/0,right:-1/0,bottom:f,top:f+a},d.push(n)),n.left=Math.min(l,n.left),n.right=Math.max(u,n.right)}d.sort((r,i)=>i.bottom-r.bottom||r.left-i.left);for(let r=d.length-1;r-- >0;){const i=d[r],s=d[r+1];i.bottom===s.bottom&&i.left<=s.right&&i.right>=s.left&&(s.left=Math.min(s.left,i.left),s.right=Math.max(s.right,i.right),d.splice(r,1))}St.set(p,{start:o,end:c,rects:d})}return d}const bt=new WeakMap;function Cr(p){let o=bt.get(p);if(!o){const{caretPositions:c,caretHeight:d}=p;o=new Map;for(let t=0;t<c.length;t+=3){const e=c[t+2];let a=o.get(e);a||o.set(e,a=[]),a.push({x:c[t],y:e,height:d,charIndex:t/3}),t+3>=c.length&&a.push({x:c[t+1],y:e,height:d,charIndex:t/3+1})}}return bt.set(p,o),o}export{gr as GlyphsGeometry,wr as Text,Br as configureTextBuilder,Ur as createTextDerivedMaterial,Ir as dumpSDFTextures,Mr as getCaretAtPoint,Rr as getSelectionRects,Pr as preloadFont,hr as typesetterWorkerModule};
//# sourceMappingURL=troika-three-text.esm.js.cZn56uKA.js.map

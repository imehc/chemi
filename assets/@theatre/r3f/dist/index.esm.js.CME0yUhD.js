import{r as i,R as q}from"../../../react/index.js.IuPGg7Py.js";import{ao as M,q as $,V as U,ap as ce,aq as le,ar as ue,as as pe,at as fe}from"../../../three/build/three.module.js.jQmR1wrA.js";import{d as E}from"../../core/dist/index.js.BpLNp_wf.js";import{u as S,a as V}from"../../../@react-three/fiber/dist/index-ba8afaa4.esm.js.CC8UC62r.js";var de=Object.create,N=Object.defineProperty,be=Object.defineProperties,ve=Object.getOwnPropertyDescriptor,he=Object.getOwnPropertyDescriptors,X=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,me=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable,J=(e,r,a)=>r in e?N(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a,c=(e,r)=>{for(var a in r||(r={}))K.call(r,a)&&J(e,a,r[a]);if(T)for(var a of T(r))Q.call(r,a)&&J(e,a,r[a]);return e},d=(e,r)=>be(e,he(r)),k=(e,r)=>{var a={};for(var t in e)K.call(e,t)&&r.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&T)for(var t of T(e))r.indexOf(t)<0&&Q.call(e,t)&&(a[t]=e[t]);return a},ye=(e,r)=>function(){return r||(0,e[X(e)[0]])((r={exports:{}}).exports,r),r.exports},ge=(e,r,a,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of X(r))!K.call(e,o)&&o!==a&&N(e,o,{get:()=>r[o],enumerable:!(t=ve(r,o))||t.enumerable});return e},_e=(e,r,a)=>(a=e!=null?de(me(e)):{},ge(!e||!e.__esModule?N(a,"default",{value:e,enumerable:!0}):a,e)),we=ye({"../../node_modules/zustand/vanilla.js"(e){Object.defineProperty(e,"__esModule",{value:!0});function r(a){var t,o=new Set,b=function(h,y){var u=typeof h=="function"?h(t):h;if(u!==t){var j=t;t=y?u:Object.assign({},t,u),o.forEach(function(_){return _(t,j)})}},f=function(){return t},O=function(h,y,u){y===void 0&&(y=f),u===void 0&&(u=Object.is);var j=y(t);function _(){var R=y(t);if(!u(j,R)){var g=j;h(j=R,g)}}return o.add(_),function(){return o.delete(_)}},l=function(h,y,u){return y||u?O(h,y,u):(o.add(h),function(){return o.delete(h)})},s=function(){return o.clear()},n={setState:b,getState:f,subscribe:l,destroy:s};return t=a(b,f,n),n}e.default=r}}),Oe=_e(we()),F=new WeakSet,je=(e,r)=>({sheet:null,editorObject:null,scene:null,gl:null,helpersRoot:new ce,editables:{},canvasName:"default",sceneSnapshot:null,editablesSnapshot:null,initialEditorCamera:{},init:(a,t)=>{e({scene:a,gl:t}),r().createSnapshot()},addEditable:(a,t)=>{e(o=>({editables:d(c({},o.editables),{[a]:t})}))},removeEditable:a=>{e(t=>{const o=c({},t.editables);return delete o[a],{editables:o}})},createSnapshot:()=>{e(a=>{var t,o;return{sceneSnapshot:(o=(t=a.scene)==null?void 0:t.clone())!=null?o:null,editablesSnapshot:a.editables}})},setSnapshotProxyObject:(a,t)=>{e(o=>({editablesSnapshot:d(c({},o.editablesSnapshot),{[t]:d(c({},o.editablesSnapshot[t]),{proxyObject:a})})}))}}),L=(0,Oe.default)(je),Se=({gl:e,scene:r})=>{const a=L.getState().init;a(r,e)};function I(e){return r=>{e.forEach(a=>{typeof a=="function"?a(r):a!=null&&(a.current=r)})}}function Ee(){return S(({invalidate:e})=>e)}var Z=i.createContext(void 0),Pe=()=>{const e=i.useContext(Z);if(!e)throw new Error("No sheet found. You need to add a <SheetProvider> higher up in the tree. https://docs.theatrejs.com/r3f.html#sheetprovider");return e},xe=()=>Pe().sheet,Ce=({sheet:e,children:r})=>{const{scene:a,gl:t}=S(o=>({scene:o.scene,gl:o.gl}));return i.useEffect(()=>{if(!e||e.type!=="Theatre_Sheet_PublicAPI")throw new Error("sheet in <Wrapper sheet={sheet}> has an invalid value")},[e]),i.useLayoutEffect(()=>{Se({gl:t,scene:a})},[a,t]),q.createElement(Z.Provider,{value:{sheet:e}},r)},Ie=Ce;function ee(e){return typeof e=="number"&&isFinite(e)}function $e(e){return["x","y","z"].every(r=>ee(e[r]))}var H=e=>e?{x:e[0],y:e[1],z:e[2]}:{x:0,y:0,z:0},A=(e,r=H(),{nudgeMultiplier:a=.01}={})=>({parse:t=>{const o=t[e],b=o?Array.isArray(o)?H(o):ee(o)?{x:o,y:o,z:o}:$e(o)?{x:o.x,y:o.y,z:o.z}:(E.notify.warning(`Invalid value for vector prop "${e}"`,`Couldn't make sense of \`${e}={${JSON.stringify(o)}}\`, falling back to \`${e}={${JSON.stringify([r.x,r.y,r.z])}}\`.

To fix this, make sure the prop is set to either a number, an array of numbers, or a three.js Vector3 object.`),r):r;return["x","y","z"].forEach(f=>{t[`${e}-${f}`]&&(b[f]=t[`${e}-${f}`])}),b},apply:(t,o)=>{o[e].set(t.x,t.y,t.z)},type:{[e]:{x:E.types.number(r.x,{nudgeMultiplier:a}),y:E.types.number(r.y,{nudgeMultiplier:a}),z:E.types.number(r.z,{nudgeMultiplier:a})}}}),m=(e,r=0,{nudgeMultiplier:a=.01}={})=>({parse:t=>{var o;return(o=t[e])!=null?o:r},apply:(t,o)=>{o[e]=t},type:{[e]:E.types.number(r,{nudgeMultiplier:a})}}),x=(e,r=new $(0,0,0))=>({parse:a=>{var t;return d(c({},(t=a[e])!=null?t:r),{a:1})},apply:(a,t)=>{t[e].setRGB(a.r,a.g,a.b)},type:{[e]:E.types.rgba(d(c({},r),{a:1}))}}),z=(e,r)=>d(c({},e),{props:c(c({},e.props),r)}),w={props:{position:A("position"),rotation:A("rotation"),scale:A("scale",H([1,1,1]))},useTransformControls:!0,icon:"cube",createHelper:e=>new M(e,C)},Y=d(c({},z(w,{intensity:m("intensity",1),distance:m("distance"),decay:m("decay"),color:x("color",new $("white"))})),{dimensionless:!0}),G=d(c({},z(w,{near:m("near",.1,{nudgeMultiplier:.1}),far:m("far",2e3,{nudgeMultiplier:.1})})),{updateObject:e=>{e.updateProjectionMatrix()},icon:"camera",dimensionless:!0,createHelper:e=>new le(e)}),C="#40AAA4",Le={group:d(c({},w),{icon:"collection",createHelper:e=>new M(e,C)}),mesh:d(c({},w),{icon:"cube",createHelper:e=>new M(e,C)}),spotLight:d(c({},z(Y,{angle:m("angle",0,{nudgeMultiplier:.001}),penumbra:m("penumbra",0,{nudgeMultiplier:.001})})),{icon:"spotLight",createHelper:e=>new ue(e,C)}),directionalLight:d(c({},z(w,{intensity:m("intensity",1),color:x("color",new $("white"))})),{icon:"sun",dimensionless:!0,createHelper:e=>new pe(e,1,C)}),pointLight:d(c({},Y),{icon:"lightBulb",createHelper:e=>new fe(e,1,C)}),ambientLight:{props:{intensity:m("intensity",1),color:x("color",new $("white"))},useTransformControls:!1,icon:"lightBulb"},hemisphereLight:{props:{intensity:m("intensity",1),color:x("color",new $("white")),groundColor:x("groundColor",new $("white"))},useTransformControls:!1,icon:"lightBulb"},perspectiveCamera:z(G,{fov:m("fov",50,{nudgeMultiplier:.1}),zoom:m("zoom",1)}),orthographicCamera:G,points:w,line:w,lineLoop:w,lineSegments:w,fog:{props:{color:x("color"),near:m("near",1,{nudgeMultiplier:.1}),far:m("far",1e3,{nudgeMultiplier:.1})},useTransformControls:!1,icon:"cloud"}},Re=Le;L.getState().createSnapshot;var ze=e=>`${e.sheetId}:${e.sheetInstanceId}:${e.objectKey}`,De=i.createContext(void 0),Te=()=>{var e;return(e=i.useContext(De))==null?void 0:e.rafDriver},Ae=e=>{const r=(t,o)=>{if(t!=="primitive"&&!o)throw new Error("You must provide the type of the component you're creating an editable for. For example: editable(MyComponent, 'mesh').");return i.forwardRef((b,f)=>{var O=b,{theatreKey:l,visible:s,editableType:n,additionalProps:v,objRef:h}=O,y=k(O,["theatreKey","visible","editableType","additionalProps","objRef"]);if(typeof l!="string")throw new Error(`No valid theatreKey was provided to the editable component. theatreKey must be a string. Received: ${l}`);if(t==="primitive"&&!n)throw new Error(`When using the primitive component, you must provide the editableType prop. Received: ${n}`);const u=o??n,j=i.useRef(),_=xe(),R=Te(),[g,re]=i.useState(void 0),D=i.useMemo(()=>ze(d(c({},_.address),{objectKey:l})),[_,l]),ae=Ee();return i.useEffect(()=>{if(t==="perspectiveCamera"||t==="orthographicCamera"){const p=t.charAt(0).toUpperCase()+t.slice(1);E.notify.warning(`Possibly incorrect use of <e.${t} />`,`You seem to have declared the camera "${l}" simply as \`<e.${t} ... />\`. This alone won't make r3f use it for rendering.

The easiest way to create a custom animatable \`${p}\` is to import it from \`@react-three/drei\`, and make it editable.
\`\`\`
import {${p}} from '@react-three/drei'

const EditableCamera =
  editable(${p}, '${t}')
\`\`\`
Then you can use it in your JSX like any other editable component. Note the makeDefault prop exposed by drei, which makes r3f use it for rendering.
\`\`\`
<EditableCamera
  theatreKey="${l}"
  makeDefault
>
\`\`\`
`)}},[t,l]),i.useLayoutEffect(()=>{if(_)if(g){_.object(l,Object.assign(c({},v),...Object.values(e[u].props).map(p=>p.type)),{reconfigure:!0});return}else{const p=_.object(l,Object.assign(c({},v),...Object.values(e[u].props).map(P=>P.type)));F.add(p),re(p),h&&(typeof h=="function"?h(p):h.current=p),L.getState().addEditable(D,{type:u,sheetObject:p,visibleOnlyInEditor:s==="editor",objectConfig:e[u]})}},[_,D,v]),i.useLayoutEffect(()=>{g&&(g.initialValue=Object.fromEntries(Object.entries(e[u].props).map(([p,P])=>[p,P.parse(y)])))},[g,...Object.keys(e[u].props).map(p=>y[p])]),i.useLayoutEffect(()=>{if(!g)return;const p=j.current,P=ne=>{var W,B;Object.entries(e[u].props).forEach(([ie,se])=>se.apply(ne[ie],p)),(B=(W=e[u]).updateObject)==null||B.call(W,p),ae()};P(g.value);const oe=g.onValuesChange(P,R);return()=>{oe(),g.sheet.detachObject(l),F.delete(g),L.getState().removeEditable(D)}},[g,R]),q.createElement(t,d(c({ref:I([j,f])},y),{visible:s!=="editor"&&s,userData:{__editable:!0,__storeKey:D}}))})},a=d(c({},Object.fromEntries(Object.keys(e).map(t=>[t,r(t,t)]))),{primitive:r("primitive",null)});return Object.assign(r,a)},Me=Ae(Re),te=Me,We=te(i.forwardRef((e,r)=>{var a=e,{makeDefault:t,lookAt:o}=a,b=k(a,["makeDefault","lookAt"]);const f=S(({set:n})=>n),O=S(({camera:n})=>n),l=S(({size:n})=>n),s=i.useRef(null);return i.useLayoutEffect(()=>{b.manual||(s.current.aspect=l.width/l.height)},[l,b]),i.useLayoutEffect(()=>{s.current.updateProjectionMatrix()}),i.useLayoutEffect(()=>{if(t){const n=O;return f(()=>({camera:s.current})),()=>f(()=>({camera:n}))}},[s,t,f]),V(()=>{var n;if(o&&s.current){s.current.lookAt(Array.isArray(o)?new U(...o):o.current?o.current.position:o);const v=L.getState().editablesSnapshot;v&&((n=v[s.current.userData.__storeKey].proxyObject)==null||n.rotation.copy(s.current.rotation))}}),i.createElement("perspectiveCamera",c({ref:I([s,r])},b))}),"perspectiveCamera");te(i.forwardRef((e,r)=>{var a=e,{makeDefault:t,lookAt:o}=a,b=k(a,["makeDefault","lookAt"]);const f=S(({set:n})=>n),O=S(({camera:n})=>n),l=S(({size:n})=>n),s=i.useRef(null);return i.useLayoutEffect(()=>{b.manual||s.current.updateProjectionMatrix()},[l,b]),i.useLayoutEffect(()=>{s.current.updateProjectionMatrix()}),i.useLayoutEffect(()=>{if(t){const n=O;return f(()=>({camera:s.current})),()=>f(()=>({camera:n}))}},[s,t,f]),V(()=>{var n;if(o&&s.current){s.current.lookAt(Array.isArray(o)?new U(...o):o.current?o.current.position:o);const v=L.getState().editablesSnapshot;v&&((n=v[s.current.userData.__storeKey].proxyObject)==null||n.rotation.copy(s.current.rotation))}}),i.createElement("orthographicCamera",c({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:I([s,r])},b))}),"orthographicCamera");export{We as P,Ie as S,F as a,te as b,L as e,ze as m};

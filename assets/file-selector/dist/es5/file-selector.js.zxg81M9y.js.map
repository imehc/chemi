{"version":3,"file":"file-selector.js.zxg81M9y.js","sources":["../../../../../node_modules/.pnpm/file-selector@0.5.0/node_modules/file-selector/dist/es5/file-selector.js"],"sourcesContent":["import { __awaiter, __generator, __read, __spread } from \"tslib\";\nimport { toFileWithPath } from './file';\nvar FILES_TO_IGNORE = [\n    // Thumbnail cache files for macOS and Windows\n    '.DS_Store',\n    'Thumbs.db' // Windows\n];\n/**\n * Convert a DragEvent's DataTrasfer object to a list of File objects\n * NOTE: If some of the items are folders,\n * everything will be flattened and placed in the same list but the paths will be kept as a {path} property.\n *\n * EXPERIMENTAL: A list of https://developer.mozilla.org/en-US/docs/Web/API/FileSystemHandle objects can also be passed as an arg\n * and a list of File objects will be returned.\n *\n * @param evt\n */\nexport function fromEvent(evt) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (isObject(evt) && isDataTransfer(evt)) {\n                return [2 /*return*/, getDataTransferFiles(evt.dataTransfer, evt.type)];\n            }\n            else if (isChangeEvt(evt)) {\n                return [2 /*return*/, getInputFiles(evt)];\n            }\n            else if (Array.isArray(evt) && evt.every(function (item) { return 'getFile' in item && typeof item.getFile === 'function'; })) {\n                return [2 /*return*/, getFsHandleFiles(evt)];\n            }\n            return [2 /*return*/, []];\n        });\n    });\n}\nfunction isDataTransfer(value) {\n    return isObject(value.dataTransfer);\n}\nfunction isChangeEvt(value) {\n    return isObject(value) && isObject(value.target);\n}\nfunction isObject(v) {\n    return typeof v === 'object' && v !== null;\n}\nfunction getInputFiles(evt) {\n    return fromList(evt.target.files).map(function (file) { return toFileWithPath(file); });\n}\n// Ee expect each handle to be https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileHandle\nfunction getFsHandleFiles(handles) {\n    return __awaiter(this, void 0, void 0, function () {\n        var files;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, Promise.all(handles.map(function (h) { return h.getFile(); }))];\n                case 1:\n                    files = _a.sent();\n                    return [2 /*return*/, files.map(function (file) { return toFileWithPath(file); })];\n            }\n        });\n    });\n}\nfunction getDataTransferFiles(dt, type) {\n    return __awaiter(this, void 0, void 0, function () {\n        var items, files;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (dt === null) {\n                        return [2 /*return*/, []];\n                    }\n                    if (!dt.items) return [3 /*break*/, 2];\n                    items = fromList(dt.items)\n                        .filter(function (item) { return item.kind === 'file'; });\n                    // According to https://html.spec.whatwg.org/multipage/dnd.html#dndevents,\n                    // only 'dragstart' and 'drop' has access to the data (source node)\n                    if (type !== 'drop') {\n                        return [2 /*return*/, items];\n                    }\n                    return [4 /*yield*/, Promise.all(items.map(toFilePromises))];\n                case 1:\n                    files = _a.sent();\n                    return [2 /*return*/, noIgnoredFiles(flatten(files))];\n                case 2: return [2 /*return*/, noIgnoredFiles(fromList(dt.files)\n                        .map(function (file) { return toFileWithPath(file); }))];\n            }\n        });\n    });\n}\nfunction noIgnoredFiles(files) {\n    return files.filter(function (file) { return FILES_TO_IGNORE.indexOf(file.name) === -1; });\n}\n// IE11 does not support Array.from()\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#Browser_compatibility\n// https://developer.mozilla.org/en-US/docs/Web/API/FileList\n// https://developer.mozilla.org/en-US/docs/Web/API/DataTransferItemList\nfunction fromList(items) {\n    if (items === null) {\n        return [];\n    }\n    var files = [];\n    // tslint:disable: prefer-for-of\n    for (var i = 0; i < items.length; i++) {\n        var file = items[i];\n        files.push(file);\n    }\n    return files;\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/DataTransferItem\nfunction toFilePromises(item) {\n    if (typeof item.webkitGetAsEntry !== 'function') {\n        return fromDataTransferItem(item);\n    }\n    var entry = item.webkitGetAsEntry();\n    // Safari supports dropping an image node from a different window and can be retrieved using\n    // the DataTransferItem.getAsFile() API\n    // NOTE: FileSystemEntry.file() throws if trying to get the file\n    if (entry && entry.isDirectory) {\n        return fromDirEntry(entry);\n    }\n    return fromDataTransferItem(item);\n}\nfunction flatten(items) {\n    return items.reduce(function (acc, files) { return __spread(acc, (Array.isArray(files) ? flatten(files) : [files])); }, []);\n}\nfunction fromDataTransferItem(item) {\n    var file = item.getAsFile();\n    if (!file) {\n        return Promise.reject(item + \" is not a File\");\n    }\n    var fwp = toFileWithPath(file);\n    return Promise.resolve(fwp);\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemEntry\nfunction fromEntry(entry) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2 /*return*/, entry.isDirectory ? fromDirEntry(entry) : fromFileEntry(entry)];\n        });\n    });\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryEntry\nfunction fromDirEntry(entry) {\n    var reader = entry.createReader();\n    return new Promise(function (resolve, reject) {\n        var entries = [];\n        function readEntries() {\n            var _this = this;\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryEntry/createReader\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryReader/readEntries\n            reader.readEntries(function (batch) { return __awaiter(_this, void 0, void 0, function () {\n                var files, err_1, items;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            if (!!batch.length) return [3 /*break*/, 5];\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, 3, , 4]);\n                            return [4 /*yield*/, Promise.all(entries)];\n                        case 2:\n                            files = _a.sent();\n                            resolve(files);\n                            return [3 /*break*/, 4];\n                        case 3:\n                            err_1 = _a.sent();\n                            reject(err_1);\n                            return [3 /*break*/, 4];\n                        case 4: return [3 /*break*/, 6];\n                        case 5:\n                            items = Promise.all(batch.map(fromEntry));\n                            entries.push(items);\n                            // Continue reading\n                            readEntries();\n                            _a.label = 6;\n                        case 6: return [2 /*return*/];\n                    }\n                });\n            }); }, function (err) {\n                reject(err);\n            });\n        }\n        readEntries();\n    });\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileEntry\nfunction fromFileEntry(entry) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2 /*return*/, new Promise(function (resolve, reject) {\n                    entry.file(function (file) {\n                        var fwp = toFileWithPath(file, entry.fullPath);\n                        resolve(fwp);\n                    }, function (err) {\n                        reject(err);\n                    });\n                })];\n        });\n    });\n}\n//# sourceMappingURL=file-selector.js.map"],"names":["FILES_TO_IGNORE","fromEvent","evt","__awaiter","__generator","_a","isObject","isDataTransfer","getDataTransferFiles","isChangeEvt","getInputFiles","item","getFsHandleFiles","value","v","fromList","file","toFileWithPath","handles","files","h","dt","type","items","toFilePromises","noIgnoredFiles","flatten","i","fromDataTransferItem","entry","fromDirEntry","acc","__spread","fwp","fromEntry","fromFileEntry","reader","resolve","reject","entries","readEntries","_this","batch","err_1","err"],"mappings":"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","x_google_ignoreList":[0]}
{"version":3,"file":"index.raTi3XoC.js","sources":["../../src/demo2/13/NeuralNetwork.tsx","../../src/demo2/13/index.tsx"],"sourcesContent":["// Inspired from https://threejs.org/examples/?q=draw#webgl_buffergeometry_drawrange\n\nimport { useEffect, useMemo, useRef } from 'react';\nimport { AdditiveBlending, BufferGeometry, Group, Vector3 } from 'three';\nimport { useFrame } from '@react-three/fiber';\n\nexport default function NeuralNetwork() {\n  const groupRef = useRef<Group>(null);\n  const particlesRef = useRef<BufferGeometry>(null);\n  const linesGeometryRef = useRef<BufferGeometry>(null);\n\n  const maxParticleCount = 1000;\n  const particleCount = 500;\n  const r = 10;\n  const rHalf = r / 2;\n  const maxConnections = 20;\n  const minDistance = 2.5;\n  let vertexpos = 0;\n  let colorpos = 0;\n  let numConnected = 0;\n\n  const segments = maxParticleCount * maxParticleCount;\n  const positions = useMemo(() => new Float32Array(segments * 3), [segments]);\n  const colors = useMemo(() => new Float32Array(segments * 3), [segments]);\n\n  const particlePositions = useMemo(\n    () => new Float32Array(maxParticleCount * 3),\n    []\n  );\n\n  const particlesData = useMemo<\n    { velocity: Vector3; numConnections: number }[]\n  >(() => [], []);\n\n  const v = useMemo(() => new Vector3(), []);\n\n  useEffect(() => {\n    for (let i = 0; i < maxParticleCount; i++) {\n      const x = Math.random() * r - r / 2;\n      const y = Math.random() * r - r / 2;\n      const z = Math.random() * r - r / 2;\n\n      particlePositions[i * 3] = x;\n      particlePositions[i * 3 + 1] = y;\n      particlePositions[i * 3 + 2] = z;\n\n      const v = new Vector3(\n        -1 + Math.random() * 2,\n        -1 + Math.random() * 2,\n        -1 + Math.random() * 2\n      );\n      particlesData.push({\n        velocity: v.normalize().divideScalar(50),\n        numConnections: 0,\n      });\n    }\n    if (!particlesRef.current) return;\n    particlesRef.current.setDrawRange(0, particleCount);\n  });\n\n  useFrame((_, delta) => {\n    vertexpos = 0;\n    colorpos = 0;\n    numConnected = 0;\n\n    for (let i = 0; i < particleCount; i++) particlesData[i].numConnections = 0;\n\n    for (let i = 0; i < particleCount; i++) {\n      const particleData = particlesData[i];\n\n      v.set(\n        particlePositions[i * 3],\n        particlePositions[i * 3 + 1],\n        particlePositions[i * 3 + 2]\n      )\n        .add(particleData.velocity)\n        .setLength(10);\n      particlePositions[i * 3] = v.x;\n      particlePositions[i * 3 + 1] = v.y;\n      particlePositions[i * 3 + 2] = v.z;\n\n      if (\n        particlePositions[i * 3 + 1] < -rHalf ||\n        particlePositions[i * 3 + 1] > rHalf\n      )\n        particleData.velocity.y = -particleData.velocity.y;\n\n      if (particlePositions[i * 3] < -rHalf || particlePositions[i * 3] > rHalf)\n        particleData.velocity.x = -particleData.velocity.x;\n\n      if (\n        particlePositions[i * 3 + 2] < -rHalf ||\n        particlePositions[i * 3 + 2] > rHalf\n      )\n        particleData.velocity.z = -particleData.velocity.z;\n\n      if (particleData.numConnections >= maxConnections) continue;\n\n      for (let j = i + 1; j < particleCount; j++) {\n        const particleDataB = particlesData[j];\n        if (particleDataB.numConnections >= maxConnections) continue;\n\n        const dx = particlePositions[i * 3] - particlePositions[j * 3];\n        const dy = particlePositions[i * 3 + 1] - particlePositions[j * 3 + 1];\n        const dz = particlePositions[i * 3 + 2] - particlePositions[j * 3 + 2];\n        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n        if (dist < minDistance) {\n          particleData.numConnections++;\n          particleDataB.numConnections++;\n\n          const alpha = 1.0 - dist / minDistance;\n\n          positions[vertexpos++] = particlePositions[i * 3];\n          positions[vertexpos++] = particlePositions[i * 3 + 1];\n          positions[vertexpos++] = particlePositions[i * 3 + 2];\n\n          positions[vertexpos++] = particlePositions[j * 3];\n          positions[vertexpos++] = particlePositions[j * 3 + 1];\n          positions[vertexpos++] = particlePositions[j * 3 + 2];\n\n          colors[colorpos++] = alpha;\n          colors[colorpos++] = alpha;\n          colors[colorpos++] = alpha;\n\n          colors[colorpos++] = alpha;\n          colors[colorpos++] = alpha;\n          colors[colorpos++] = alpha;\n\n          numConnected++;\n        }\n      }\n    }\n    if (!linesGeometryRef.current) return;\n    if (!particlesRef.current) return;\n    if (!groupRef.current) return;\n    linesGeometryRef.current.setDrawRange(0, numConnected * 2);\n    linesGeometryRef.current.attributes.position.needsUpdate = true;\n    linesGeometryRef.current.attributes.color.needsUpdate = true;\n\n    particlesRef.current.attributes.position.needsUpdate = true;\n\n    groupRef.current.rotation.y += delta / 5;\n  });\n\n  return (\n    <group ref={groupRef} dispose={null}>\n      <points>\n        <bufferGeometry ref={particlesRef}>\n          <bufferAttribute\n            attach=\"attributes-position\"\n            count={particleCount}\n            array={particlePositions}\n            itemSize={3}\n          />\n        </bufferGeometry>\n        <pointsMaterial\n          color={'white'}\n          size={3}\n          blending={AdditiveBlending}\n          transparent={true}\n          sizeAttenuation={false}\n        />\n      </points>\n      <lineSegments>\n        <bufferGeometry ref={linesGeometryRef}>\n          <bufferAttribute\n            attach=\"attributes-position\"\n            count={positions.length / 3}\n            array={positions}\n            itemSize={3}\n          />\n          <bufferAttribute\n            attach=\"attributes-color\"\n            count={colors.length / 3}\n            array={colors}\n            itemSize={3}\n          />\n        </bufferGeometry>\n        <lineBasicMaterial\n          vertexColors={true}\n          blending={AdditiveBlending}\n          transparent={true}\n        />\n      </lineSegments>\n    </group>\n  );\n}\n","import { OrbitControls } from '@react-three/drei';\nimport { Canvas } from '@react-three/fiber';\nimport NeuralNetwork from './NeuralNetwork';\n\n/**\n * 神经网络 copy\n */\nexport const Demo2v13 = () => {\n  return (\n    <Canvas camera={{ position: [0, 0, 20] }}>\n      <NeuralNetwork />\n      <OrbitControls />\n    </Canvas>\n  );\n};\n\nexport default Demo2v13;\n"],"names":["NeuralNetwork","groupRef","useRef","particlesRef","linesGeometryRef","maxParticleCount","particleCount","r","rHalf","maxConnections","minDistance","vertexpos","colorpos","numConnected","segments","positions","useMemo","colors","particlePositions","particlesData","Vector3","useEffect","i","x","y","z","v","useFrame","_","delta","particleData","j","particleDataB","dx","dy","dz","dist","alpha","jsxs","jsx","AdditiveBlending","Demo2v13","Canvas","OrbitControls"],"mappings":"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"}
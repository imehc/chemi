import{r as t,$}from"../../../react/index.js.IuPGg7Py.js";import{u as b}from"../../react-dom/dist/floating-ui.react-dom.mjs.B38vdQb9.js";import{i as I}from"../../utils/dist/floating-ui.utils.dom.mjs.CVC-ABX2.js";import"../../../react-dom/index.js.DLK93kQg.js";const h={...$},D=h.useInsertionEffect,O=D||(e=>e());function w(e){const n=t.useRef(()=>{});return O(()=>{n.current=e}),t.useCallback(function(){for(var u=arguments.length,o=new Array(u),r=0;r<u;r++)o[r]=arguments[r];return n.current==null?void 0:n.current(...o)},[])}var M=typeof document<"u"?t.useLayoutEffect:t.useEffect;let F=!1,A=0;const P=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+A++;function B(){const[e,n]=t.useState(()=>F?P():void 0);return M(()=>{e==null&&n(P())},[]),t.useEffect(()=>{F=!0},[]),e}const N=h.useId,T=N||B;function H(){const e=new Map;return{emit(n,u){var o;(o=e.get(n))==null||o.forEach(r=>r(u))},on(n,u){e.set(n,[...e.get(n)||[],u])},off(n,u){var o;e.set(n,((o=e.get(n))==null?void 0:o.filter(r=>r!==u))||[])}}}const L=t.createContext(null),_=t.createContext(null),j=()=>{var e;return((e=t.useContext(L))==null?void 0:e.id)||null},k=()=>t.useContext(_);function q(e){const{open:n=!1,onOpenChange:u,elements:o}=e,r=T(),g=t.useRef({}),[a]=t.useState(()=>H()),R=j()!=null,[C,S]=t.useState(o.reference),f=w((s,i,d)=>{g.current.openEvent=s?i:void 0,a.emit("openchange",{open:s,event:i,reason:d,nested:R}),u==null||u(s,i,d)}),l=t.useMemo(()=>({setPositionReference:S}),[]),m=t.useMemo(()=>({reference:C||o.reference||null,floating:o.floating||null,domReference:o.reference}),[C,o.reference,o.floating]);return t.useMemo(()=>({dataRef:g,open:n,onOpenChange:f,elements:m,events:a,floatingId:r,refs:l}),[n,f,m,a,r,l])}function K(e){e===void 0&&(e={});const{nodeId:n}=e,u=q({...e,elements:{reference:null,floating:null,...e.elements}}),o=e.rootContext||u,r=o.elements,[g,a]=t.useState(null),[R,C]=t.useState(null),f=(r==null?void 0:r.reference)||g,l=t.useRef(null),m=k();M(()=>{f&&(l.current=f)},[f]);const s=b({...e,elements:{...r,...R&&{reference:R}}}),i=t.useCallback(c=>{const v=I(c)?{getBoundingClientRect:()=>c.getBoundingClientRect(),contextElement:c}:c;C(v),s.refs.setReference(v)},[s.refs]),d=t.useCallback(c=>{(I(c)||c===null)&&(l.current=c,a(c)),(I(s.refs.reference.current)||s.refs.reference.current===null||c!==null&&!I(c))&&s.refs.setReference(c)},[s.refs]),p=t.useMemo(()=>({...s.refs,setReference:d,setPositionReference:i,domReference:l}),[s.refs,d,i]),x=t.useMemo(()=>({...s.elements,domReference:f}),[s.elements,f]),E=t.useMemo(()=>({...s,...o,refs:p,elements:x,nodeId:n}),[s,p,x,n,o]);return M(()=>{o.dataRef.current.floatingContext=E;const c=m==null?void 0:m.nodesRef.current.find(v=>v.id===n);c&&(c.context=E)}),t.useMemo(()=>({...s,context:E,refs:p,elements:x}),[s,p,x,E])}export{K as u};

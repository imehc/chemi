import{r as t,$ as w}from"../../../react/index.js.CiILtb88.js";import{u as A}from"../../react-dom/dist/floating-ui.react-dom.mjs.DwnM904A.js";import{i as m}from"../../utils/dist/floating-ui.utils.dom.mjs.DbGEA3qi.js";import"../../../react-dom/index.js.LUY0HZwr.js";const M={...w},B=M.useInsertionEffect,N=B||(e=>e());function T(e){const o=t.useRef(()=>{});return N(()=>{o.current=e}),t.useCallback(function(){for(var c=arguments.length,u=new Array(c),r=0;r<c;r++)u[r]=arguments[r];return o.current==null?void 0:o.current(...u)},[])}var p=typeof document<"u"?t.useLayoutEffect:t.useEffect;let F=!1,H=0;const b=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+H++;function L(){const[e,o]=t.useState(()=>F?b():void 0);return p(()=>{e==null&&o(b())},[]),t.useEffect(()=>{F=!0},[]),e}const j=M.useId,k=j||L;function q(){const e=new Map;return{emit(o,c){var u;(u=e.get(o))==null||u.forEach(r=>r(c))},on(o,c){e.set(o,[...e.get(o)||[],c])},off(o,c){var u;e.set(o,((u=e.get(o))==null?void 0:u.filter(r=>r!==c))||[])}}}const y=t.createContext(null),z=t.createContext(null),G=()=>{var e;return((e=t.useContext(y))==null?void 0:e.id)||null},J=()=>t.useContext(z);function X(e){var o;e===void 0&&(e={});const{open:c=!1,onOpenChange:u,nodeId:r}=e,[P,D]=t.useState(null),[C,O]=t.useState(null),l=((o=e.elements)==null?void 0:o.reference)||P;p(()=>{l&&(d.current=l)},[l]);const s=A({...e,elements:{...e.elements,...C&&{reference:C}}}),v=J(),_=G()!=null,x=T((n,f,h)=>{E.current.openEvent=n?f:void 0,g.emit("openchange",{open:n,event:f,reason:h,nested:_}),u==null||u(n,f,h)}),d=t.useRef(null),E=t.useRef({}),g=t.useState(()=>q())[0],I=k(),S=t.useCallback(n=>{const f=m(n)?{getBoundingClientRect:()=>n.getBoundingClientRect(),contextElement:n}:n;O(f),s.refs.setReference(f)},[s.refs]),$=t.useCallback(n=>{(m(n)||n===null)&&(d.current=n,D(n)),(m(s.refs.reference.current)||s.refs.reference.current===null||n!==null&&!m(n))&&s.refs.setReference(n)},[s.refs]),i=t.useMemo(()=>({...s.refs,setReference:$,setPositionReference:S,domReference:d}),[s.refs,$,S]),a=t.useMemo(()=>({...s.elements,domReference:l}),[s.elements,l]),R=t.useMemo(()=>({...s,refs:i,elements:a,dataRef:E,nodeId:r,floatingId:I,events:g,open:c,onOpenChange:x}),[s,r,I,g,c,x,i,a]);return p(()=>{const n=v==null?void 0:v.nodesRef.current.find(f=>f.id===r);n&&(n.context=R)}),t.useMemo(()=>({...s,context:R,refs:i,elements:a}),[s,i,a,R])}export{X as u};

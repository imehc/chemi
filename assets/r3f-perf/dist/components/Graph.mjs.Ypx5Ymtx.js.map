{"version":3,"file":"Graph.mjs.Ypx5Ymtx.js","sources":["../../../../../node_modules/.pnpm/r3f-perf@7.1.2_@react-three+fiber@8.15.11_@types+three@0.158.3_react-dom@18.2.0_react@18.2.0_three@0.158.0/node_modules/r3f-perf/dist/components/Graph.mjs"],"sourcesContent":["import { jsxs, Fragment, jsx } from \"react/jsx-runtime\";\nimport { useMemo, useRef } from \"react\";\nimport { matriceCount, matriceWorldCount } from \"./PerfHeadless.mjs\";\nimport { Graph, Graphpc } from \"../styles.mjs\";\nimport { PauseIcon } from \"@radix-ui/react-icons\";\nimport { useFrame, Canvas } from \"@react-three/fiber\";\nimport \"../index.mjs\";\nimport { colorsGraph } from \"./Perf.mjs\";\nimport * as THREE from \"three\";\nimport { TextsHighHZ } from \"./TextsHighHZ.mjs\";\nimport { getPerf, usePerf } from \"../store.mjs\";\nconst ChartCurve = ({ colorBlind, minimal, chart = { length: 120, hz: 60 } }) => {\n  const curves = useMemo(() => {\n    return {\n      fps: new Float32Array(chart.length * 3),\n      cpu: new Float32Array(chart.length * 3),\n      // mem: new Float32Array(chart.length * 3),\n      gpu: new Float32Array(chart.length * 3)\n    };\n  }, [chart]);\n  const fpsRef = useRef(null);\n  const fpsMatRef = useRef(null);\n  const gpuRef = useRef(null);\n  const cpuRef = useRef(null);\n  const dummyVec3 = useMemo(() => new THREE.Vector3(0, 0, 0), []);\n  const updatePoints = (element, factor = 1, ref, viewport) => {\n    let maxVal = 0;\n    const { width: w, height: h } = viewport;\n    const chart2 = getPerf().chart.data[element];\n    if (!chart2 || chart2.length === 0) {\n      return;\n    }\n    const padding = minimal ? 2 : 6;\n    const paddingTop = minimal ? 12 : 50;\n    let len = chart2.length;\n    for (let i = 0; i < len; i++) {\n      let id = (getPerf().chart.circularId + i + 1) % len;\n      if (chart2[id] !== void 0) {\n        if (chart2[id] > maxVal) {\n          maxVal = chart2[id] * factor;\n        }\n        dummyVec3.set(padding + i / (len - 1) * (w - padding * 2) - w / 2, Math.min(100, chart2[id]) * factor / 100 * (h - padding * 2 - paddingTop) - h / 2, 0);\n        dummyVec3.toArray(ref.attributes.position.array, i * 3);\n      }\n    }\n    ref.attributes.position.needsUpdate = true;\n  };\n  useFrame(function updateChartCurve({ viewport }) {\n    updatePoints(\"fps\", 1, fpsRef.current, viewport);\n    if (fpsMatRef.current) {\n      fpsMatRef.current.color.set(getPerf().overclockingFps ? colorsGraph(colorBlind).overClock.toString() : `rgb(${colorsGraph(colorBlind).fps.toString()})`);\n    }\n    updatePoints(\"gpu\", 5, gpuRef.current, viewport);\n    updatePoints(\"cpu\", 5, cpuRef.current, viewport);\n  });\n  return /* @__PURE__ */ jsxs(Fragment, { children: [\n    /* @__PURE__ */ jsxs(\"line\", { onUpdate: (self) => {\n      self.updateMatrix();\n      matriceCount.value -= 1;\n      self.matrixWorld.copy(self.matrix);\n    }, children: [\n      /* @__PURE__ */ jsx(\"bufferGeometry\", { ref: fpsRef, children: /* @__PURE__ */ jsx(\n        \"bufferAttribute\",\n        {\n          attach: \"attributes-position\",\n          count: chart.length,\n          array: curves.fps,\n          itemSize: 3,\n          usage: THREE.DynamicDrawUsage,\n          needsUpdate: true\n        }\n      ) }),\n      /* @__PURE__ */ jsx(\"lineBasicMaterial\", { ref: fpsMatRef, color: `rgb(${colorsGraph(colorBlind).fps.toString()})`, transparent: true, opacity: 0.5 })\n    ] }),\n    /* @__PURE__ */ jsxs(\"line\", { onUpdate: (self) => {\n      self.updateMatrix();\n      matriceCount.value -= 1;\n      self.matrixWorld.copy(self.matrix);\n    }, children: [\n      /* @__PURE__ */ jsx(\"bufferGeometry\", { ref: gpuRef, children: /* @__PURE__ */ jsx(\n        \"bufferAttribute\",\n        {\n          attach: \"attributes-position\",\n          count: chart.length,\n          array: curves.gpu,\n          itemSize: 3,\n          usage: THREE.DynamicDrawUsage,\n          needsUpdate: true\n        }\n      ) }),\n      /* @__PURE__ */ jsx(\"lineBasicMaterial\", { color: `rgb(${colorsGraph(colorBlind).gpu.toString()})`, transparent: true, opacity: 0.5 })\n    ] }),\n    /* @__PURE__ */ jsxs(\"line\", { onUpdate: (self) => {\n      self.updateMatrix();\n      matriceCount.value -= 1;\n      self.matrixWorld.copy(self.matrix);\n    }, children: [\n      /* @__PURE__ */ jsx(\"bufferGeometry\", { ref: cpuRef, children: /* @__PURE__ */ jsx(\n        \"bufferAttribute\",\n        {\n          attach: \"attributes-position\",\n          count: chart.length,\n          array: curves.cpu,\n          itemSize: 3,\n          usage: THREE.DynamicDrawUsage,\n          needsUpdate: true\n        }\n      ) }),\n      /* @__PURE__ */ jsx(\"lineBasicMaterial\", { color: `rgb(${colorsGraph(colorBlind).cpu.toString()})`, transparent: true, opacity: 0.5 })\n    ] })\n  ] });\n};\nconst ChartUI = ({\n  colorBlind,\n  chart,\n  customData,\n  matrixUpdate,\n  showGraph = true,\n  antialias = true,\n  minimal\n}) => {\n  const canvas = useRef(void 0);\n  const paused = usePerf((state) => state.paused);\n  return /* @__PURE__ */ jsxs(\n    Graph,\n    {\n      style: {\n        display: \"flex\",\n        position: \"absolute\",\n        height: `${minimal ? 37 : showGraph ? 100 : 60}px`,\n        minWidth: `${minimal ? \"100px\" : customData ? \"370px\" : \"310px\"}`\n      },\n      children: [\n        /* @__PURE__ */ jsx(\n          Canvas,\n          {\n            ref: canvas,\n            orthographic: true,\n            dpr: antialias ? [1, 2] : 1,\n            gl: {\n              antialias: true,\n              alpha: true,\n              stencil: false,\n              depth: false\n            },\n            onCreated: ({ scene }) => {\n              scene.traverse((obj) => {\n                obj.matrixWorldAutoUpdate = false;\n                obj.matrixAutoUpdate = false;\n              });\n            },\n            flat: true,\n            style: {\n              marginBottom: `-42px`,\n              position: \"relative\",\n              pointerEvents: \"none\",\n              background: \"transparent !important\",\n              height: `${minimal ? 37 : showGraph ? 100 : 60}px`\n            },\n            children: !paused ? /* @__PURE__ */ jsxs(Fragment, { children: [\n              /* @__PURE__ */ jsx(Renderer, {}),\n              /* @__PURE__ */ jsx(TextsHighHZ, { customData, minimal, matrixUpdate }),\n              showGraph && /* @__PURE__ */ jsx(\n                ChartCurve,\n                {\n                  colorBlind,\n                  minimal,\n                  chart\n                }\n              )\n            ] }) : null\n          }\n        ),\n        paused && /* @__PURE__ */ jsxs(Graphpc, { children: [\n          /* @__PURE__ */ jsx(PauseIcon, {}),\n          \" PAUSED\"\n        ] })\n      ]\n    }\n  );\n};\nconst Renderer = () => {\n  useFrame(function updateR3FPerf({ gl, scene, camera }) {\n    camera.updateMatrix();\n    matriceCount.value -= 1;\n    camera.matrixWorld.copy(camera.matrix);\n    camera.matrixWorldInverse.copy(camera.matrixWorld).invert();\n    gl.render(scene, camera);\n    matriceWorldCount.value = 0;\n    matriceCount.value = 0;\n  }, Infinity);\n  return null;\n};\nexport {\n  ChartUI\n};\n//# sourceMappingURL=Graph.mjs.map\n"],"names":["ChartCurve","colorBlind","minimal","chart","curves","useMemo","fpsRef","useRef","fpsMatRef","gpuRef","cpuRef","dummyVec3","THREE.Vector3","updatePoints","element","factor","ref","viewport","maxVal","w","h","chart2","getPerf","padding","paddingTop","len","i","id","useFrame","colorsGraph","jsxs","Fragment","self","matriceCount","jsx","THREE.DynamicDrawUsage","ChartUI","customData","matrixUpdate","showGraph","antialias","canvas","paused","usePerf","state","Graph","Canvas","scene","obj","Renderer","TextsHighHZ","Graphpc","PauseIcon","gl","camera","matriceWorldCount"],"mappings":"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","x_google_ignoreList":[0]}
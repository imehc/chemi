import{j as t}from"../../../react/jsx-runtime.js.CKQaLlsx.js";import{r as u}from"../../../react/index.js.CiILtb88.js";import{m as g,a as P}from"./PerfHeadless.mjs.wTR7J9BP.js";import{G as $,a as E}from"../styles.mjs.DxuIoxHs.js";import{P as G}from"../../../@radix-ui/react-icons/dist/react-icons.esm.js.BiO5X1do.js";import{C as I}from"../../../@react-three/fiber/dist/react-three-fiber.esm.js.BhmFp2tL.js";import{c as m}from"./Perf.mjs.e9sDsd3H.js";import{V as z,aE as v}from"../../../three/build/three.module.js.CElijN_X.js";import{T as V}from"./TextsHighHZ.mjs.BgXZK-VU.js";import{u as k,g as C}from"../store.mjs.CyXzjEg3.js";import{a as S}from"../../../@react-three/fiber/dist/index-c636ef6d.esm.js.DtZMtc8k.js";const w=({colorBlind:s,minimal:p,chart:r={length:120,hz:60}})=>{const a=u.useMemo(()=>({fps:new Float32Array(r.length*3),cpu:new Float32Array(r.length*3),gpu:new Float32Array(r.length*3)}),[r]),l=u.useRef(null),d=u.useRef(null),n=u.useRef(null),h=u.useRef(null),f=u.useMemo(()=>new z(0,0,0),[]),o=(e,c=1,R,W)=>{let U=0;const{width:M,height:A}=W,i=C().chart.data[e];if(!i||i.length===0)return;const j=p?2:6,F=p?12:50;let b=i.length;for(let x=0;x<b;x++){let y=(C().chart.circularId+x+1)%b;i[y]!==void 0&&(i[y]>U&&(U=i[y]*c),f.set(j+x/(b-1)*(M-j*2)-M/2,Math.min(100,i[y])*c/100*(A-j*2-F)-A/2,0),f.toArray(R.attributes.position.array,x*3))}R.attributes.position.needsUpdate=!0};return S(function({viewport:c}){o("fps",1,l.current,c),d.current&&d.current.color.set(C().overclockingFps?m(s).overClock.toString():`rgb(${m(s).fps.toString()})`),o("gpu",5,n.current,c),o("cpu",5,h.current,c)}),t.jsxs(t.Fragment,{children:[t.jsxs("line",{onUpdate:e=>{e.updateMatrix(),g.value-=1,e.matrixWorld.copy(e.matrix)},children:[t.jsx("bufferGeometry",{ref:l,children:t.jsx("bufferAttribute",{attach:"attributes-position",count:r.length,array:a.fps,itemSize:3,usage:v,needsUpdate:!0})}),t.jsx("lineBasicMaterial",{ref:d,color:`rgb(${m(s).fps.toString()})`,transparent:!0,opacity:.5})]}),t.jsxs("line",{onUpdate:e=>{e.updateMatrix(),g.value-=1,e.matrixWorld.copy(e.matrix)},children:[t.jsx("bufferGeometry",{ref:n,children:t.jsx("bufferAttribute",{attach:"attributes-position",count:r.length,array:a.gpu,itemSize:3,usage:v,needsUpdate:!0})}),t.jsx("lineBasicMaterial",{color:`rgb(${m(s).gpu.toString()})`,transparent:!0,opacity:.5})]}),t.jsxs("line",{onUpdate:e=>{e.updateMatrix(),g.value-=1,e.matrixWorld.copy(e.matrix)},children:[t.jsx("bufferGeometry",{ref:h,children:t.jsx("bufferAttribute",{attach:"attributes-position",count:r.length,array:a.cpu,itemSize:3,usage:v,needsUpdate:!0})}),t.jsx("lineBasicMaterial",{color:`rgb(${m(s).cpu.toString()})`,transparent:!0,opacity:.5})]})]})},X=({colorBlind:s,chart:p,customData:r,matrixUpdate:a,showGraph:l=!0,antialias:d=!0,minimal:n})=>{const h=u.useRef(void 0),f=k(o=>o.paused);return t.jsxs($,{style:{display:"flex",position:"absolute",height:`${n?37:l?100:60}px`,minWidth:`${n?"100px":r?"370px":"310px"}`},children:[t.jsx(I,{ref:h,orthographic:!0,camera:{rotation:[0,0,0]},dpr:d?[1,2]:1,gl:{antialias:!0,alpha:!0,stencil:!1,depth:!1},onCreated:({scene:o})=>{o.traverse(e=>{e.matrixWorldAutoUpdate=!1,e.matrixAutoUpdate=!1})},flat:!0,style:{marginBottom:"-42px",position:"relative",pointerEvents:"none",background:"transparent !important",height:`${n?37:l?100:60}px`},children:f?null:t.jsxs(t.Fragment,{children:[t.jsx(T,{}),t.jsx(V,{customData:r,minimal:n,matrixUpdate:a}),l&&t.jsx(w,{colorBlind:s,minimal:n,chart:p})]})}),f&&t.jsxs(E,{children:[t.jsx(G,{})," PAUSED"]})]})},T=()=>(S(function({gl:p,scene:r,camera:a}){a.updateMatrix(),g.value-=1,a.matrixWorld.copy(a.matrix),a.matrixWorldInverse.copy(a.matrixWorld).invert(),p.render(r,a),P.value=0,g.value=0},1/0),null);export{X as C};

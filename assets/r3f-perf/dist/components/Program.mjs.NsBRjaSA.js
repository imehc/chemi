import{j as s}from"../../../react/jsx-runtime.js.Uqq-hvb5.js";import{r as m}from"../../../react/index.js.4247Uq6c.js";import{g as P,h as C,i as T,b as I,j as O,d as j,e as w,k as L,l as f,m as y,n as M,o as E}from"../styles.mjs.P1ocS4n9.js";import{T as S,a as U,f as G,I as v,g as R,E as B,h as D,i as V,C as W,V as N,A}from"../../../@radix-ui/react-icons/dist/react-icons.esm.js.RcFb-OYS.js";import{e as F}from"../helpers/estimateBytesUsed.mjs.wf6kimKT.js";import{u as p}from"../store.mjs.WTcb4_d4.js";const b=(a,r)=>{const u=c=>{switch(c){case 1e3:return"RepeatWrapping";case 1001:return"ClampToEdgeWrapping";case 1002:return"MirroredRepeatWrapping";default:return"ClampToEdgeWrapping"}},l=c=>{switch(c){case 3e3:return"LinearEncoding";case 3001:return"sRGBEncoding";case 3002:return"RGBEEncoding";case 3003:return"LogLuvEncoding";case 3004:return"RGBM7Encoding";case 3005:return"RGBM16Encoding";case 3006:return"RGBDEncoding";case 3007:return"GammaEncoding";default:return"ClampToEdgeWrapping"}};return{name:a,url:r.image.currentSrc,encoding:l(r.encoding),wrapT:u(r.wrapT),flipY:r.flipY.toString()}},H=({program:a,material:r,setTexNumber:u})=>{const l=p(i=>i.gl),[c,x]=m.useState(null);return m.useEffect(()=>{if(l){const i=a==null?void 0:a.getUniforms();let e=0;const g=new Map;i.seq.forEach(n=>{if(!n.id.includes("uTroika")&&n.id!=="isOrthographic"&&n.id!=="uvTransform"&&n.id!=="lightProbe"&&n.id!=="projectionMatrix"&&n.id!=="viewMatrix"&&n.id!=="normalMatrix"&&n.id!=="modelMatrix"&&n.id!=="modelViewMatrix"){let t=[],o={name:n.id};n.cache&&(n.cache.forEach(d=>{typeof d<"u"&&t.push(d.toString().substring(0,4))}),o.value=t.join(),r[n.id]&&r[n.id].image&&r[n.id].image&&(e++,o.value=b(n.id,r[n.id])),o.value||(o.value="empty"),g.set(n.id,o))}}),r.uniforms&&Object.keys(r.uniforms).forEach(n=>{const t=r.uniforms[n];if(t.value){const{value:o}=t;let d={name:n};if(n.includes("uTroika"))return;if(o.isTexture)e++,d.value=b(n,o);else{let h=JSON.stringify(o);try{h=JSON.stringify(o)}catch{h=o.toString()}d.value=h}g.set(n,d)}}),e>0&&u(e),x(g)}},[]),s.jsx(y,{children:c&&Array.from(c.values()).map(i=>s.jsx("span",{children:typeof i.value=="string"?s.jsx("li",{children:s.jsxs("span",{children:[i.name," :"," ",s.jsxs("b",{children:[i.value.substring(0,30),i.value.length>30?"...":""]})]})}):s.jsxs(s.Fragment,{children:[s.jsx("li",{children:s.jsxs("b",{children:[i.value.name,":"]})}),s.jsxs("div",{children:[Object.keys(i.value).map(e=>e!=="name"?s.jsx("div",{children:e==="url"?s.jsx("a",{href:i.value[e],target:"_blank",children:s.jsx("img",{src:i.value[e]})}):s.jsxs("li",{children:[e,": ",s.jsx("b",{children:i.value[e]})]})},e):null),s.jsxs(E,{onClick:()=>{var e;console.info(r[i.value.name]||((e=r==null?void 0:r.uniforms[i.value.name])==null?void 0:e.value))},children:["console.info(",i.value.name,");"]})]})]})},i.name))})},_=({el:a})=>{p(l=>l.log);const r=p(l=>l.gl),u=l=>{if(!r)return 0;const c=Math.round(l.drawCounts.total/(r.info.render.triangles+r.info.render.lines+r.info.render.points)*100*10)/10;return isFinite(c)&&c||0};return s.jsx(s.Fragment,{children:a.drawCounts.total>0&&s.jsxs(j,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[a.drawCounts.type==="Triangle"?s.jsx(N,{style:{top:"-1px"}}):s.jsx(A,{style:{top:"-1px"}}),a.drawCounts.total,s.jsxs("small",{children:[a.drawCounts.type,"s"]}),r&&s.jsxs(w,{style:{bottom:"-10px",width:"40px",fontWeight:"bold"},children:[a.visible&&!a.material.wireframe?u(a):0,"%"]})]})})},J=({el:a})=>{const[r,u]=m.useState(a.visible),[l,c]=m.useState(a.expand),[x,i]=m.useState(0),{meshes:e,program:g,material:n}=a;return s.jsxs(C,{children:[s.jsxs(T,{onClick:()=>{a.expand=!l,Object.keys(e).forEach(t=>{const o=e[t];o.material.wireframe=!1}),c(!l)},children:[s.jsx(I,{style:{marginRight:"6px"},children:l?s.jsx("span",{children:s.jsx(S,{})}):s.jsx("span",{children:s.jsx(U,{})})}),g&&s.jsxs("span",{children:[s.jsx(O,{children:g.name}),s.jsxs(j,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[s.jsx(G,{style:{top:"-1px"}}),Object.keys(e).length,s.jsx("small",{children:Object.keys(e).length>1?"users":"user"})]}),x>0&&s.jsxs(j,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[x>1?s.jsx(v,{style:{top:"-1px"}}):s.jsx(v,{style:{top:"-1px"}}),x,s.jsx("small",{children:"tex"})]}),s.jsx(_,{el:a}),n.glslVersion==="300 es"&&s.jsxs(j,{style:{height:"auto",width:"auto",margin:"0 4px"},children:[s.jsx(R,{style:{top:"-1px"}}),"300",s.jsx("small",{children:"es"}),s.jsx(w,{style:{bottom:"-10px",width:"40px"},children:"glsl"})]})]}),s.jsx(L,{onPointerEnter:()=>{Object.keys(e).forEach(t=>{const o=e[t];o.material.wireframe=!0})},onPointerLeave:()=>{Object.keys(e).forEach(t=>{const o=e[t];o.material.wireframe=!1})},onClick:t=>{t.stopPropagation(),Object.keys(e).forEach(o=>{const d=e[o],h=!r;d.visible=h,a.visible=h,u(h)})},children:r?s.jsx(B,{}):s.jsx(D,{})})]}),s.jsxs("div",{style:{maxHeight:l?"9999px":0,overflow:"hidden"},children:[s.jsxs(f,{children:[s.jsx(V,{})," Uniforms:"]}),s.jsx(H,{program:g,material:n,setTexNumber:i}),s.jsxs(f,{children:[s.jsx(W,{})," Geometries:"]}),s.jsx(y,{children:e&&Object.keys(e).map(t=>e[t]&&e[t].geometry&&s.jsxs(M,{children:[s.jsxs("span",{children:[e[t].geometry.type,": "]}),e[t].userData&&e[t].userData.drawCount&&s.jsxs("b",{children:[s.jsxs("div",{children:[e[t].userData.drawCount.count,s.jsxs("small",{children:[" ",e[t].userData.drawCount.type,"s"]})]}),s.jsx("br",{}),s.jsxs("div",{children:[Math.round(F(e[t].geometry)/1024*1e3)/1e3,"Kb",s.jsx("small",{children:" memory used"})]})]})]},t))}),s.jsxs(E,{onClick:()=>{console.info(n)},children:["console.info(",n.type,")"]})]})]})},Z=()=>{p(r=>r.triggerProgramsUpdate);const a=p(r=>r.programs);return s.jsx(P,{children:a&&Array.from(a.values()).map(r=>r&&r?s.jsx(J,{el:r},r.material.uuid):null)})};export{Z as P};
//# sourceMappingURL=Program.mjs.NsBRjaSA.js.map

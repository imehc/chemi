{"version":3,"file":"countGeoDrawCalls.mjs.mv8ZuZCr.js","sources":["../../../../../node_modules/.pnpm/r3f-perf@7.1.2_@react-three+fiber@8.15.11_@types+three@0.158.3_react-dom@18.2.0_react@18.2.0_three@0.158.0/node_modules/r3f-perf/dist/helpers/countGeoDrawCalls.mjs"],"sourcesContent":["const countGeoDrawCalls = (programs) => {\n  programs.forEach((program, _pkey) => {\n    const { meshes } = program;\n    if (!meshes) {\n      return;\n    }\n    let drawCounts2 = {\n      total: 0,\n      type: \"Triangle\",\n      data: []\n    };\n    Object.keys(meshes).forEach((key) => {\n      const mesh = meshes[key];\n      const { geometry, material } = mesh;\n      let index = geometry.index;\n      const position = geometry.attributes.position;\n      if (!position)\n        return;\n      let rangeFactor = 1;\n      if (material.wireframe === true) {\n        rangeFactor = 0;\n      }\n      const dataCount = index !== null ? index.count : position.count;\n      const rangeStart = geometry.drawRange.start * rangeFactor;\n      const rangeCount = geometry.drawRange.count * rangeFactor;\n      const drawStart = rangeStart;\n      const drawEnd = Math.min(dataCount, rangeStart + rangeCount) - 1;\n      let countInstanceRatio = 1;\n      const instanceCount = mesh.count || 1;\n      let type = \"Triangle\";\n      let mostDrawCalls = 0;\n      if (mesh.isMesh) {\n        if (material.wireframe === true) {\n          type = \"Line\";\n          countInstanceRatio = countInstanceRatio / 2;\n        } else {\n          type = \"Triangle\";\n          countInstanceRatio = countInstanceRatio / 3;\n        }\n      } else if (mesh.isLine) {\n        type = \"Line\";\n        if (mesh.isLineSegments) {\n          countInstanceRatio = countInstanceRatio / 2;\n        } else if (mesh.isLineLoop) {\n          countInstanceRatio = countInstanceRatio;\n        } else {\n          countInstanceRatio = countInstanceRatio - 1;\n        }\n      } else if (mesh.isPoints) {\n        type = \"Point\";\n        countInstanceRatio = countInstanceRatio;\n      } else if (mesh.isSprite) {\n        type = \"Triangle\";\n        countInstanceRatio = countInstanceRatio / 3;\n      }\n      const drawCount = Math.round(Math.max(0, drawEnd - drawStart + 1) * (countInstanceRatio * instanceCount));\n      if (drawCount > mostDrawCalls) {\n        mostDrawCalls = drawCount;\n        drawCounts2.type = type;\n      }\n      drawCounts2.total += drawCount;\n      drawCounts2.data.push({ drawCount, type });\n      mesh.userData.drawCount = {\n        type,\n        count: drawCount\n      };\n    });\n    program.drawCounts = drawCounts2;\n  });\n};\nexport {\n  countGeoDrawCalls\n};\n//# sourceMappingURL=countGeoDrawCalls.mjs.map\n"],"names":["countGeoDrawCalls","programs","program","_pkey","meshes","drawCounts2","key","mesh","geometry","material","index","position","rangeFactor","dataCount","rangeStart","rangeCount","drawStart","drawEnd","countInstanceRatio","instanceCount","type","mostDrawCalls","drawCount"],"mappings":"AAAK,MAACA,EAAqBC,GAAa,CACtCA,EAAS,QAAQ,CAACC,EAASC,IAAU,CACnC,KAAM,CAAE,OAAAC,CAAQ,EAAGF,EACnB,GAAI,CAACE,EACH,OAEF,IAAIC,EAAc,CAChB,MAAO,EACP,KAAM,WACN,KAAM,CAAE,CACd,EACI,OAAO,KAAKD,CAAM,EAAE,QAASE,GAAQ,CACnC,MAAMC,EAAOH,EAAOE,CAAG,EACjB,CAAE,SAAAE,EAAU,SAAAC,CAAU,EAAGF,EAC/B,IAAIG,EAAQF,EAAS,MACrB,MAAMG,EAAWH,EAAS,WAAW,SACrC,GAAI,CAACG,EACH,OACF,IAAIC,EAAc,EACdH,EAAS,YAAc,KACzBG,EAAc,GAEhB,MAAMC,EAAYH,IAAU,KAAOA,EAAM,MAAQC,EAAS,MACpDG,EAAaN,EAAS,UAAU,MAAQI,EACxCG,EAAaP,EAAS,UAAU,MAAQI,EACxCI,EAAYF,EACZG,EAAU,KAAK,IAAIJ,EAAWC,EAAaC,CAAU,EAAI,EAC/D,IAAIG,EAAqB,EACzB,MAAMC,EAAgBZ,EAAK,OAAS,EACpC,IAAIa,EAAO,WACPC,EAAgB,EAChBd,EAAK,OACHE,EAAS,YAAc,IACzBW,EAAO,OACPF,EAAqBA,EAAqB,IAE1CE,EAAO,WACPF,EAAqBA,EAAqB,GAEnCX,EAAK,QACda,EAAO,OACHb,EAAK,eACPW,EAAqBA,EAAqB,EACjCX,EAAK,WACdW,EAAqBA,EAErBA,EAAqBA,EAAqB,GAEnCX,EAAK,UACda,EAAO,QACPF,EAAqBA,GACZX,EAAK,WACda,EAAO,WACPF,EAAqBA,EAAqB,GAE5C,MAAMI,EAAY,KAAK,MAAM,KAAK,IAAI,EAAGL,EAAUD,EAAY,CAAC,GAAKE,EAAqBC,EAAc,EACpGG,EAAYD,IACdA,EAAgBC,EAChBjB,EAAY,KAAOe,GAErBf,EAAY,OAASiB,EACrBjB,EAAY,KAAK,KAAK,CAAE,UAAAiB,EAAW,KAAAF,CAAM,CAAA,EACzCb,EAAK,SAAS,UAAY,CACxB,KAAAa,EACA,MAAOE,CACf,CACA,CAAK,EACDpB,EAAQ,WAAaG,CACzB,CAAG,CACH","x_google_ignoreList":[0]}
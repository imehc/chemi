{"version":3,"file":"index.NEBCNaqW.js","sources":["../../src/demo2/10/use_store.ts","../../src/demo2/10/Selectable.tsx","../../src/demo2/10/Scene.tsx","../../src/demo2/10/Teleport.tsx","../../src/demo2/10/index.tsx"],"sourcesContent":["import { Vector3 } from 'three';\nimport { create } from 'zustand';\n\ninterface Props {\n  to: Vector3;\n  orbitmode: boolean;\n  setOrbitmode(o: boolean): void;\n  autoRotate: boolean;\n  setAutoRotate(a: boolean): void;\n}\n\nexport const useStore = create<Props>((set) => ({\n  to: new Vector3(0, 1, 10),\n  orbitmode: false,\n  setOrbitmode: (v) => set({ orbitmode: v }),\n  autoRotate: false,\n  setAutoRotate: (v) => set({ autoRotate: v }),\n}));\n","import { Select } from '@react-three/postprocessing';\nimport React, { useState } from 'react';\nimport { BufferGeometry, MeshStandardMaterial, Vector3 } from 'three';\nimport { useStore } from './use_store';\n\ninterface Props {\n  geometry: BufferGeometry;\n  material: MeshStandardMaterial;\n  position: Vector3;\n}\n\nexport const Selectable: React.FC<Props> = ({\n  geometry,\n  material,\n  position,\n}) => {\n  const [hovered, hover] = useState(false);\n  const { setOrbitmode, setAutoRotate, to } = useStore((state) => state);\n\n  return (\n    <Select enabled={hovered}>\n      <mesh\n        onPointerOver={(e) => {\n          e.stopPropagation();\n          hover(true);\n        }}\n        onPointerOut={() => hover(false)}\n        onClick={(e) => {\n          e.stopPropagation();\n          to.set(...(position as unknown as [number, number, number]));\n          setOrbitmode(true);\n          setTimeout(() => setAutoRotate(true), 1000);\n        }}\n        geometry={geometry}\n        material={material}\n        position={position}\n      />\n    </Select>\n  );\n};\n","import { useGLTF } from '@react-three/drei';\nimport {\n  Selection,\n  EffectComposer,\n  Outline,\n} from '@react-three/postprocessing';\nimport { GLTFResult } from '~/types/use_gltf';\nimport { Selectable } from './Selectable';\n\nexport const Scene = () => {\n  const { nodes, materials } = useGLTF(\n    'https://cdn.jsdelivr.net/gh/Sean-Bradley/React-Three-Fiber-Boilerplate@teleport/public/models/scene-transformed.glb'\n  ) as GLTFResult;\n\n  return (\n    <group dispose={null}>\n      <mesh\n        geometry={nodes.Plane.geometry}\n        material={nodes.Plane.material}\n        scale={[10, 1, 10]}\n      />\n      <Selection>\n        <EffectComposer multisampling={8} autoClear={false}>\n          <Outline\n            blur\n            // visibleEdgeColor=\"white\"\n            edgeStrength={100}\n            width={1000}\n          />\n        </EffectComposer>\n        <Selectable\n          geometry={nodes.Cube.geometry}\n          material={materials.Material}\n          position={[8, 1, 8] as any}\n        />\n        <Selectable\n          geometry={nodes.Cylinder.geometry}\n          material={nodes.Cylinder.material as any}\n          position={[8, 1, -8] as any}\n        />\n        <Selectable\n          geometry={nodes.Icosphere.geometry}\n          material={nodes.Icosphere.material as any}\n          position={[-8, 1, -8] as any}\n        />\n        <Selectable\n          geometry={nodes.Cone.geometry}\n          material={nodes.Cone.material as any}\n          position={[-8, 1, 8] as any}\n        />\n        <Selectable\n          geometry={nodes.Suzanne.geometry}\n          material={nodes.Suzanne.material as any}\n          position={[0, 1, 0] as any}\n        />\n      </Selection>\n    </group>\n  );\n};\n","import { useRef, useMemo, useEffect } from 'react';\nimport { Group, MathUtils, Mesh, MeshBasicMaterial, Vector2 } from 'three';\nimport { useFrame } from '@react-three/fiber';\nimport { useStore } from './use_store';\nimport { PerspectiveCamera } from '@react-three/drei';\n\nexport const Teleport = () => {\n  const pivotY = useRef<Group>(null);\n  const pivotX = useRef<Group>(null);\n  const offset = useRef<Group>(null);\n  const circleRef = useRef<Mesh>(null);\n  const circleEffectRef = useRef<Mesh>(null);\n  const date = useRef(0);\n  const dragVector = useMemo(() => new Vector2(), []);\n  const { orbitmode, setOrbitmode, autoRotate, setAutoRotate, to } = useStore(\n    (state) => state\n  );\n\n  useEffect(() => {\n    const onPointerMove = (e: PointerEvent) => {\n      dragVector.set(e.movementX, e.movementY);\n\n      if (!pivotX.current) return;\n      if (!pivotY.current) return;\n      if (e.buttons) {\n        if (orbitmode) {\n          setAutoRotate(false);\n          pivotX.current.rotation.x -= e.movementY / 1000;\n          pivotY.current.rotation.y -= ((dragVector.x / 5) * Math.PI) / 180;\n        } else {\n          pivotX.current.rotation.x += ((dragVector.y / 10) * Math.PI) / 180;\n          pivotY.current.rotation.y += ((dragVector.x / 10) * Math.PI) / 180;\n        }\n      }\n    };\n    document.addEventListener('pointermove', onPointerMove);\n    return () => {\n      document.removeEventListener('pointermove', onPointerMove);\n    };\n  });\n  useFrame((_, delta) => {\n    if (!offset.current) return;\n    if (!pivotY.current) return;\n    if (orbitmode) {\n      offset.current.position.z = MathUtils.lerp(\n        offset.current.position.z,\n        4,\n        delta * 2\n      );\n      autoRotate && (pivotY.current.rotation.y += delta / 2);\n    } else {\n      offset.current.position.z = MathUtils.lerp(\n        offset.current.position.z,\n        0,\n        delta * 2\n      );\n    }\n\n    if (!circleEffectRef.current) return;\n\n    pivotY.current.position.lerp(to, delta * 2);\n    (circleEffectRef.current.material as MeshBasicMaterial).opacity > 0.02\n      ? ((circleEffectRef.current.material as MeshBasicMaterial).opacity -=\n          delta * 0.5)\n      : (circleEffectRef.current.visible = false);\n  });\n\n  return (\n    <>\n      <group ref={pivotY}>\n        <group ref={pivotX}>\n          <group ref={offset}>\n            <PerspectiveCamera makeDefault />\n          </group>\n        </group>\n      </group>\n      <mesh\n        visible={false}\n        rotation-x={-Math.PI / 2}\n        position={[0, 0, 0]}\n        onPointerMove={({ point }) => {\n          if (!circleRef.current) return;\n          circleRef.current.position.z = point.z;\n          circleRef.current.position.x = point.x;\n        }}\n        onPointerDown={() => {\n          date.current = Date.now();\n        }}\n        onPointerUp={({ point }) => {\n          if (Date.now() - date.current < 200) {\n            // a quick click\n            setOrbitmode(false);\n            to.set(point.x, 1, point.z);\n            if (!circleEffectRef.current) return;\n            if (!circleRef.current) return;\n            circleEffectRef.current.position.copy(circleRef.current.position);\n            (circleEffectRef.current.material as MeshBasicMaterial).opacity =\n              0.99;\n            circleEffectRef.current.visible = true;\n          }\n        }}\n      >\n        <planeGeometry args={[19.4, 19.4]} />\n      </mesh>\n      <mesh ref={circleRef} rotation-x={-Math.PI / 2} position-y={0.011}>\n        <ringGeometry args={[0.3, 0.4]} />\n        <meshBasicMaterial color={0x000000} transparent opacity={0.25} />\n      </mesh>\n      <mesh ref={circleEffectRef} rotation-x={-Math.PI / 2} position-y={0.01}>\n        <ringGeometry args={[0, 0.3]} />\n        <meshBasicMaterial color={0x000000} transparent />\n      </mesh>\n    </>\n  );\n};\n","import { Canvas } from '@react-three/fiber';\nimport { Stats, Environment } from '@react-three/drei';\nimport { Scene } from './Scene';\nimport { Teleport } from './Teleport';\n\n/**\n * 平滑过渡\n */\nconst Demo2v10 = () => {\n  return (\n    <>\n      <Canvas>\n        <Teleport />\n        <Environment\n          files=\"https://cdn.jsdelivr.net/gh/Sean-Bradley/React-Three-Fiber-Boilerplate@teleport/public/img/rustig_koppie_puresky_1k.hdr\"\n          background\n        />\n        <Scene />\n        <Stats />\n      </Canvas>\n      <div id=\"instructions\">\n        Click the floor slide to the circle.\n        <br />\n        Click a model to orbit around it.\n      </div>\n    </>\n  );\n};\n\nexport default Demo2v10;\n"],"names":["useStore","create","set","Vector3","v","Selectable","geometry","material","position","hovered","hover","useState","setOrbitmode","setAutoRotate","to","state","jsx","Select","e","Scene","nodes","materials","useGLTF","jsxs","Selection","EffectComposer","Outline","Teleport","pivotY","useRef","pivotX","offset","circleRef","circleEffectRef","date","dragVector","useMemo","Vector2","orbitmode","autoRotate","useEffect","onPointerMove","useFrame","_","delta","MathUtils","Fragment","PerspectiveCamera","point","Demo2v10","Canvas","Environment","Stats"],"mappings":"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"}
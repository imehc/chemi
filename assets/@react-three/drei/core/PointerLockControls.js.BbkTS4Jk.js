import{_ as b}from"../../../@babel/runtime/helpers/esm/extends.js.CCbyfPlC.js";import{r as o}from"../../../react/index.js.CiILtb88.js";import{P as j}from"../../../three-stdlib/controls/PointerLockControls.js.CmwTH6yD.js";import{u as s}from"../../fiber/dist/index-c636ef6d.esm.js.DtZMtc8k.js";const O=o.forwardRef(({domElement:g,selector:m,onChange:f,onLock:c,onUnlock:i,enabled:d=!0,makeDefault:l,...L},x)=>{const{camera:w,...z}=L,u=s(e=>e.setEvents),C=s(e=>e.gl),P=s(e=>e.camera),v=s(e=>e.invalidate),y=s(e=>e.events),E=s(e=>e.get),p=s(e=>e.set),h=w||P,A=g||y.connected||C.domElement,t=o.useMemo(()=>new j(h),[h]);return o.useEffect(()=>{if(d){t.connect(A);const e=E().events.compute;return u({compute(a,r){const n=r.size.width/2,_=r.size.height/2;r.pointer.set(n/r.size.width*2-1,-(_/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)}}),()=>{t.disconnect(),u({compute:e})}}},[d,t]),o.useEffect(()=>{const e=n=>{v(),f&&f(n)};t.addEventListener("change",e),c&&t.addEventListener("lock",c),i&&t.addEventListener("unlock",i);const a=()=>t.lock(),r=m?Array.from(document.querySelectorAll(m)):[document];return r.forEach(n=>n&&n.addEventListener("click",a)),()=>{t.removeEventListener("change",e),c&&t.removeEventListener("lock",c),i&&t.removeEventListener("unlock",i),r.forEach(n=>n?n.removeEventListener("click",a):void 0)}},[f,c,i,m,t,v]),o.useEffect(()=>{if(l){const e=E().controls;return p({controls:t}),()=>p({controls:e})}},[l,t]),o.createElement("primitive",b({ref:x,object:t},z))});export{O as P};

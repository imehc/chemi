import{r as u}from"../../../react/index.js.4247Uq6c.js";import{V as c,B as D,M as d}from"../../../three/build/three.module.js.mjdRT5l4.js";import{u as H,a as j}from"../../fiber/dist/index-db8af450.esm.js.7UbIKsuw.js";const z=x=>x&&x.isOrthographicCamera,T=x=>x&&x.isBox3,k=u.createContext(null);function G({children:x,damping:l=6,fit:b,clip:B,observe:v,margin:w=1.2,eps:h=.01,onFit:C}){const P=u.useRef(null),{camera:t,invalidate:y,size:I,controls:L}=H(),n=L,g=u.useRef(C);g.current=C;function W(r,e){return Math.abs(r.x-e.x)<h&&Math.abs(r.y-e.y)<h&&Math.abs(r.z-e.z)<h}function F(r,e,s,m){r.x=d.damp(r.x,e.x,s,m),r.y=d.damp(r.y,e.y,s,m),r.z=d.damp(r.z,e.z,s,m)}const[a]=u.useState(()=>({animating:!1,focus:new c,camera:new c,zoom:1})),[i]=u.useState(()=>({focus:new c,camera:new c,zoom:1})),[o]=u.useState(()=>new D),M=u.useMemo(()=>{function r(){const e=o.getSize(new c),s=o.getCenter(new c),m=Math.max(e.x,e.y,e.z),f=z(t)?m*4:m/(2*Math.atan(Math.PI*t.fov/360)),p=z(t)?m*4:f/t.aspect,S=w*Math.max(f,p);return{box:o,size:e,center:s,distance:S}}return{getSize:r,refresh(e){if(T(e))o.copy(e);else{const s=e||P.current;if(!s)return this;s.updateWorldMatrix(!0,!0),o.setFromObject(s)}if(o.isEmpty()){const s=t.position.length()||10;o.setFromCenterAndSize(new c,new c(s,s,s))}if((n==null?void 0:n.constructor.name)==="OrthographicTrackballControls"){const{distance:s}=r(),m=t.position.clone().sub(n.target).normalize().multiplyScalar(s),f=n.target.clone().add(m);t.position.copy(f)}return this},clip(){const{distance:e}=r();return n&&(n.maxDistance=e*10),t.near=e/100,t.far=e*100,t.updateProjectionMatrix(),n&&n.update(),y(),this},to({position:e,target:s}){a.camera.copy(t.position);const{center:m}=r();return i.camera.set(...e),s?i.focus.set(...s):i.focus.copy(m),l?a.animating=!0:t.position.set(...e),this},fit(){a.camera.copy(t.position),n&&a.focus.copy(n.target);const{center:e,distance:s}=r(),m=e.clone().sub(t.position).normalize().multiplyScalar(s);if(i.camera.copy(e).sub(m),i.focus.copy(e),z(t)){a.zoom=t.zoom;let f=0,p=0;const S=[new c(o.min.x,o.min.y,o.min.z),new c(o.min.x,o.max.y,o.min.z),new c(o.min.x,o.min.y,o.max.z),new c(o.min.x,o.max.y,o.max.z),new c(o.max.x,o.max.y,o.max.z),new c(o.max.x,o.max.y,o.min.z),new c(o.max.x,o.min.y,o.max.z),new c(o.max.x,o.min.y,o.min.z)];e.applyMatrix4(t.matrixWorldInverse);for(const E of S)E.applyMatrix4(t.matrixWorldInverse),f=Math.max(f,Math.abs(E.y-e.y)),p=Math.max(p,Math.abs(E.x-e.x));f*=2,p*=2;const R=(t.top-t.bottom)/f,A=(t.right-t.left)/p;i.zoom=Math.min(R,A)/w,l||(t.zoom=i.zoom,t.updateProjectionMatrix())}return l?a.animating=!0:(t.position.copy(i.camera),t.lookAt(i.focus),n&&(n.target.copy(i.focus),n.update())),g.current&&g.current(this.getSize()),y(),this}}},[o,t,n,w,l,y]);u.useLayoutEffect(()=>{if(n){const r=()=>a.animating=!1;return n.addEventListener("start",r),()=>n.removeEventListener("start",r)}},[n]);const O=u.useRef(0);return u.useLayoutEffect(()=>{(v||O.current++===0)&&(M.refresh(),b&&M.fit(),B&&M.clip())},[I,B,b,v,t,n]),j((r,e)=>{if(a.animating){if(F(a.focus,i.focus,l,e),F(a.camera,i.camera,l,e),a.zoom=d.damp(a.zoom,i.zoom,l,e),t.position.copy(a.camera),z(t)&&(t.zoom=a.zoom,t.updateProjectionMatrix()),n?(n.target.copy(a.focus),n.update()):t.lookAt(a.focus),y(),z(t)&&!(Math.abs(a.zoom-i.zoom)<h)||!z(t)&&!W(a.camera,i.camera)||n&&!W(a.focus,i.focus))return;a.animating=!1}}),u.createElement("group",{ref:P},u.createElement(k.Provider,{value:M},x))}function J(){return u.useContext(k)}export{G as B,J as u};
//# sourceMappingURL=Bounds.js.20g1GnO4.js.map

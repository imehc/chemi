{"version":3,"file":"PerspectiveCamera.js.Sb5MXgt0.js","sources":["../../../../../node_modules/.pnpm/@react-three+drei@9.88.17_@react-three+fiber@8.15.11_@types+three@0.158.3_react-dom@18.2.0_react@18.2.0_three@0.158.0/node_modules/@react-three/drei/core/PerspectiveCamera.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport mergeRefs from 'react-merge-refs';\nimport { useFBO } from './useFBO.js';\n\nconst isFunction = node => typeof node === 'function';\nconst PerspectiveCamera = /* @__PURE__ */React.forwardRef(({\n  envMap,\n  resolution = 256,\n  frames = Infinity,\n  makeDefault,\n  children,\n  ...props\n}, ref) => {\n  const set = useThree(({\n    set\n  }) => set);\n  const camera = useThree(({\n    camera\n  }) => camera);\n  const size = useThree(({\n    size\n  }) => size);\n  const cameraRef = React.useRef(null);\n  const groupRef = React.useRef(null);\n  const fbo = useFBO(resolution);\n  React.useLayoutEffect(() => {\n    if (!props.manual) {\n      cameraRef.current.aspect = size.width / size.height;\n    }\n  }, [size, props]);\n  React.useLayoutEffect(() => {\n    cameraRef.current.updateProjectionMatrix();\n  });\n  let count = 0;\n  let oldEnvMap = null;\n  const functional = isFunction(children);\n  useFrame(state => {\n    if (functional && (frames === Infinity || count < frames)) {\n      groupRef.current.visible = false;\n      state.gl.setRenderTarget(fbo);\n      oldEnvMap = state.scene.background;\n      if (envMap) state.scene.background = envMap;\n      state.gl.render(state.scene, cameraRef.current);\n      state.scene.background = oldEnvMap;\n      state.gl.setRenderTarget(null);\n      groupRef.current.visible = true;\n      count++;\n    }\n  });\n  React.useLayoutEffect(() => {\n    if (makeDefault) {\n      const oldCam = camera;\n      set(() => ({\n        camera: cameraRef.current\n      }));\n      return () => set(() => ({\n        camera: oldCam\n      }));\n    }\n    // The camera should not be part of the dependency list because this components camera is a stable reference\n    // that must exchange the default, and clean up after itself on unmount.\n  }, [cameraRef, makeDefault, set]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"perspectiveCamera\", _extends({\n    ref: mergeRefs([cameraRef, ref])\n  }, props), !functional && children), /*#__PURE__*/React.createElement(\"group\", {\n    ref: groupRef\n  }, functional && children(fbo.texture)));\n});\n\nexport { PerspectiveCamera };\n"],"names":["isFunction","node","PerspectiveCamera","React.forwardRef","envMap","resolution","frames","makeDefault","children","props","ref","set","useThree","camera","size","cameraRef","React.useRef","groupRef","fbo","useFBO","React.useLayoutEffect","count","oldEnvMap","functional","useFrame","state","oldCam","React.createElement","React.Fragment","_extends","mergeRefs"],"mappings":"mVAMA,MAAMA,EAAaC,GAAQ,OAAOA,GAAS,WACrCC,EAAmCC,EAAgB,WAAC,CAAC,CACzD,OAAAC,EACA,WAAAC,EAAa,IACb,OAAAC,EAAS,IACT,YAAAC,EACA,SAAAC,EACA,GAAGC,CACL,EAAGC,IAAQ,CACT,MAAMC,EAAMC,EAAS,CAAC,CACpB,IAAAD,CACD,IAAKA,CAAG,EACHE,EAASD,EAAS,CAAC,CACvB,OAAAC,CACD,IAAKA,CAAM,EACNC,EAAOF,EAAS,CAAC,CACrB,KAAAE,CACD,IAAKA,CAAI,EACJC,EAAYC,SAAa,IAAI,EAC7BC,EAAWD,SAAa,IAAI,EAC5BE,EAAMC,EAAOd,CAAU,EAC7Be,EAAAA,gBAAsB,IAAM,CACrBX,EAAM,SACTM,EAAU,QAAQ,OAASD,EAAK,MAAQA,EAAK,OAEnD,EAAK,CAACA,EAAML,CAAK,CAAC,EAChBW,EAAAA,gBAAsB,IAAM,CAC1BL,EAAU,QAAQ,wBACtB,CAAG,EACD,IAAIM,EAAQ,EACRC,EAAY,KAChB,MAAMC,EAAavB,EAAWQ,CAAQ,EACtC,OAAAgB,EAASC,GAAS,CACZF,IAAejB,IAAW,KAAYe,EAAQf,KAChDW,EAAS,QAAQ,QAAU,GAC3BQ,EAAM,GAAG,gBAAgBP,CAAG,EAC5BI,EAAYG,EAAM,MAAM,WACpBrB,IAAQqB,EAAM,MAAM,WAAarB,GACrCqB,EAAM,GAAG,OAAOA,EAAM,MAAOV,EAAU,OAAO,EAC9CU,EAAM,MAAM,WAAaH,EACzBG,EAAM,GAAG,gBAAgB,IAAI,EAC7BR,EAAS,QAAQ,QAAU,GAC3BI,IAEN,CAAG,EACDD,EAAAA,gBAAsB,IAAM,CAC1B,GAAIb,EAAa,CACf,MAAMmB,EAASb,EACf,OAAAF,EAAI,KAAO,CACT,OAAQI,EAAU,OACnB,EAAC,EACK,IAAMJ,EAAI,KAAO,CACtB,OAAQe,CACT,EAAC,CACH,CAGF,EAAE,CAACX,EAAWR,EAAaI,CAAG,CAAC,EACZgB,EAAAA,cAAoBC,EAAAA,SAAgB,KAAmBD,EAAAA,cAAoB,oBAAqBE,EAAS,CAC3H,IAAKC,EAAU,CAACf,EAAWL,CAAG,CAAC,CACnC,EAAKD,CAAK,EAAG,CAACc,GAAcf,CAAQ,EAAgBmB,EAAmB,cAAC,QAAS,CAC7E,IAAKV,CACN,EAAEM,GAAcf,EAASU,EAAI,OAAO,CAAC,CAAC,CACzC,CAAC","x_google_ignoreList":[0]}
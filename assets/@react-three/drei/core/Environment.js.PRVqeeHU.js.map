{"version":3,"file":"Environment.js.PRVqeeHU.js","sources":["../../../../../node_modules/.pnpm/@react-three+drei@9.88.17_@react-three+fiber@8.15.11_@types+three@0.158.3_react-dom@18.2.0_react@18.2.0_three@0.158.0/node_modules/@react-three/drei/core/Environment.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { useThree, useFrame, createPortal, extend } from '@react-three/fiber';\nimport { Scene, WebGLCubeRenderTarget, HalfFloatType } from 'three';\nimport { GroundProjectedEnv } from 'three-stdlib';\nimport { useEnvironment } from './useEnvironment.js';\n\nconst isRef = obj => obj.current && obj.current.isScene;\nconst resolveScene = scene => isRef(scene) ? scene.current : scene;\nfunction setEnvProps(background, scene, defaultScene, texture, blur = 0) {\n  const target = resolveScene(scene || defaultScene);\n  const oldbg = target.background;\n  const oldenv = target.environment;\n  // @ts-ignore\n  const oldBlur = target.backgroundBlurriness || 0;\n  if (background !== 'only') target.environment = texture;\n  if (background) target.background = texture;\n  // @ts-ignore\n  if (background && target.backgroundBlurriness !== undefined) target.backgroundBlurriness = blur;\n  return () => {\n    if (background !== 'only') target.environment = oldenv;\n    if (background) target.background = oldbg;\n    // @ts-ignore\n    if (background && target.backgroundBlurriness !== undefined) target.backgroundBlurriness = oldBlur;\n  };\n}\nfunction EnvironmentMap({\n  scene,\n  background = false,\n  blur,\n  map\n}) {\n  const defaultScene = useThree(state => state.scene);\n  React.useLayoutEffect(() => {\n    if (map) return setEnvProps(background, scene, defaultScene, map, blur);\n  }, [defaultScene, scene, map, background, blur]);\n  return null;\n}\nfunction EnvironmentCube({\n  background = false,\n  scene,\n  blur,\n  ...rest\n}) {\n  const texture = useEnvironment(rest);\n  const defaultScene = useThree(state => state.scene);\n  React.useLayoutEffect(() => {\n    return setEnvProps(background, scene, defaultScene, texture, blur);\n  }, [texture, background, scene, defaultScene, blur]);\n  return null;\n}\nfunction EnvironmentPortal({\n  children,\n  near = 1,\n  far = 1000,\n  resolution = 256,\n  frames = 1,\n  map,\n  background = false,\n  blur,\n  scene,\n  files,\n  path,\n  preset = undefined,\n  extensions\n}) {\n  const gl = useThree(state => state.gl);\n  const defaultScene = useThree(state => state.scene);\n  const camera = React.useRef(null);\n  const [virtualScene] = React.useState(() => new Scene());\n  const fbo = React.useMemo(() => {\n    const fbo = new WebGLCubeRenderTarget(resolution);\n    fbo.texture.type = HalfFloatType;\n    return fbo;\n  }, [resolution]);\n  React.useLayoutEffect(() => {\n    if (frames === 1) camera.current.update(gl, virtualScene);\n    return setEnvProps(background, scene, defaultScene, fbo.texture, blur);\n  }, [children, virtualScene, fbo.texture, scene, defaultScene, background, frames, gl]);\n  let count = 1;\n  useFrame(() => {\n    if (frames === Infinity || count < frames) {\n      camera.current.update(gl, virtualScene);\n      count++;\n    }\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, createPortal( /*#__PURE__*/React.createElement(React.Fragment, null, children, /*#__PURE__*/React.createElement(\"cubeCamera\", {\n    ref: camera,\n    args: [near, far, fbo]\n  }), files || preset ? /*#__PURE__*/React.createElement(EnvironmentCube, {\n    background: true,\n    files: files,\n    preset: preset,\n    path: path,\n    extensions: extensions\n  }) : map ? /*#__PURE__*/React.createElement(EnvironmentMap, {\n    background: true,\n    map: map,\n    extensions: extensions\n  }) : null), virtualScene));\n}\nfunction EnvironmentGround(props) {\n  var _props$ground, _props$ground2, _scale, _props$ground3;\n  const textureDefault = useEnvironment(props);\n  const texture = props.map || textureDefault;\n  React.useMemo(() => extend({\n    GroundProjectedEnvImpl: GroundProjectedEnv\n  }), []);\n  const args = React.useMemo(() => [texture], [texture]);\n  const height = (_props$ground = props.ground) == null ? void 0 : _props$ground.height;\n  const radius = (_props$ground2 = props.ground) == null ? void 0 : _props$ground2.radius;\n  const scale = (_scale = (_props$ground3 = props.ground) == null ? void 0 : _props$ground3.scale) !== null && _scale !== void 0 ? _scale : 1000;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(EnvironmentMap, _extends({}, props, {\n    map: texture\n  })), /*#__PURE__*/React.createElement(\"groundProjectedEnvImpl\", {\n    args: args,\n    scale: scale,\n    height: height,\n    radius: radius\n  }));\n}\nfunction Environment(props) {\n  return props.ground ? /*#__PURE__*/React.createElement(EnvironmentGround, props) : props.map ? /*#__PURE__*/React.createElement(EnvironmentMap, props) : props.children ? /*#__PURE__*/React.createElement(EnvironmentPortal, props) : /*#__PURE__*/React.createElement(EnvironmentCube, props);\n}\n\nexport { Environment, EnvironmentCube, EnvironmentMap, EnvironmentPortal };\n"],"names":["isRef","obj","resolveScene","scene","setEnvProps","background","defaultScene","texture","blur","target","oldbg","oldenv","oldBlur","EnvironmentMap","map","useThree","state","React.useLayoutEffect","EnvironmentCube","rest","useEnvironment","EnvironmentPortal","children","near","far","resolution","frames","files","path","preset","extensions","gl","camera","React.useRef","virtualScene","React.useState","Scene","fbo","React.useMemo","WebGLCubeRenderTarget","HalfFloatType","count","useFrame","React.createElement","React.Fragment","createPortal","EnvironmentGround","props","_props$ground","_props$ground2","_scale","_props$ground3","textureDefault","extend","GroundProjectedEnv","args","height","radius","scale","_extends","Environment"],"mappings":"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","x_google_ignoreList":[0]}
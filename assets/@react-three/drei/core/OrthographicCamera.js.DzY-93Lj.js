import{_ as R}from"../../../@babel/runtime/helpers/esm/extends.js.CF3RwP-h.js";import{r}from"../../../react/index.js.IuPGg7Py.js";import{u as x}from"./useFBO.js.Z8r8a95p.js";import{u as f,a as y}from"../../fiber/dist/index-ba8afaa4.esm.js.CC8UC62r.js";const F=o=>typeof o=="function",L=r.forwardRef(({envMap:o,resolution:h=256,frames:l=1/0,children:c,makeDefault:m,...u},E)=>{const a=f(({set:e})=>e),b=f(({camera:e})=>e),n=f(({size:e})=>e),t=r.useRef(null);r.useImperativeHandle(E,()=>t.current,[]);const i=r.useRef(null),g=x(h);r.useLayoutEffect(()=>{u.manual||t.current.updateProjectionMatrix()},[n,u]),r.useLayoutEffect(()=>{t.current.updateProjectionMatrix()}),r.useLayoutEffect(()=>{if(m){const e=b;return a(()=>({camera:t.current})),()=>a(()=>({camera:e}))}},[t,m,a]);let d=0,p=null;const s=F(c);return y(e=>{s&&(l===1/0||d<l)&&(i.current.visible=!1,e.gl.setRenderTarget(g),p=e.scene.background,o&&(e.scene.background=o),e.gl.render(e.scene,t.current),e.scene.background=p,e.gl.setRenderTarget(null),i.current.visible=!0,d++)}),r.createElement(r.Fragment,null,r.createElement("orthographicCamera",R({left:n.width/-2,right:n.width/2,top:n.height/2,bottom:n.height/-2,ref:t},u),!s&&c),r.createElement("group",{ref:i},s&&c(g.texture)))});export{L as O};

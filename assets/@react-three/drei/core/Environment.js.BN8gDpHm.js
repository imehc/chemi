import{_ as M}from"../../../@babel/runtime/helpers/esm/extends.js.CF3RwP-h.js";import{r as n}from"../../../react/index.js.IuPGg7Py.js";import{S as B,r as C,H as T}from"../../../three/build/three.module.js.jQmR1wrA.js";import{G as j}from"../../../three-stdlib/objects/GroundProjectedEnv.js.DLk9lWeV.js";import{u as F}from"./useEnvironment.js.D-A-5KSM.js";import{u as E,a as w,c as H,e as D,b as p}from"../../fiber/dist/index-ba8afaa4.esm.js.CC8UC62r.js";const W=e=>e.current&&e.current.isScene,q=e=>W(e)?e.current:e;function _(e,c,l,o,r={}){var u,a,i,s,d;r={backgroundBlurriness:(u=r.blur)!==null&&u!==void 0?u:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const t=q(c||l),g=t.background,b=t.environment,f={backgroundBlurriness:t.backgroundBlurriness,backgroundIntensity:t.backgroundIntensity,backgroundRotation:(a=(i=t.backgroundRotation)==null||i.clone==null?void 0:i.clone())!==null&&a!==void 0?a:[0,0,0],environmentIntensity:t.environmentIntensity,environmentRotation:(s=(d=t.environmentRotation)==null||d.clone==null?void 0:d.clone())!==null&&s!==void 0?s:[0,0,0]};return e!=="only"&&(t.environment=o),e&&(t.background=o),p(t,r),()=>{e!=="only"&&(t.environment=b),e&&(t.background=g),p(t,f)}}function x({scene:e,background:c=!1,map:l,...o}){const r=E(u=>u.scene);return n.useLayoutEffect(()=>{if(l)return _(c,e,r,l,o)}),null}function G({background:e=!1,scene:c,blur:l,backgroundBlurriness:o,backgroundIntensity:r,backgroundRotation:u,environmentIntensity:a,environmentRotation:i,...s}){const d=F(s),t=E(g=>g.scene);return n.useLayoutEffect(()=>_(e,c,t,d,{blur:l,backgroundBlurriness:o,backgroundIntensity:r,backgroundRotation:u,environmentIntensity:a,environmentRotation:i})),null}function z({children:e,near:c=1,far:l=1e3,resolution:o=256,frames:r=1,map:u,background:a=!1,blur:i,backgroundBlurriness:s,backgroundIntensity:d,backgroundRotation:t,environmentIntensity:g,environmentRotation:b,scene:f,files:S,path:L,preset:I=void 0,extensions:h}){const y=E(m=>m.gl),$=E(m=>m.scene),R=n.useRef(null),[v]=n.useState(()=>new B),k=n.useMemo(()=>{const m=new C(o);return m.texture.type=T,m},[o]);n.useLayoutEffect(()=>(r===1&&R.current.update(y,v),_(a,f,$,k.texture,{blur:i,backgroundBlurriness:s,backgroundIntensity:d,backgroundRotation:t,environmentIntensity:g,environmentRotation:b})),[e,v,k.texture,f,$,a,r,y]);let P=1;return w(()=>{(r===1/0||P<r)&&(R.current.update(y,v),P++)}),n.createElement(n.Fragment,null,H(n.createElement(n.Fragment,null,e,n.createElement("cubeCamera",{ref:R,args:[c,l,k]}),S||I?n.createElement(G,{background:!0,files:S,preset:I,path:L,extensions:h}):u?n.createElement(x,{background:!0,map:u,extensions:h}):null),v))}function A(e){var c,l,o,r;const u=F(e),a=e.map||u;n.useMemo(()=>D({GroundProjectedEnvImpl:j}),[]);const i=n.useMemo(()=>[a],[a]),s=(c=e.ground)==null?void 0:c.height,d=(l=e.ground)==null?void 0:l.radius,t=(o=(r=e.ground)==null?void 0:r.scale)!==null&&o!==void 0?o:1e3;return n.createElement(n.Fragment,null,n.createElement(x,M({},e,{map:a})),n.createElement("groundProjectedEnvImpl",{args:i,scale:t,height:s,radius:d}))}function V(e){return e.ground?n.createElement(A,e):e.map?n.createElement(x,e):e.children?n.createElement(z,e):n.createElement(G,e)}export{V as E};

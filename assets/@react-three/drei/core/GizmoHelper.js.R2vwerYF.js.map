{"version":3,"file":"GizmoHelper.js.R2vwerYF.js","sources":["../../../../../node_modules/.pnpm/@react-three+drei@9.88.17_@react-three+fiber@8.15.11_@types+three@0.158.3_react-dom@18.2.0_react@18.2.0_three@0.158.0/node_modules/@react-three/drei/core/GizmoHelper.js"],"sourcesContent":["import * as React from 'react';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { Vector3, Object3D, Matrix4, Quaternion } from 'three';\nimport { OrthographicCamera } from './OrthographicCamera.js';\nimport { Hud } from './Hud.js';\n\nconst Context = /* @__PURE__ */React.createContext({});\nconst useGizmoContext = () => {\n  return React.useContext(Context);\n};\nconst turnRate = 2 * Math.PI; // turn rate in angles per second\nconst dummy = /* @__PURE__ */new Object3D();\nconst matrix = /* @__PURE__ */new Matrix4();\nconst [q1, q2] = [/* @__PURE__ */new Quaternion(), /* @__PURE__ */new Quaternion()];\nconst target = /* @__PURE__ */new Vector3();\nconst targetPosition = /* @__PURE__ */new Vector3();\nconst isOrbitControls = controls => {\n  return 'minPolarAngle' in controls;\n};\nconst GizmoHelper = ({\n  alignment = 'bottom-right',\n  margin = [80, 80],\n  renderPriority = 1,\n  onUpdate,\n  onTarget,\n  children\n}) => {\n  const size = useThree(state => state.size);\n  const mainCamera = useThree(state => state.camera);\n  // @ts-ignore\n  const defaultControls = useThree(state => state.controls);\n  const invalidate = useThree(state => state.invalidate);\n  const gizmoRef = React.useRef(null);\n  const virtualCam = React.useRef(null);\n  const animating = React.useRef(false);\n  const radius = React.useRef(0);\n  const focusPoint = React.useRef(new Vector3(0, 0, 0));\n  const defaultUp = React.useRef(new Vector3(0, 0, 0));\n  React.useEffect(() => {\n    defaultUp.current.copy(mainCamera.up);\n  }, [mainCamera]);\n  const tweenCamera = React.useCallback(direction => {\n    animating.current = true;\n    if (defaultControls || onTarget) focusPoint.current = (defaultControls == null ? void 0 : defaultControls.target) || (onTarget == null ? void 0 : onTarget());\n    radius.current = mainCamera.position.distanceTo(target);\n\n    // Rotate from current camera orientation\n    q1.copy(mainCamera.quaternion);\n\n    // To new current camera orientation\n    targetPosition.copy(direction).multiplyScalar(radius.current).add(target);\n    dummy.lookAt(targetPosition);\n    dummy.up.copy(mainCamera.up);\n    q2.copy(dummy.quaternion);\n    invalidate();\n  }, [defaultControls, mainCamera, onTarget, invalidate]);\n  useFrame((_, delta) => {\n    if (virtualCam.current && gizmoRef.current) {\n      var _gizmoRef$current;\n      // Animate step\n      if (animating.current) {\n        if (q1.angleTo(q2) < 0.01) {\n          animating.current = false;\n          // Orbit controls uses UP vector as the orbit axes,\n          // so we need to reset it after the animation is done\n          // moving it around for the controls to work correctly\n          if (isOrbitControls(defaultControls)) {\n            mainCamera.up.copy(defaultUp.current);\n          }\n        } else {\n          const step = delta * turnRate;\n          // animate position by doing a slerp and then scaling the position on the unit sphere\n          q1.rotateTowards(q2, step);\n          // animate orientation\n          mainCamera.position.set(0, 0, 1).applyQuaternion(q1).multiplyScalar(radius.current).add(focusPoint.current);\n          mainCamera.up.set(0, 1, 0).applyQuaternion(q1).normalize();\n          mainCamera.quaternion.copy(q1);\n          if (onUpdate) onUpdate();else if (defaultControls) defaultControls.update();\n          invalidate();\n        }\n      }\n\n      // Sync Gizmo with main camera orientation\n      matrix.copy(mainCamera.matrix).invert();\n      (_gizmoRef$current = gizmoRef.current) == null || _gizmoRef$current.quaternion.setFromRotationMatrix(matrix);\n    }\n  });\n  const gizmoHelperContext = React.useMemo(() => ({\n    tweenCamera\n  }), [tweenCamera]);\n\n  // Position gizmo component within scene\n  const [marginX, marginY] = margin;\n  const x = alignment.endsWith('-center') ? 0 : alignment.endsWith('-left') ? -size.width / 2 + marginX : size.width / 2 - marginX;\n  const y = alignment.startsWith('center-') ? 0 : alignment.startsWith('top-') ? size.height / 2 - marginY : -size.height / 2 + marginY;\n  return /*#__PURE__*/React.createElement(Hud, {\n    renderPriority: renderPriority\n  }, /*#__PURE__*/React.createElement(Context.Provider, {\n    value: gizmoHelperContext\n  }, /*#__PURE__*/React.createElement(OrthographicCamera, {\n    makeDefault: true,\n    ref: virtualCam,\n    position: [0, 0, 200]\n  }), /*#__PURE__*/React.createElement(\"group\", {\n    ref: gizmoRef,\n    position: [x, y, 0]\n  }, children)));\n};\n\nexport { GizmoHelper, useGizmoContext };\n"],"names":["Context","React.createContext","useGizmoContext","React.useContext","turnRate","dummy","Object3D","matrix","Matrix4","q1","q2","Quaternion","target","Vector3","targetPosition","isOrbitControls","controls","GizmoHelper","alignment","margin","renderPriority","onUpdate","onTarget","children","size","useThree","state","mainCamera","defaultControls","invalidate","gizmoRef","React.useRef","virtualCam","animating","radius","focusPoint","defaultUp","React.useEffect","tweenCamera","React.useCallback","direction","useFrame","_","delta","_gizmoRef$current","step","gizmoHelperContext","React.useMemo","marginX","marginY","x","y","React.createElement","Hud","OrthographicCamera"],"mappings":"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","x_google_ignoreList":[0]}
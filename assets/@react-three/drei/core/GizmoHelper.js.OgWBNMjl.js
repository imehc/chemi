import{r as t}from"../../../react/index.js.IuPGg7Py.js";import{V as u,s as F,n as S,Q as z}from"../../../three/build/three.module.js.jQmR1wrA.js";import{O as V}from"./OrthographicCamera.js.DzY-93Lj.js";import{H as j}from"./Hud.js.Bz4gcp46.js";import{u as c,a as I}from"../../fiber/dist/index-ba8afaa4.esm.js.CC8UC62r.js";const H=t.createContext({}),N=()=>t.useContext(H),T=2*Math.PI,d=new F,E=new S,[s,h]=[new z,new z],P=new u,b=new u,X=o=>"minPolarAngle"in o,U=({alignment:o="bottom-right",margin:M=[80,80],renderPriority:O=1,onUpdate:y,onTarget:a,children:Q})=>{const i=c(r=>r.size),e=c(r=>r.camera),n=c(r=>r.controls),l=c(r=>r.invalidate),p=t.useRef(null),w=t.useRef(null),m=t.useRef(!1),f=t.useRef(0),x=t.useRef(new u(0,0,0)),C=t.useRef(new u(0,0,0));t.useEffect(()=>{C.current.copy(e.up)},[e]);const v=t.useCallback(r=>{m.current=!0,(n||a)&&(x.current=(n==null?void 0:n.target)||(a==null?void 0:a())),f.current=e.position.distanceTo(P),s.copy(e.quaternion),b.copy(r).multiplyScalar(f.current).add(P),d.lookAt(b),d.up.copy(e.up),h.copy(d.quaternion),l()},[n,e,a,l]);I((r,A)=>{if(w.current&&p.current){var q;if(m.current)if(s.angleTo(h)<.01)m.current=!1,X(n)&&e.up.copy(C.current);else{const D=A*T;s.rotateTowards(h,D),e.position.set(0,0,1).applyQuaternion(s).multiplyScalar(f.current).add(x.current),e.up.set(0,1,0).applyQuaternion(s).normalize(),e.quaternion.copy(s),y?y():n&&n.update(),l()}E.copy(e.matrix).invert(),(q=p.current)==null||q.quaternion.setFromRotationMatrix(E)}});const W=t.useMemo(()=>({tweenCamera:v}),[v]),[g,R]=M,k=o.endsWith("-center")?0:o.endsWith("-left")?-i.width/2+g:i.width/2-g,G=o.startsWith("center-")?0:o.startsWith("top-")?i.height/2-R:-i.height/2+R;return t.createElement(j,{renderPriority:O},t.createElement(H.Provider,{value:W},t.createElement(V,{makeDefault:!0,ref:w,position:[0,0,200]}),t.createElement("group",{ref:p,position:[k,G,0]},Q)))};export{U as G,N as u};

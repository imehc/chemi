import{_ as F}from"../../../@babel/runtime/helpers/esm/extends.js.dGVwEr9R.js";import{r}from"../../../react/index.js.4247Uq6c.js";import{W as P,P as L,a as X,b as j,C as q,c as I}from"../../../three/build/three.module.js.mjdRT5l4.js";import{H as J}from"../../../three-stdlib/shaders/HorizontalBlurShader.js.vLsL2nUJ.js";import{V as K}from"../../../three-stdlib/shaders/VerticalBlurShader.js.ki3YfrRs.js";import{u as E,a as N}from"../../fiber/dist/index-db8af450.esm.js.7UbIKsuw.js";const ae=r.forwardRef(({scale:a=10,frames:v=1/0,opacity:k=1,width:o=1,height:l=1,blur:M=1,near:A=0,far:G=10,resolution:u=512,smooth:W=!0,color:T="#000000",depthWrite:z=!1,renderOrder:D,...H},Z)=>{const m=r.useRef(null),t=E(e=>e.scene),n=E(e=>e.gl),c=r.useRef(null);o=o*(Array.isArray(a)?a[0]:a||1),l=l*(Array.isArray(a)?a[1]:a||1);const[f,O,V,i,p,g,y]=r.useMemo(()=>{const e=new P(u,u),x=new P(u,u);x.texture.generateMipmaps=e.texture.generateMipmaps=!1;const S=new L(o,l).rotateX(Math.PI/2),_=new X(S),d=new j;d.depthTest=d.depthWrite=!1,d.onBeforeCompile=s=>{s.uniforms={...s.uniforms,ucolor:{value:new q(T)}},s.fragmentShader=s.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),s.fragmentShader=s.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const R=new I(J),w=new I(K);return w.depthTest=R.depthTest=!1,[e,S,d,_,R,w,x]},[u,o,l,a,T]),h=e=>{i.visible=!0,i.material=p,p.uniforms.tDiffuse.value=f.texture,p.uniforms.h.value=e*1/256,n.setRenderTarget(y),n.render(i,c.current),i.material=g,g.uniforms.tDiffuse.value=y.texture,g.uniforms.v.value=e*1/256,n.setRenderTarget(f),n.render(i,c.current),i.visible=!1};let B=0,b,C;return N(()=>{c.current&&(v===1/0||B<v)&&(B++,b=t.background,C=t.overrideMaterial,m.current.visible=!1,t.background=null,t.overrideMaterial=V,n.setRenderTarget(f),n.render(t,c.current),h(M),W&&h(M*.4),n.setRenderTarget(null),m.current.visible=!0,t.overrideMaterial=C,t.background=b)}),r.useImperativeHandle(Z,()=>m.current,[]),r.createElement("group",F({"rotation-x":Math.PI/2},H,{ref:m}),r.createElement("mesh",{renderOrder:D,geometry:O,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},r.createElement("meshBasicMaterial",{transparent:!0,map:f.texture,opacity:k,depthWrite:z})),r.createElement("orthographicCamera",{ref:c,args:[-o/2,o/2,l/2,-l/2,A,G]}))});export{ae as C};
//# sourceMappingURL=ContactShadows.js.As9CdiXT.js.map

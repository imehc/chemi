import{_ as y}from"../../../@babel/runtime/helpers/esm/extends.js.CF3RwP-h.js";import{r}from"../../../react/index.js.IuPGg7Py.js";import{u as v}from"./useFBO.js.Z8r8a95p.js";import{u as i,a as x}from"../../fiber/dist/index-ba8afaa4.esm.js.CC8UC62r.js";const F=n=>typeof n=="function",T=r.forwardRef(({envMap:n,resolution:E=256,frames:l=1/0,makeDefault:m,children:c,...u},R)=>{const o=i(({set:e})=>e),b=i(({camera:e})=>e),a=i(({size:e})=>e),t=r.useRef(null);r.useImperativeHandle(R,()=>t.current,[]);const s=r.useRef(null),g=v(E);r.useLayoutEffect(()=>{u.manual||(t.current.aspect=a.width/a.height)},[a,u]),r.useLayoutEffect(()=>{t.current.updateProjectionMatrix()});let d=0,p=null;const f=F(c);return x(e=>{f&&(l===1/0||d<l)&&(s.current.visible=!1,e.gl.setRenderTarget(g),p=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,t.current),e.scene.background=p,e.gl.setRenderTarget(null),s.current.visible=!0,d++)}),r.useLayoutEffect(()=>{if(m){const e=b;return o(()=>({camera:t.current})),()=>o(()=>({camera:e}))}},[t,m,o]),r.createElement(r.Fragment,null,r.createElement("perspectiveCamera",y({ref:t},u),!f&&c),r.createElement("group",{ref:s},f&&c(g.texture)))});export{T as P};

{"version":3,"file":"ContactShadows.js.I7FMQ0FX.js","sources":["../../../../../node_modules/.pnpm/@react-three+drei@9.88.17_@react-three+fiber@8.15.11_@types+three@0.158.3_react-dom@18.2.0_react@18.2.0_three@0.158.0/node_modules/@react-three/drei/core/ContactShadows.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport * as THREE from 'three';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { HorizontalBlurShader, VerticalBlurShader } from 'three-stdlib';\n\nconst ContactShadows = /* @__PURE__ */React.forwardRef(({\n  scale = 10,\n  frames = Infinity,\n  opacity = 1,\n  width = 1,\n  height = 1,\n  blur = 1,\n  near = 0,\n  far = 10,\n  resolution = 512,\n  smooth = true,\n  color = '#000000',\n  depthWrite = false,\n  renderOrder,\n  ...props\n}, fref) => {\n  const ref = React.useRef(null);\n  const scene = useThree(state => state.scene);\n  const gl = useThree(state => state.gl);\n  const shadowCamera = React.useRef(null);\n  width = width * (Array.isArray(scale) ? scale[0] : scale || 1);\n  height = height * (Array.isArray(scale) ? scale[1] : scale || 1);\n  const [renderTarget, planeGeometry, depthMaterial, blurPlane, horizontalBlurMaterial, verticalBlurMaterial, renderTargetBlur] = React.useMemo(() => {\n    const renderTarget = new THREE.WebGLRenderTarget(resolution, resolution);\n    const renderTargetBlur = new THREE.WebGLRenderTarget(resolution, resolution);\n    renderTargetBlur.texture.generateMipmaps = renderTarget.texture.generateMipmaps = false;\n    const planeGeometry = new THREE.PlaneGeometry(width, height).rotateX(Math.PI / 2);\n    const blurPlane = new THREE.Mesh(planeGeometry);\n    const depthMaterial = new THREE.MeshDepthMaterial();\n    depthMaterial.depthTest = depthMaterial.depthWrite = false;\n    depthMaterial.onBeforeCompile = shader => {\n      shader.uniforms = {\n        ...shader.uniforms,\n        ucolor: {\n          value: new THREE.Color(color)\n        }\n      };\n      shader.fragmentShader = shader.fragmentShader.replace(`void main() {`,\n      //\n      `uniform vec3 ucolor;\n           void main() {\n          `);\n      shader.fragmentShader = shader.fragmentShader.replace('vec4( vec3( 1.0 - fragCoordZ ), opacity );',\n      // Colorize the shadow, multiply by the falloff so that the center can remain darker\n      'vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );');\n    };\n    const horizontalBlurMaterial = new THREE.ShaderMaterial(HorizontalBlurShader);\n    const verticalBlurMaterial = new THREE.ShaderMaterial(VerticalBlurShader);\n    verticalBlurMaterial.depthTest = horizontalBlurMaterial.depthTest = false;\n    return [renderTarget, planeGeometry, depthMaterial, blurPlane, horizontalBlurMaterial, verticalBlurMaterial, renderTargetBlur];\n  }, [resolution, width, height, scale, color]);\n  const blurShadows = blur => {\n    blurPlane.visible = true;\n    blurPlane.material = horizontalBlurMaterial;\n    horizontalBlurMaterial.uniforms.tDiffuse.value = renderTarget.texture;\n    horizontalBlurMaterial.uniforms.h.value = blur * 1 / 256;\n    gl.setRenderTarget(renderTargetBlur);\n    gl.render(blurPlane, shadowCamera.current);\n    blurPlane.material = verticalBlurMaterial;\n    verticalBlurMaterial.uniforms.tDiffuse.value = renderTargetBlur.texture;\n    verticalBlurMaterial.uniforms.v.value = blur * 1 / 256;\n    gl.setRenderTarget(renderTarget);\n    gl.render(blurPlane, shadowCamera.current);\n    blurPlane.visible = false;\n  };\n  let count = 0;\n  let initialBackground;\n  let initialOverrideMaterial;\n  useFrame(() => {\n    if (shadowCamera.current && (frames === Infinity || count < frames)) {\n      count++;\n      initialBackground = scene.background;\n      initialOverrideMaterial = scene.overrideMaterial;\n      ref.current.visible = false;\n      scene.background = null;\n      scene.overrideMaterial = depthMaterial;\n      gl.setRenderTarget(renderTarget);\n      gl.render(scene, shadowCamera.current);\n      blurShadows(blur);\n      if (smooth) blurShadows(blur * 0.4);\n      gl.setRenderTarget(null);\n      ref.current.visible = true;\n      scene.overrideMaterial = initialOverrideMaterial;\n      scene.background = initialBackground;\n    }\n  });\n  React.useImperativeHandle(fref, () => ref.current, []);\n  return /*#__PURE__*/React.createElement(\"group\", _extends({\n    \"rotation-x\": Math.PI / 2\n  }, props, {\n    ref: ref\n  }), /*#__PURE__*/React.createElement(\"mesh\", {\n    renderOrder: renderOrder,\n    geometry: planeGeometry,\n    scale: [1, -1, 1],\n    rotation: [-Math.PI / 2, 0, 0]\n  }, /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    transparent: true,\n    map: renderTarget.texture,\n    opacity: opacity,\n    depthWrite: depthWrite\n  })), /*#__PURE__*/React.createElement(\"orthographicCamera\", {\n    ref: shadowCamera,\n    args: [-width / 2, width / 2, height / 2, -height / 2, near, far]\n  }));\n});\n\nexport { ContactShadows };\n"],"names":["ContactShadows","React.forwardRef","scale","frames","opacity","width","height","blur","near","far","resolution","smooth","color","depthWrite","renderOrder","props","fref","ref","React.useRef","scene","useThree","state","gl","shadowCamera","renderTarget","planeGeometry","depthMaterial","blurPlane","horizontalBlurMaterial","verticalBlurMaterial","renderTargetBlur","React.useMemo","THREE.WebGLRenderTarget","THREE.PlaneGeometry","THREE.Mesh","THREE.MeshDepthMaterial","shader","THREE.Color","THREE.ShaderMaterial","HorizontalBlurShader","VerticalBlurShader","blurShadows","count","initialBackground","initialOverrideMaterial","useFrame","React.useImperativeHandle","React.createElement","_extends"],"mappings":"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","x_google_ignoreList":[0]}
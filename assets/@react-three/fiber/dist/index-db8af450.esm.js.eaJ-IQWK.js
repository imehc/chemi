import{n as J,T as Ue,R as $e,U as Ve,o as Oe,p as xe,V as H,q as We,r as Xe,C as Ke,l as Ye,m as Je,d as ge,s as Q,N as Qe,A as Ze,t as et,u as tt,v as rt,w as nt,x as ot,y as it}from"../../../three/build/three.module.js.ZP5wlr6b.js";import{r as M}from"../../../react/index.js.4247Uq6c.js";import{c as q}from"../../../react-reconciler/constants.js.tdY7ep42.js";import{c as Re}from"../../../zustand/esm/index.js.zIjYpMGI.js";import{R as st}from"../../../react-reconciler/index.js.tbOlkM-I.js";import{s as _e}from"../../../scheduler/index.js.42U5Wdl4.js";import{s as at,p as lt,c as ct}from"../../../suspend-react/index.js.7rE_FwbT.js";const le={},Lt=e=>void Object.assign(le,e);function ft(e,t){function o(r,{args:n=[],attach:c,...l},f){let _=`${r[0].toUpperCase()}${r.slice(1)}`,p;if(r==="primitive"){if(l.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const i=l.object;p=I(i,{type:r,root:f,attach:c,primitive:!0})}else{const i=le[_];if(!i)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");p=I(new i(...n),{type:r,root:f,attach:c,memoizedProps:{args:n}})}return p.__r3f.attach===void 0&&(p instanceof We?p.__r3f.attach="geometry":p instanceof Xe&&(p.__r3f.attach="material")),_!=="inject"&&te(p,l),p}function d(r,n){let c=!1;if(n){var l,f;(l=n.__r3f)!=null&&l.attach?ee(r,n,n.__r3f.attach):n.isObject3D&&r.isObject3D&&(r.add(n),c=!0),c||(f=r.__r3f)==null||f.objects.push(n),n.__r3f||I(n,{}),n.__r3f.parent=r,ae(n),B(n)}}function u(r,n,c){let l=!1;if(n){var f,_;if((f=n.__r3f)!=null&&f.attach)ee(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){n.parent=r,n.dispatchEvent({type:"added"});const p=r.children.filter(a=>a!==n),i=p.indexOf(c);r.children=[...p.slice(0,i),n,...p.slice(i)],l=!0}l||(_=r.__r3f)==null||_.objects.push(n),n.__r3f||I(n,{}),n.__r3f.parent=r,ae(n),B(n)}}function m(r,n,c=!1){r&&[...r].forEach(l=>y(n,l,c))}function y(r,n,c){if(n){var l,f,_;if(n.__r3f&&(n.__r3f.parent=null),(l=r.__r3f)!=null&&l.objects&&(r.__r3f.objects=r.__r3f.objects.filter(b=>b!==n)),(f=n.__r3f)!=null&&f.attach)Se(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){var p;r.remove(n),(p=n.__r3f)!=null&&p.root&&_t(n.__r3f.root,n)}const a=(_=n.__r3f)==null?void 0:_.primitive,v=!a&&(c===void 0?n.dispose!==null:c);if(!a){var i;m((i=n.__r3f)==null?void 0:i.objects,n,v),m(n.children,n,v)}if(delete n.__r3f,v&&n.dispose&&n.type!=="Scene"){const b=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?_e.unstable_scheduleCallback(_e.unstable_IdlePriority,b):b()}B(r)}}function g(r,n,c,l){var f;const _=(f=r.__r3f)==null?void 0:f.parent;if(!_)return;const p=o(n,c,r.__r3f.root);if(r.children){for(const i of r.children)i.__r3f&&d(p,i);r.children=r.children.filter(i=>!i.__r3f)}r.__r3f.objects.forEach(i=>d(p,i)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||y(_,r),p.parent&&(p.__r3f.autoRemovedBeforeAppend=!0),d(_,p),p.raycast&&p.__r3f.eventCount&&p.__r3f.root.getState().internal.interaction.push(p),[l,l.alternate].forEach(i=>{i!==null&&(i.stateNode=p,i.ref&&(typeof i.ref=="function"?i.ref(p):i.ref.current=p))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:st({createInstance:o,removeChild:y,appendChild:d,appendInitialChild:d,insertBefore:u,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,n)=>{if(!n)return;const c=r.getState().scene;c.__r3f&&(c.__r3f.root=r,d(c,n))},removeChildFromContainer:(r,n)=>{n&&y(r.getState().scene,n)},insertInContainerBefore:(r,n,c)=>{if(!n||!c)return;const l=r.getState().scene;l.__r3f&&u(l,n,c)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var n;return!!((n=r==null?void 0:r.__r3f)!=null?n:{}).handlers},prepareUpdate(r,n,c,l){var f;if(((f=r==null?void 0:r.__r3f)!=null?f:{}).primitive&&l.object&&l.object!==r)return[!0];{const{args:p=[],children:i,...a}=l,{args:v=[],children:b,...C}=c;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((O,R)=>O!==v[R]))return[!0];const S=De(r,a,C,!0);return S.changes.length?[!1,S]:null}},commitUpdate(r,[n,c],l,f,_,p){n?g(r,l,_,p):te(r,c)},commitMount(r,n,c,l){var f;const _=(f=r.__r3f)!=null?f:{};r.raycast&&_.handlers&&_.eventCount&&r.__r3f.root.getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>I(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var n;const{attach:c,parent:l}=(n=r.__r3f)!=null?n:{};c&&l&&Se(l,r,c),r.isObject3D&&(r.visible=!1),B(r)},unhideInstance(r,n){var c;const{attach:l,parent:f}=(c=r.__r3f)!=null?c:{};l&&f&&ee(f,r,l),(r.isObject3D&&n.visible==null||n.visible)&&(r.visible=!0),B(r)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():q.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&E.fun(performance.now)?performance.now:E.fun(Date.now)?Date.now:()=>0,scheduleTimeout:E.fun(setTimeout)?setTimeout:void 0,cancelTimeout:E.fun(clearTimeout)?clearTimeout:void 0}),applyProps:te}}var ye,we;const Z=e=>"colorSpace"in e||"outputColorSpace"in e,Te=()=>{var e;return(e=le.ColorManagement)!=null?e:null},Ae=e=>e&&e.isOrthographicCamera,Ft=e=>e&&e.hasOwnProperty("current"),W=typeof window<"u"&&((ye=window.document)!=null&&ye.createElement||((we=window.navigator)==null?void 0:we.product)==="ReactNative")?M.useLayoutEffect:M.useEffect;function ut(e){const t=M.useRef(e);return W(()=>void(t.current=e),[e]),t}function It({set:e}){return W(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class dt extends M.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}dt.getDerivedStateFromError=()=>({error:!0});const je="__default",be=new Map,pt=e=>e&&!!e.memoized&&!!e.changes;function ke(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const U=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},E={obj:e=>e===Object(e)&&!E.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:d="reference",strict:u=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(E.str(e)||E.num(e))return e===t;const m=E.obj(e);if(m&&d==="reference")return e===t;const y=E.arr(e);if(y&&o==="reference")return e===t;if((y||m)&&e===t)return!0;let g;for(g in e)if(!(g in t))return!1;if(m&&o==="shallow"&&d==="shallow"){for(g in u?t:e)if(!E.equ(e[g],t[g],{strict:u,objects:"reference"}))return!1}else for(g in u?t:e)if(e[g]!==t[g])return!1;if(E.und(g)){if(y&&e.length===0&&t.length===0||m&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function vt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function mt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function I(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function se(e,t){let o=e;if(t.includes("-")){const d=t.split("-"),u=d.pop();return o=d.reduce((m,y)=>m[y],e),{target:o,key:u}}else return{target:o,key:t}}const Ce=/-\d+$/;function ee(e,t,o){if(E.str(o)){if(Ce.test(o)){const m=o.replace(Ce,""),{target:y,key:g}=se(e,m);Array.isArray(y[g])||(y[g]=[])}const{target:d,key:u}=se(e,o);t.__r3f.previousAttach=d[u],d[u]=t}else t.__r3f.previousAttach=o(e,t)}function Se(e,t,o){var d,u;if(E.str(o)){const{target:m,key:y}=se(e,o),g=t.__r3f.previousAttach;g===void 0?delete m[y]:m[y]=g}else(d=t.__r3f)==null||d.previousAttach==null||d.previousAttach(e,t);(u=t.__r3f)==null||delete u.previousAttach}function De(e,{children:t,key:o,ref:d,...u},{children:m,key:y,ref:g,...s}={},h=!1){var r;const n=(r=e==null?void 0:e.__r3f)!=null?r:{},c=Object.entries(u),l=[];if(h){const _=Object.keys(s);for(let p=0;p<_.length;p++)u.hasOwnProperty(_[p])||c.unshift([_[p],je+"remove"])}c.forEach(([_,p])=>{var i;if((i=e.__r3f)!=null&&i.primitive&&_==="object"||E.equ(p,s[_]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return l.push([_,p,!0,[]]);let a=[];_.includes("-")&&(a=_.split("-")),l.push([_,p,!1,a]);for(const v in u){const b=u[v];v.startsWith(`${_}-`)&&l.push([v,b,!1,v.split("-")])}});const f={...u};return n.memoizedProps&&n.memoizedProps.args&&(f.args=n.memoizedProps.args),n.memoizedProps&&n.memoizedProps.attach&&(f.attach=n.memoizedProps.attach),{memoized:f,changes:l}}const ht=typeof process<"u"&&!1;function te(e,t){var o,d,u;const m=(o=e.__r3f)!=null?o:{},y=m.root,g=(d=y==null||y.getState==null?void 0:y.getState())!=null?d:{},{memoized:s,changes:h}=pt(t)?t:De(e,t),r=m.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let c=0;c<h.length;c++){let[l,f,_,p]=h[c];if(Z(e)){const b="srgb",C="srgb-linear";l==="encoding"?(l="colorSpace",f=f===3001?b:C):l==="outputEncoding"&&(l="outputColorSpace",f=f===3001?b:C)}let i=e,a=i[l];if(p.length&&(a=p.reduce((v,b)=>v[b],e),!(a&&a.set))){const[v,...b]=p.reverse();i=b.reverse().reduce((C,S)=>C[S],e),l=v}if(f===je+"remove")if(i.constructor){let v=be.get(i.constructor);v||(v=new i.constructor,be.set(i.constructor,v)),f=v[l]}else f=0;if(_)f?m.handlers[l]=f:delete m.handlers[l],m.eventCount=Object.keys(m.handlers).length;else if(a&&a.set&&(a.copy||a instanceof J)){if(Array.isArray(f))a.fromArray?a.fromArray(f):a.set(...f);else if(a.copy&&f&&f.constructor&&(ht?a.constructor.name===f.constructor.name:a.constructor===f.constructor))a.copy(f);else if(f!==void 0){const v=a instanceof Ke;!v&&a.setScalar?a.setScalar(f):a instanceof J&&f instanceof J?a.mask=f.mask:a.set(f),!Te()&&!g.linear&&v&&a.convertSRGBToLinear()}}else if(i[l]=f,i[l]instanceof Ue&&i[l].format===$e&&i[l].type===Ve){const v=i[l];Z(v)&&Z(g.gl)?v.colorSpace=g.gl.outputColorSpace:v.encoding=g.gl.outputEncoding}B(e)}if(m.parent&&g.internal&&e.raycast&&r!==m.eventCount){const c=g.internal.interaction.indexOf(e);c>-1&&g.internal.interaction.splice(c,1),m.eventCount&&g.internal.interaction.push(e)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(u=e.__r3f)!=null&&u.parent&&ae(e),e}function B(e){var t,o;const d=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();d&&d.internal.frames===0&&d.invalidate()}function ae(e){e.onUpdate==null||e.onUpdate(e)}function ze(e,t){e.manual||(Ae(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function K(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function gt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return q.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return q.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return q.ContinuousEventPriority;default:return q.DefaultEventPriority}}function Le(e,t,o,d){const u=o.get(t);u&&(o.delete(t),o.size===0&&(e.delete(d),u.target.releasePointerCapture(d)))}function _t(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(d=>d!==t),o.initialHits=o.initialHits.filter(d=>d!==t),o.hovered.forEach((d,u)=>{(d.eventObject===t||d.object===t)&&o.hovered.delete(u)}),o.capturedMap.forEach((d,u)=>{Le(o.capturedMap,t,d,u)})}function Bt(e){function t(s){const{internal:h}=e.getState(),r=s.offsetX-h.initialClick[0],n=s.offsetY-h.initialClick[1];return Math.round(Math.sqrt(r*r+n*n))}function o(s){return s.filter(h=>["Move","Over","Enter","Out","Leave"].some(r=>{var n;return(n=h.__r3f)==null?void 0:n.handlers["onPointer"+r]}))}function d(s,h){const r=e.getState(),n=new Set,c=[],l=h?h(r.internal.interaction):r.internal.interaction;for(let i=0;i<l.length;i++){const a=U(l[i]);a&&(a.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(s,r);function f(i){const a=U(i);if(!a||!a.events.enabled||a.raycaster.camera===null)return[];if(a.raycaster.camera===void 0){var v;a.events.compute==null||a.events.compute(s,a,(v=a.previousRoot)==null?void 0:v.getState()),a.raycaster.camera===void 0&&(a.raycaster.camera=null)}return a.raycaster.camera?a.raycaster.intersectObject(i,!0):[]}let _=l.flatMap(f).sort((i,a)=>{const v=U(i.object),b=U(a.object);return!v||!b?i.distance-a.distance:b.events.priority-v.events.priority||i.distance-a.distance}).filter(i=>{const a=K(i);return n.has(a)?!1:(n.add(a),!0)});r.events.filter&&(_=r.events.filter(_,r));for(const i of _){let a=i.object;for(;a;){var p;(p=a.__r3f)!=null&&p.eventCount&&c.push({...i,eventObject:a}),a=a.parent}}if("pointerId"in s&&r.internal.capturedMap.has(s.pointerId))for(let i of r.internal.capturedMap.get(s.pointerId).values())n.has(K(i.intersection))||c.push(i.intersection);return c}function u(s,h,r,n){const c=e.getState();if(s.length){const l={stopped:!1};for(const f of s){const _=U(f.object)||c,{raycaster:p,pointer:i,camera:a,internal:v}=_,b=new H(i.x,i.y,0).unproject(a),C=x=>{var w,P;return(w=(P=v.capturedMap.get(x))==null?void 0:P.has(f.eventObject))!=null?w:!1},S=x=>{const w={intersection:f,target:h.target};v.capturedMap.has(x)?v.capturedMap.get(x).set(f.eventObject,w):v.capturedMap.set(x,new Map([[f.eventObject,w]])),h.target.setPointerCapture(x)},O=x=>{const w=v.capturedMap.get(x);w&&Le(v.capturedMap,f.eventObject,w,x)};let R={};for(let x in h){let w=h[x];typeof w!="function"&&(R[x]=w)}let T={...f,...R,pointer:i,intersections:s,stopped:l.stopped,delta:r,unprojectedPoint:b,ray:p.ray,camera:a,stopPropagation(){const x="pointerId"in h&&v.capturedMap.get(h.pointerId);if((!x||x.has(f.eventObject))&&(T.stopped=l.stopped=!0,v.hovered.size&&Array.from(v.hovered.values()).find(w=>w.eventObject===f.eventObject))){const w=s.slice(0,s.indexOf(f));m([...w,f])}},target:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:O},currentTarget:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:O},nativeEvent:h};if(n(T),l.stopped===!0)break}}return s}function m(s){const{internal:h}=e.getState();for(const r of h.hovered.values())if(!s.length||!s.find(n=>n.object===r.object&&n.index===r.index&&n.instanceId===r.instanceId)){const c=r.eventObject.__r3f,l=c==null?void 0:c.handlers;if(h.hovered.delete(K(r)),c!=null&&c.eventCount){const f={...r,intersections:s};l.onPointerOut==null||l.onPointerOut(f),l.onPointerLeave==null||l.onPointerLeave(f)}}}function y(s,h){for(let r=0;r<h.length;r++){const n=h[r].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(s)}}function g(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>m([]);case"onLostPointerCapture":return h=>{const{internal:r}=e.getState();"pointerId"in h&&r.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(h.pointerId)&&(r.capturedMap.delete(h.pointerId),m([]))})}}return function(r){const{onPointerMissed:n,internal:c}=e.getState();c.lastEvent.current=r;const l=s==="onPointerMove",f=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",p=d(r,l?o:void 0),i=f?t(r):0;s==="onPointerDown"&&(c.initialClick=[r.offsetX,r.offsetY],c.initialHits=p.map(v=>v.eventObject)),f&&!p.length&&i<=2&&(y(r,c.interaction),n&&n(r)),l&&m(p);function a(v){const b=v.eventObject,C=b.__r3f,S=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(l){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const O=K(v),R=c.hovered.get(O);R?R.stopped&&v.stopPropagation():(c.hovered.set(O,v),S.onPointerOver==null||S.onPointerOver(v),S.onPointerEnter==null||S.onPointerEnter(v))}S.onPointerMove==null||S.onPointerMove(v)}else{const O=S[s];O?(!f||c.initialHits.includes(b))&&(y(r,c.interaction.filter(R=>!c.initialHits.includes(R))),O(v)):f&&c.initialHits.includes(b)&&y(r,c.interaction.filter(R=>!c.initialHits.includes(R)))}}u(p,r,i,a)}}return{handlePointer:g}}const yt=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Fe=e=>!!(e!=null&&e.render),ce=M.createContext(null),wt=(e,t)=>{const o=Re((g,s)=>{const h=new H,r=new H,n=new H;function c(i=s().camera,a=r,v=s().size){const{width:b,height:C,top:S,left:O}=v,R=b/C;a instanceof H?n.copy(a):n.set(...a);const T=i.getWorldPosition(h).distanceTo(n);if(Ae(i))return{width:b/i.zoom,height:C/i.zoom,top:S,left:O,factor:1,distance:T,aspect:R};{const x=i.fov*Math.PI/180,w=2*Math.tan(x/2)*T,P=w*(b/C);return{width:P,height:w,top:S,left:O,factor:b/P,distance:T,aspect:R}}}let l;const f=i=>g(a=>({performance:{...a.performance,current:i}})),_=new xe;return{set:g,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(i=1)=>e(s(),i),advance:(i,a)=>t(i,a,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new it,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const i=s();l&&clearTimeout(l),i.performance.current!==i.performance.min&&f(i.performance.min),l=setTimeout(()=>f(s().performance.max),i.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:i=>g(a=>({...a,events:{...a.events,...i}})),setSize:(i,a,v,b,C)=>{const S=s().camera,O={width:i,height:a,top:b||0,left:C||0,updateStyle:v};g(R=>({size:O,viewport:{...R.viewport,...c(S,r,O)}}))},setDpr:i=>g(a=>{const v=ke(i);return{viewport:{...a.viewport,dpr:v,initialDpr:a.viewport.initialDpr||v}}}),setFrameloop:(i="always")=>{const a=s().clock;a.stop(),a.elapsedTime=0,i!=="never"&&(a.start(),a.elapsedTime=0),g(()=>({frameloop:i}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:M.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(i,a,v)=>{const b=s().internal;return b.priority=b.priority+(a>0?1:0),b.subscribers.push({ref:i,priority:a,store:v}),b.subscribers=b.subscribers.sort((C,S)=>C.priority-S.priority),()=>{const C=s().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(a>0?1:0),C.subscribers=C.subscribers.filter(S=>S.ref!==i))}}}}}),d=o.getState();let u=d.size,m=d.viewport.dpr,y=d.camera;return o.subscribe(()=>{const{camera:g,size:s,viewport:h,gl:r,set:n}=o.getState();if(s.width!==u.width||s.height!==u.height||h.dpr!==m){var c;u=s,m=h.dpr,ze(g,s),r.setPixelRatio(h.dpr);const l=(c=s.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(s.width,s.height,l)}g!==y&&(y=g,n(l=>({viewport:{...l.viewport,...l.viewport.getCurrentViewport(g)}})))}),o.subscribe(g=>e(g)),o};function fe(e,t){const o={callback:e};return t.add(o),()=>void t.delete(o)}let Y,Ie=new Set,Be=new Set,He=new Set;const Ht=e=>fe(e,Ie),qt=e=>fe(e,Be),Nt=e=>fe(e,He);function re(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function $(e,t){switch(e){case"before":return re(Ie,t);case"after":return re(Be,t);case"tail":return re(He,t)}}let ne,oe;function ie(e,t,o){let d=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(d=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ne=t.internal.subscribers,Y=0;Y<ne.length;Y++)oe=ne[Y],oe.ref.current(oe.store.getState(),d,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function bt(e){let t=!1,o,d,u;function m(s){d=requestAnimationFrame(m),t=!0,o=0,$("before",s);for(const r of e.values()){var h;u=r.store.getState(),u.internal.active&&(u.frameloop==="always"||u.internal.frames>0)&&!((h=u.gl.xr)!=null&&h.isPresenting)&&(o+=ie(s,u))}if($("after",s),o===0)return $("tail",s),t=!1,cancelAnimationFrame(d)}function y(s,h=1){var r;if(!s)return e.forEach(n=>y(n.store.getState()),h);(r=s.gl.xr)!=null&&r.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+h),t||(t=!0,requestAnimationFrame(m)))}function g(s,h=!0,r,n){if(h&&$("before",s),r)ie(s,r,n);else for(const c of e.values())ie(s,c.store.getState());h&&$("after",s)}return{loop:m,invalidate:y,advance:g}}function Gt(e){const t=M.useRef(null);return W(()=>void(t.current=e.current.__r3f),[e]),t}function ue(){const e=M.useContext(ce);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Ut(e=o=>o,t){return ue()(e,t)}function $t(e,t=0){const o=ue(),d=o.getState().internal.subscribe,u=ut(e);return W(()=>d(u,t,o),[t,d,o]),null}const Ee=new WeakMap;function qe(e,t){return function(o,...d){let u=Ee.get(o);return u||(u=new o,Ee.set(o,u)),e&&e(u),Promise.all(d.map(m=>new Promise((y,g)=>u.load(m,s=>{s.scene&&Object.assign(s,vt(s.scene)),y(s)},t,s=>g(new Error(`Could not load ${m}: ${s==null?void 0:s.message}`)))))).finally(()=>u.dispose==null?void 0:u.dispose())}}function Ne(e,t,o,d){const u=Array.isArray(t)?t:[t],m=at(qe(o,d),[e,...u],{equal:E.equ});return Array.isArray(t)?m:m[0]}Ne.preload=function(e,t,o){const d=Array.isArray(t)?t:[t];return lt(qe(o),[e,...d])};Ne.clear=function(e,t){const o=Array.isArray(t)?t:[t];return ct([e,...o])};const N=new Map,{invalidate:Pe,advance:Me}=bt(N),{reconciler:V,applyProps:L}=ft(N,gt),F={objects:"shallow",strict:!1},Ct=(e,t)=>{const o=typeof e=="function"?e(t):e;return Fe(o)?o:new et({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function St(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:d,height:u,top:m,left:y,updateStyle:g=o}=t;return{width:d,height:u,top:m,left:y,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:d,height:u,top:m,left:y}=e.parentElement.getBoundingClientRect();return{width:d,height:u,top:m,left:y,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Vt(e){const t=N.get(e),o=t==null?void 0:t.fiber,d=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const u=typeof reportError=="function"?reportError:console.error,m=d||wt(Pe,Me),y=o||V.createContainer(m,q.ConcurrentRoot,null,!1,null,"",u,null);t||N.set(e,{fiber:y,store:m});let g,s=!1,h;return{configure(r={}){let{gl:n,size:c,scene:l,events:f,onCreated:_,shadows:p=!1,linear:i=!1,flat:a=!1,legacy:v=!1,orthographic:b=!1,frameloop:C="always",dpr:S=[1,2],performance:O,raycaster:R,camera:T,onPointerMissed:x}=r,w=m.getState(),P=w.gl;w.gl||w.set({gl:P=Ct(n,e)});let D=w.raycaster;D||w.set({raycaster:D=new Oe});const{params:de,...pe}=R||{};if(E.equ(pe,D,F)||L(D,{...pe}),E.equ(de,D.params,F)||L(D,{params:{...D.params,...de}}),!w.camera||w.camera===h&&!E.equ(h,T,F)){h=T;const j=T instanceof tt,k=j?T:b?new Ye(0,0,0,0,.1,1e3):new Je(75,0,.1,1e3);j||(k.position.z=5,T&&L(k,T),!w.camera&&!(T!=null&&T.rotation)&&k.lookAt(0,0,0)),w.set({camera:k}),D.camera=k}if(!w.scene){let j;l instanceof ge?j=l:(j=new ge,l&&L(j,l)),w.set({scene:I(j)})}if(!w.xr){var ve;const j=(A,Ge)=>{const he=m.getState();he.frameloop!=="never"&&Me(A,!0,he,Ge)},k=()=>{const A=m.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?j:null),A.gl.xr.isPresenting||Pe(A)},X={connect(){const A=m.getState().gl;A.xr.addEventListener("sessionstart",k),A.xr.addEventListener("sessionend",k)},disconnect(){const A=m.getState().gl;A.xr.removeEventListener("sessionstart",k),A.xr.removeEventListener("sessionend",k)}};typeof((ve=P.xr)==null?void 0:ve.addEventListener)=="function"&&X.connect(),w.set({xr:X})}if(P.shadowMap){const j=P.shadowMap.enabled,k=P.shadowMap.type;if(P.shadowMap.enabled=!!p,E.boo(p))P.shadowMap.type=Q;else if(E.str(p)){var me;const X={basic:rt,percentage:nt,soft:Q,variance:ot};P.shadowMap.type=(me=X[p])!=null?me:Q}else E.obj(p)&&Object.assign(P.shadowMap,p);(j!==P.shadowMap.enabled||k!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}const G=Te();G&&("enabled"in G?G.enabled=!v:"legacyMode"in G&&(G.legacyMode=v)),L(P,{outputEncoding:i?3e3:3001,toneMapping:a?Qe:Ze}),w.legacy!==v&&w.set(()=>({legacy:v})),w.linear!==i&&w.set(()=>({linear:i})),w.flat!==a&&w.set(()=>({flat:a})),n&&!E.fun(n)&&!Fe(n)&&!E.equ(n,P,F)&&L(P,n),f&&!w.events.handlers&&w.set({events:f(m)});const z=St(e,c);return E.equ(z,w.size,F)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),S&&w.viewport.dpr!==ke(S)&&w.setDpr(S),w.frameloop!==C&&w.setFrameloop(C),w.onPointerMissed||w.set({onPointerMissed:x}),O&&!E.equ(O,w.performance,F)&&w.set(j=>({performance:{...j.performance,...O}})),g=_,s=!0,this},render(r){return s||this.configure(),V.updateContainer(M.createElement(Et,{store:m,children:r,onCreated:g,rootElement:e}),y,null,()=>{}),m},unmount(){Pt(e)}}}function Et({store:e,children:t,onCreated:o,rootElement:d}){return W(()=>{const u=e.getState();u.set(m=>({internal:{...m.internal,active:!0}})),o&&o(u),e.getState().events.connected||u.events.connect==null||u.events.connect(d)},[]),M.createElement(ce.Provider,{value:e},t)}function Pt(e,t){const o=N.get(e),d=o==null?void 0:o.fiber;if(d){const u=o==null?void 0:o.store.getState();u&&(u.internal.active=!1),V.updateContainer(null,d,null,()=>{u&&setTimeout(()=>{try{var m,y,g,s;u.events.disconnect==null||u.events.disconnect(),(m=u.gl)==null||(y=m.renderLists)==null||y.dispose==null||y.dispose(),(g=u.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(s=u.gl)!=null&&s.xr&&u.xr.disconnect(),mt(u),N.delete(e),t&&t(e)}catch{}},500)})}}function Wt(e,t,o){return M.createElement(Mt,{key:t.uuid,children:e,container:t,state:o})}function Mt({state:e={},children:t,container:o}){const{events:d,size:u,...m}=e,y=ue(),[g]=M.useState(()=>new Oe),[s]=M.useState(()=>new xe),h=M.useCallback((n,c)=>{const l={...n};Object.keys(n).forEach(_=>{(yt.includes(_)||n[_]!==c[_]&&c[_])&&delete l[_]});let f;if(c&&u){const _=c.camera;f=n.viewport.getCurrentViewport(_,new H,u),_!==n.camera&&ze(_,u)}return{...l,scene:o,raycaster:g,pointer:s,mouse:s,previousRoot:y,events:{...n.events,...c==null?void 0:c.events,...d},size:{...n.size,...u},viewport:{...n.viewport,...f},...m}},[e]),[r]=M.useState(()=>{const n=y.getState();return Re((l,f)=>({...n,scene:o,raycaster:g,pointer:s,mouse:s,previousRoot:y,events:{...n.events,...d},size:{...n.size,...u},...m,set:l,get:f,setEvents:_=>l(p=>({...p,events:{...p.events,..._}}))}))});return M.useEffect(()=>{const n=y.subscribe(c=>r.setState(l=>h(c,l)));return()=>{n(),r.destroy()}},[]),M.useEffect(()=>{r.setState(n=>h(y.getState(),n))},[h]),M.createElement(M.Fragment,null,V.createPortal(M.createElement(ce.Provider,{value:r},t),r,null))}V.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:M.version});export{It as B,dt as E,$t as a,Ht as b,Wt as c,qt as d,Lt as e,Ne as f,ut as g,W as h,Vt as i,Ft as j,Pt as k,Bt as l,Gt as m,Nt as n,Ut as u};
//# sourceMappingURL=index-db8af450.esm.js.eaJ-IQWK.js.map

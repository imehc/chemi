import{J as Q,T as $e,R as We,f as Xe,K as Re,G as je,V as H,X as Ke,Y as Ye,q as Je,O as Ze,A as Qe,S as ye,Z as ee,_ as et,$ as tt,a as rt,a0 as nt,a1 as ot,a2 as it,a3 as st,a4 as at}from"../../../three/build/three.module.js.jQmR1wrA.js";import{r as j}from"../../../react/index.js.IuPGg7Py.js";import{c as q}from"../../../react-reconciler/constants.js.cziiqKC3.js";import{c as Te}from"../../../zustand/esm/index.js.Cv_BSyMC.js";import{R as lt}from"../../../react-reconciler/index.js.DwfphOJC.js";import{s as we}from"../../../scheduler/index.js.DPKlw4YW.js";import{s as ct,p as ft,c as ut}from"../../../suspend-react/index.js.BKIKQNXN.js";import{j as N}from"../../../react/jsx-runtime.js.Cm6upDnr.js";const fe={},Ft=e=>void Object.assign(fe,e);function dt(e,r){function o(t,{args:n=[],attach:i,...f},p){let h=`${t[0].toUpperCase()}${t.slice(1)}`,u;if(t==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=f.object;u=I(s,{type:t,root:p,attach:i,primitive:!0})}else{const s=fe[h];if(!s)throw new Error(`R3F: ${h} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");u=I(new s(...n),{type:t,root:p,attach:i,memoizedProps:{args:n}})}return u.__r3f.attach===void 0&&(u instanceof Ke?u.__r3f.attach="geometry":u instanceof Ye&&(u.__r3f.attach="material")),h!=="inject"&&ne(u,f),u}function a(t,n){let i=!1;if(n){var f,p;(f=n.__r3f)!=null&&f.attach?re(t,n,n.__r3f.attach):n.isObject3D&&t.isObject3D&&(t.add(n),i=!0),i||(p=t.__r3f)==null||p.objects.push(n),n.__r3f||I(n,{}),n.__r3f.parent=t,ce(n),B(n)}}function d(t,n,i){let f=!1;if(n){var p,h;if((p=n.__r3f)!=null&&p.attach)re(t,n,n.__r3f.attach);else if(n.isObject3D&&t.isObject3D){n.parent=t,n.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:n});const u=t.children.filter(c=>c!==n),s=u.indexOf(i);t.children=[...u.slice(0,s),n,...u.slice(s)],f=!0}f||(h=t.__r3f)==null||h.objects.push(n),n.__r3f||I(n,{}),n.__r3f.parent=t,ce(n),B(n)}}function v(t,n,i=!1){t&&[...t].forEach(f=>w(n,f,i))}function w(t,n,i){if(n){var f,p,h;if(n.__r3f&&(n.__r3f.parent=null),(f=t.__r3f)!=null&&f.objects&&(t.__r3f.objects=t.__r3f.objects.filter(b=>b!==n)),(p=n.__r3f)!=null&&p.attach)Pe(t,n,n.__r3f.attach);else if(n.isObject3D&&t.isObject3D){var u;t.remove(n),(u=n.__r3f)!=null&&u.root&&wt(Z(n),n)}const c=(h=n.__r3f)==null?void 0:h.primitive,_=!c&&(i===void 0?n.dispose!==null:i);if(!c){var s;v((s=n.__r3f)==null?void 0:s.objects,n,_),v(n.children,n,_)}if(delete n.__r3f,_&&n.dispose&&n.type!=="Scene"){const b=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?we.unstable_scheduleCallback(we.unstable_IdlePriority,b):b()}B(t)}}function g(t,n,i,f){var p;const h=(p=t.__r3f)==null?void 0:p.parent;if(!h)return;const u=o(n,i,t.__r3f.root);if(t.children){for(const s of t.children)s.__r3f&&a(u,s);t.children=t.children.filter(s=>!s.__r3f)}t.__r3f.objects.forEach(s=>a(u,s)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||w(h,t),u.parent&&(u.__r3f.autoRemovedBeforeAppend=!0),a(h,u),u.raycast&&u.__r3f.eventCount&&Z(u).getState().internal.interaction.push(u),[f,f.alternate].forEach(s=>{s!==null&&(s.stateNode=u,s.ref&&(typeof s.ref=="function"?s.ref(u):s.ref.current=u))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:lt({createInstance:o,removeChild:w,appendChild:a,appendInitialChild:a,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,n)=>{if(!n)return;const i=t.getState().scene;i.__r3f&&(i.__r3f.root=t,a(i,n))},removeChildFromContainer:(t,n)=>{n&&w(t.getState().scene,n)},insertInContainerBefore:(t,n,i)=>{if(!n||!i)return;const f=t.getState().scene;f.__r3f&&d(f,n,i)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var n;return!!((n=t==null?void 0:t.__r3f)!=null?n:{}).handlers},prepareUpdate(t,n,i,f){var p;if(((p=t==null?void 0:t.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==t)return[!0];{const{args:u=[],children:s,...c}=f,{args:_=[],children:b,...S}=i;if(!Array.isArray(u))throw new Error("R3F: the args prop must be an array!");if(u.some((M,R)=>M!==_[R]))return[!0];const C=Le(t,c,S,!0);return C.changes.length?[!1,C]:null}},commitUpdate(t,[n,i],f,p,h,u){n?g(t,f,h,u):ne(t,i)},commitMount(t,n,i,f){var p;const h=(p=t.__r3f)!=null?p:{};t.raycast&&h.handlers&&h.eventCount&&Z(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>I(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var n;const{attach:i,parent:f}=(n=t.__r3f)!=null?n:{};i&&f&&Pe(f,t,i),t.isObject3D&&(t.visible=!1),B(t)},unhideInstance(t,n){var i;const{attach:f,parent:p}=(i=t.__r3f)!=null?i:{};f&&p&&re(p,t,f),(t.isObject3D&&n.visible==null||n.visible)&&(t.visible=!0),B(t)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>r?r():q.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&E.fun(performance.now)?performance.now:E.fun(Date.now)?Date.now:()=>0,scheduleTimeout:E.fun(setTimeout)?setTimeout:void 0,cancelTimeout:E.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ne}}var be,Ce;const te=e=>"colorSpace"in e||"outputColorSpace"in e,Ae=()=>{var e;return(e=fe.ColorManagement)!=null?e:null},ke=e=>e&&e.isOrthographicCamera,It=e=>e&&e.hasOwnProperty("current"),X=typeof window<"u"&&((be=window.document)!=null&&be.createElement||((Ce=window.navigator)==null?void 0:Ce.product)==="ReactNative")?j.useLayoutEffect:j.useEffect;function pt(e){const r=j.useRef(e);return X(()=>void(r.current=e),[e]),r}function Bt({set:e}){return X(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class vt extends j.Component{constructor(...r){super(...r),this.state={error:!1}}componentDidCatch(r){this.props.set(r)}render(){return this.state.error?null:this.props.children}}vt.getDerivedStateFromError=()=>({error:!0});const De="__default",Se=new Map,mt=e=>e&&!!e.memoized&&!!e.changes;function ze(e){var r;const o=typeof window<"u"?(r=window.devicePixelRatio)!=null?r:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const V=e=>{var r;return(r=e.__r3f)==null?void 0:r.root.getState()};function Z(e){let r=e.__r3f.root;for(;r.getState().previousRoot;)r=r.getState().previousRoot;return r}const E={obj:e=>e===Object(e)&&!E.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,r,{arrays:o="shallow",objects:a="reference",strict:d=!0}={}){if(typeof e!=typeof r||!!e!=!!r)return!1;if(E.str(e)||E.num(e))return e===r;const v=E.obj(e);if(v&&a==="reference")return e===r;const w=E.arr(e);if(w&&o==="reference")return e===r;if((w||v)&&e===r)return!0;let g;for(g in e)if(!(g in r))return!1;if(v&&o==="shallow"&&a==="shallow"){for(g in d?r:e)if(!E.equ(e[g],r[g],{strict:d,objects:"reference"}))return!1}else for(g in d?r:e)if(e[g]!==r[g])return!1;if(E.und(g)){if(w&&e.length===0&&r.length===0||v&&Object.keys(e).length===0&&Object.keys(r).length===0)return!0;if(e!==r)return!1}return!0}};function ht(e){const r={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(r.nodes[o.name]=o),o.material&&!r.materials[o.material.name]&&(r.materials[o.material.name]=o.material)}),r}function gt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const r in e)r.dispose==null||r.dispose(),delete e[r]}function I(e,r){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...r},e}function le(e,r){let o=e;if(r.includes("-")){const a=r.split("-"),d=a.pop();return o=a.reduce((v,w)=>v[w],e),{target:o,key:d}}else return{target:o,key:r}}const Ee=/-\d+$/;function re(e,r,o){if(E.str(o)){if(Ee.test(o)){const v=o.replace(Ee,""),{target:w,key:g}=le(e,v);Array.isArray(w[g])||(w[g]=[])}const{target:a,key:d}=le(e,o);r.__r3f.previousAttach=a[d],a[d]=r}else r.__r3f.previousAttach=o(e,r)}function Pe(e,r,o){var a,d;if(E.str(o)){const{target:v,key:w}=le(e,o),g=r.__r3f.previousAttach;g===void 0?delete v[w]:v[w]=g}else(a=r.__r3f)==null||a.previousAttach==null||a.previousAttach(e,r);(d=r.__r3f)==null||delete d.previousAttach}function Le(e,{children:r,key:o,ref:a,...d},{children:v,key:w,ref:g,...l}={},m=!1){const t=e.__r3f,n=Object.entries(d),i=[];if(m){const p=Object.keys(l);for(let h=0;h<p.length;h++)d.hasOwnProperty(p[h])||n.unshift([p[h],De+"remove"])}n.forEach(([p,h])=>{var u;if((u=e.__r3f)!=null&&u.primitive&&p==="object"||E.equ(h,l[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return i.push([p,h,!0,[]]);let s=[];p.includes("-")&&(s=p.split("-")),i.push([p,h,!1,s]);for(const c in d){const _=d[c];c.startsWith(`${p}-`)&&i.push([c,_,!1,c.split("-")])}});const f={...d};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(f.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(f.attach=t.memoizedProps.attach),{memoized:f,changes:i}}const _t=typeof process<"u"&&!1;function ne(e,r){var o;const a=e.__r3f,d=a==null?void 0:a.root,v=d==null||d.getState==null?void 0:d.getState(),{memoized:w,changes:g}=mt(r)?r:Le(e,r),l=a==null?void 0:a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=w);for(let t=0;t<g.length;t++){let[n,i,f,p]=g[t];if(te(e)){const c="srgb",_="srgb-linear";n==="encoding"?(n="colorSpace",i=i===3001?c:_):n==="outputEncoding"&&(n="outputColorSpace",i=i===3001?c:_)}let h=e,u=h[n];if(p.length&&(u=p.reduce((s,c)=>s[c],e),!(u&&u.set))){const[s,...c]=p.reverse();h=c.reverse().reduce((_,b)=>_[b],e),n=s}if(i===De+"remove")if(h.constructor){let s=Se.get(h.constructor);s||(s=new h.constructor,Se.set(h.constructor,s)),i=s[n]}else i=0;if(f&&a)i?a.handlers[n]=i:delete a.handlers[n],a.eventCount=Object.keys(a.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Q)){if(Array.isArray(i))u.fromArray?u.fromArray(i):u.set(...i);else if(u.copy&&i&&i.constructor&&(_t?u.constructor.name===i.constructor.name:u.constructor===i.constructor))u.copy(i);else if(i!==void 0){const s=u instanceof Je;!s&&u.setScalar?u.setScalar(i):u instanceof Q&&i instanceof Q?u.mask=i.mask:u.set(i),!Ae()&&v&&!v.linear&&s&&u.convertSRGBToLinear()}}else if(h[n]=i,h[n]instanceof $e&&h[n].format===We&&h[n].type===Xe&&v){const s=h[n];te(s)&&te(v.gl)?s.colorSpace=v.gl.outputColorSpace:s.encoding=v.gl.outputEncoding}B(e)}if(a&&a.parent&&e.raycast&&l!==a.eventCount){const t=Z(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),a.eventCount&&t.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(o=e.__r3f)!=null&&o.parent&&ce(e),e}function B(e){var r,o;const a=(r=e.__r3f)==null||(o=r.root)==null||o.getState==null?void 0:o.getState();a&&a.internal.frames===0&&a.invalidate()}function ce(e){e.onUpdate==null||e.onUpdate(e)}function Fe(e,r){e.manual||(ke(e)?(e.left=r.width/-2,e.right=r.width/2,e.top=r.height/2,e.bottom=r.height/-2):e.aspect=r.width/r.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Y(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function yt(){var e;const r=typeof self<"u"&&self||typeof window<"u"&&window;if(!r)return q.DefaultEventPriority;switch((e=r.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return q.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return q.ContinuousEventPriority;default:return q.DefaultEventPriority}}function Ie(e,r,o,a){const d=o.get(r);d&&(o.delete(r),o.size===0&&(e.delete(a),d.target.releasePointerCapture(a)))}function wt(e,r){const{internal:o}=e.getState();o.interaction=o.interaction.filter(a=>a!==r),o.initialHits=o.initialHits.filter(a=>a!==r),o.hovered.forEach((a,d)=>{(a.eventObject===r||a.object===r)&&o.hovered.delete(d)}),o.capturedMap.forEach((a,d)=>{Ie(o.capturedMap,r,a,d)})}function Ht(e){function r(l){const{internal:m}=e.getState(),t=l.offsetX-m.initialClick[0],n=l.offsetY-m.initialClick[1];return Math.round(Math.sqrt(t*t+n*n))}function o(l){return l.filter(m=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return(n=m.__r3f)==null?void 0:n.handlers["onPointer"+t]}))}function a(l,m){const t=e.getState(),n=new Set,i=[],f=m?m(t.internal.interaction):t.internal.interaction;for(let s=0;s<f.length;s++){const c=V(f[s]);c&&(c.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(l,t);function p(s){const c=V(s);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var _;c.events.compute==null||c.events.compute(l,c,(_=c.previousRoot)==null?void 0:_.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(s,!0):[]}let h=f.flatMap(p).sort((s,c)=>{const _=V(s.object),b=V(c.object);return!_||!b?s.distance-c.distance:b.events.priority-_.events.priority||s.distance-c.distance}).filter(s=>{const c=Y(s);return n.has(c)?!1:(n.add(c),!0)});t.events.filter&&(h=t.events.filter(h,t));for(const s of h){let c=s.object;for(;c;){var u;(u=c.__r3f)!=null&&u.eventCount&&i.push({...s,eventObject:c}),c=c.parent}}if("pointerId"in l&&t.internal.capturedMap.has(l.pointerId))for(let s of t.internal.capturedMap.get(l.pointerId).values())n.has(Y(s.intersection))||i.push(s.intersection);return i}function d(l,m,t,n){const i=e.getState();if(l.length){const f={stopped:!1};for(const p of l){const h=V(p.object)||i,{raycaster:u,pointer:s,camera:c,internal:_}=h,b=new H(s.x,s.y,0).unproject(c),S=O=>{var y,P;return(y=(P=_.capturedMap.get(O))==null?void 0:P.has(p.eventObject))!=null?y:!1},C=O=>{const y={intersection:p,target:m.target};_.capturedMap.has(O)?_.capturedMap.get(O).set(p.eventObject,y):_.capturedMap.set(O,new Map([[p.eventObject,y]])),m.target.setPointerCapture(O)},M=O=>{const y=_.capturedMap.get(O);y&&Ie(_.capturedMap,p.eventObject,y,O)};let R={};for(let O in m){let y=m[O];typeof y!="function"&&(R[O]=y)}let x={...p,...R,pointer:s,intersections:l,stopped:f.stopped,delta:t,unprojectedPoint:b,ray:u.ray,camera:c,stopPropagation(){const O="pointerId"in m&&_.capturedMap.get(m.pointerId);if((!O||O.has(p.eventObject))&&(x.stopped=f.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(y=>y.eventObject===p.eventObject))){const y=l.slice(0,l.indexOf(p));v([...y,p])}},target:{hasPointerCapture:S,setPointerCapture:C,releasePointerCapture:M},currentTarget:{hasPointerCapture:S,setPointerCapture:C,releasePointerCapture:M},nativeEvent:m};if(n(x),f.stopped===!0)break}}return l}function v(l){const{internal:m}=e.getState();for(const t of m.hovered.values())if(!l.length||!l.find(n=>n.object===t.object&&n.index===t.index&&n.instanceId===t.instanceId)){const i=t.eventObject.__r3f,f=i==null?void 0:i.handlers;if(m.hovered.delete(Y(t)),i!=null&&i.eventCount){const p={...t,intersections:l};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function w(l,m){for(let t=0;t<m.length;t++){const n=m[t].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(l)}}function g(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return m=>{const{internal:t}=e.getState();"pointerId"in m&&t.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(m.pointerId)&&(t.capturedMap.delete(m.pointerId),v([]))})}}return function(t){const{onPointerMissed:n,internal:i}=e.getState();i.lastEvent.current=t;const f=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",u=a(t,f?o:void 0),s=p?r(t):0;l==="onPointerDown"&&(i.initialClick=[t.offsetX,t.offsetY],i.initialHits=u.map(_=>_.eventObject)),p&&!u.length&&s<=2&&(w(t,i.interaction),n&&n(t)),f&&v(u);function c(_){const b=_.eventObject,S=b.__r3f,C=S==null?void 0:S.handlers;if(S!=null&&S.eventCount)if(f){if(C.onPointerOver||C.onPointerEnter||C.onPointerOut||C.onPointerLeave){const M=Y(_),R=i.hovered.get(M);R?R.stopped&&_.stopPropagation():(i.hovered.set(M,_),C.onPointerOver==null||C.onPointerOver(_),C.onPointerEnter==null||C.onPointerEnter(_))}C.onPointerMove==null||C.onPointerMove(_)}else{const M=C[l];M?(!p||i.initialHits.includes(b))&&(w(t,i.interaction.filter(R=>!i.initialHits.includes(R))),M(_)):p&&i.initialHits.includes(b)&&w(t,i.interaction.filter(R=>!i.initialHits.includes(R)))}}d(u,t,s,c)}}return{handlePointer:g}}const bt=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Be=e=>!!(e!=null&&e.render),ue=j.createContext(null),Ct=(e,r)=>{const o=Te((g,l)=>{const m=new H,t=new H,n=new H;function i(s=l().camera,c=t,_=l().size){const{width:b,height:S,top:C,left:M}=_,R=b/S;c instanceof H?n.copy(c):n.set(...c);const x=s.getWorldPosition(m).distanceTo(n);if(ke(s))return{width:b/s.zoom,height:S/s.zoom,top:C,left:M,factor:1,distance:x,aspect:R};{const O=s.fov*Math.PI/180,y=2*Math.tan(O/2)*x,P=y*(b/S);return{width:P,height:y,top:C,left:M,factor:b/P,distance:x,aspect:R}}}let f;const p=s=>g(c=>({performance:{...c.performance,current:s}})),h=new je;return{set:g,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(l(),s),advance:(s,c)=>r(s,c,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new at,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=l();f&&clearTimeout(f),s.performance.current!==s.performance.min&&p(s.performance.min),f=setTimeout(()=>p(l().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:i},setEvents:s=>g(c=>({...c,events:{...c.events,...s}})),setSize:(s,c,_,b,S)=>{const C=l().camera,M={width:s,height:c,top:b||0,left:S||0,updateStyle:_};g(R=>({size:M,viewport:{...R.viewport,...i(C,t,M)}}))},setDpr:s=>g(c=>{const _=ze(s);return{viewport:{...c.viewport,dpr:_,initialDpr:c.viewport.initialDpr||_}}}),setFrameloop:(s="always")=>{const c=l().clock;c.stop(),c.elapsedTime=0,s!=="never"&&(c.start(),c.elapsedTime=0),g(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:j.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,c,_)=>{const b=l().internal;return b.priority=b.priority+(c>0?1:0),b.subscribers.push({ref:s,priority:c,store:_}),b.subscribers=b.subscribers.sort((S,C)=>S.priority-C.priority),()=>{const S=l().internal;S!=null&&S.subscribers&&(S.priority=S.priority-(c>0?1:0),S.subscribers=S.subscribers.filter(C=>C.ref!==s))}}}}}),a=o.getState();let d=a.size,v=a.viewport.dpr,w=a.camera;return o.subscribe(()=>{const{camera:g,size:l,viewport:m,gl:t,set:n}=o.getState();if(l.width!==d.width||l.height!==d.height||m.dpr!==v){var i;d=l,v=m.dpr,Fe(g,l),t.setPixelRatio(m.dpr);const f=(i=l.updateStyle)!=null?i:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(l.width,l.height,f)}g!==w&&(w=g,n(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(g)}})))}),o.subscribe(g=>e(g)),o};function de(e,r){const o={callback:e};return r.add(o),()=>void r.delete(o)}let J,He=new Set,qe=new Set,Ne=new Set;const qt=e=>de(e,He),Nt=e=>de(e,qe),Gt=e=>de(e,Ne);function oe(e,r){if(e.size)for(const{callback:o}of e.values())o(r)}function $(e,r){switch(e){case"before":return oe(He,r);case"after":return oe(qe,r);case"tail":return oe(Ne,r)}}let ie,se;function ae(e,r,o){let a=r.clock.getDelta();for(r.frameloop==="never"&&typeof e=="number"&&(a=e-r.clock.elapsedTime,r.clock.oldTime=r.clock.elapsedTime,r.clock.elapsedTime=e),ie=r.internal.subscribers,J=0;J<ie.length;J++)se=ie[J],se.ref.current(se.store.getState(),a,o);return!r.internal.priority&&r.gl.render&&r.gl.render(r.scene,r.camera),r.internal.frames=Math.max(0,r.internal.frames-1),r.frameloop==="always"?1:r.internal.frames}function St(e){let r=!1,o=!1,a,d,v;function w(m){d=requestAnimationFrame(w),r=!0,a=0,$("before",m),o=!0;for(const n of e.values()){var t;v=n.store.getState(),v.internal.active&&(v.frameloop==="always"||v.internal.frames>0)&&!((t=v.gl.xr)!=null&&t.isPresenting)&&(a+=ae(m,v))}if(o=!1,$("after",m),a===0)return $("tail",m),r=!1,cancelAnimationFrame(d)}function g(m,t=1){var n;if(!m)return e.forEach(i=>g(i.store.getState(),t));(n=m.gl.xr)!=null&&n.isPresenting||!m.internal.active||m.frameloop==="never"||(t>1?m.internal.frames=Math.min(60,m.internal.frames+t):o?m.internal.frames=2:m.internal.frames=1,r||(r=!0,requestAnimationFrame(w)))}function l(m,t=!0,n,i){if(t&&$("before",m),n)ae(m,n,i);else for(const f of e.values())ae(m,f.store.getState());t&&$("after",m)}return{loop:w,invalidate:g,advance:l}}function Ut(e){const r=j.useRef(null);return X(()=>void(r.current=e.current.__r3f),[e]),r}function pe(){const e=j.useContext(ue);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Vt(e=o=>o,r){return pe()(e,r)}function $t(e,r=0){const o=pe(),a=o.getState().internal.subscribe,d=pt(e);return X(()=>a(d,r,o),[r,a,o]),null}const Me=new WeakMap;function Ge(e,r){return function(o,...a){let d=Me.get(o);return d||(d=new o,Me.set(o,d)),e&&e(d),Promise.all(a.map(v=>new Promise((w,g)=>d.load(v,l=>{l.scene&&Object.assign(l,ht(l.scene)),w(l)},r,l=>g(new Error(`Could not load ${v}: ${l==null?void 0:l.message}`))))))}}function Ue(e,r,o,a){const d=Array.isArray(r)?r:[r],v=ct(Ge(o,a),[e,...d],{equal:E.equ});return Array.isArray(r)?v:v[0]}Ue.preload=function(e,r,o){const a=Array.isArray(r)?r:[r];return ft(Ge(o),[e,...a])};Ue.clear=function(e,r){const o=Array.isArray(r)?r:[r];return ut([e,...o])};const G=new Map,{invalidate:xe,advance:Oe}=St(G),{reconciler:W,applyProps:L}=dt(G,yt),F={objects:"shallow",strict:!1},Et=(e,r)=>{const o=typeof e=="function"?e(r):e;return Be(o)?o:new rt({powerPreference:"high-performance",canvas:r,antialias:!0,alpha:!0,...e})};function Pt(e,r){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(r){const{width:a,height:d,top:v,left:w,updateStyle:g=o}=r;return{width:a,height:d,top:v,left:w,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:a,height:d,top:v,left:w}=e.parentElement.getBoundingClientRect();return{width:a,height:d,top:v,left:w,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Wt(e){const r=G.get(e),o=r==null?void 0:r.fiber,a=r==null?void 0:r.store;r&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,v=a||Ct(xe,Oe),w=o||W.createContainer(v,q.ConcurrentRoot,null,!1,null,"",d,null);r||G.set(e,{fiber:w,store:v});let g,l=!1,m;return{configure(t={}){let{gl:n,size:i,scene:f,events:p,onCreated:h,shadows:u=!1,linear:s=!1,flat:c=!1,legacy:_=!1,orthographic:b=!1,frameloop:S="always",dpr:C=[1,2],performance:M,raycaster:R,camera:x,onPointerMissed:O}=t,y=v.getState(),P=y.gl;y.gl||y.set({gl:P=Et(n,e)});let D=y.raycaster;D||y.set({raycaster:D=new Re});const{params:ve,...me}=R||{};if(E.equ(me,D,F)||L(D,{...me}),E.equ(ve,D.params,F)||L(D,{params:{...D.params,...ve}}),!y.camera||y.camera===m&&!E.equ(m,x,F)){m=x;const A=x instanceof nt,T=A?x:b?new Ze(0,0,0,0,.1,1e3):new Qe(75,0,.1,1e3);A||(T.position.z=5,x&&(L(T,x),("aspect"in x||"left"in x||"right"in x||"bottom"in x||"top"in x)&&(T.manual=!0,T.updateProjectionMatrix())),!y.camera&&!(x!=null&&x.rotation)&&T.lookAt(0,0,0)),y.set({camera:T}),D.camera=T}if(!y.scene){let A;f instanceof ye?A=f:(A=new ye,f&&L(A,f)),y.set({scene:I(A)})}if(!y.xr){var he;const A=(k,Ve)=>{const _e=v.getState();_e.frameloop!=="never"&&Oe(k,!0,_e,Ve)},T=()=>{const k=v.getState();k.gl.xr.enabled=k.gl.xr.isPresenting,k.gl.xr.setAnimationLoop(k.gl.xr.isPresenting?A:null),k.gl.xr.isPresenting||xe(k)},K={connect(){const k=v.getState().gl;k.xr.addEventListener("sessionstart",T),k.xr.addEventListener("sessionend",T)},disconnect(){const k=v.getState().gl;k.xr.removeEventListener("sessionstart",T),k.xr.removeEventListener("sessionend",T)}};typeof((he=P.xr)==null?void 0:he.addEventListener)=="function"&&K.connect(),y.set({xr:K})}if(P.shadowMap){const A=P.shadowMap.enabled,T=P.shadowMap.type;if(P.shadowMap.enabled=!!u,E.boo(u))P.shadowMap.type=ee;else if(E.str(u)){var ge;const K={basic:ot,percentage:it,soft:ee,variance:st};P.shadowMap.type=(ge=K[u])!=null?ge:ee}else E.obj(u)&&Object.assign(P.shadowMap,u);(A!==P.shadowMap.enabled||T!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}const U=Ae();U&&("enabled"in U?U.enabled=!_:"legacyMode"in U&&(U.legacyMode=_)),l||L(P,{outputEncoding:s?3e3:3001,toneMapping:c?et:tt}),y.legacy!==_&&y.set(()=>({legacy:_})),y.linear!==s&&y.set(()=>({linear:s})),y.flat!==c&&y.set(()=>({flat:c})),n&&!E.fun(n)&&!Be(n)&&!E.equ(n,P,F)&&L(P,n),p&&!y.events.handlers&&y.set({events:p(v)});const z=Pt(e,i);return E.equ(z,y.size,F)||y.setSize(z.width,z.height,z.updateStyle,z.top,z.left),C&&y.viewport.dpr!==ze(C)&&y.setDpr(C),y.frameloop!==S&&y.setFrameloop(S),y.onPointerMissed||y.set({onPointerMissed:O}),M&&!E.equ(M,y.performance,F)&&y.set(A=>({performance:{...A.performance,...M}})),g=h,l=!0,this},render(t){return l||this.configure(),W.updateContainer(N.jsx(Mt,{store:v,children:t,onCreated:g,rootElement:e}),w,null,()=>{}),v},unmount(){xt(e)}}}function Mt({store:e,children:r,onCreated:o,rootElement:a}){return X(()=>{const d=e.getState();d.set(v=>({internal:{...v.internal,active:!0}})),o&&o(d),e.getState().events.connected||d.events.connect==null||d.events.connect(a)},[]),N.jsx(ue.Provider,{value:e,children:r})}function xt(e,r){const o=G.get(e),a=o==null?void 0:o.fiber;if(a){const d=o==null?void 0:o.store.getState();d&&(d.internal.active=!1),W.updateContainer(null,a,null,()=>{d&&setTimeout(()=>{try{var v,w,g,l;d.events.disconnect==null||d.events.disconnect(),(v=d.gl)==null||(w=v.renderLists)==null||w.dispose==null||w.dispose(),(g=d.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(l=d.gl)!=null&&l.xr&&d.xr.disconnect(),gt(d),G.delete(e)}catch{}},500)})}}function Xt(e,r,o){return N.jsx(Ot,{children:e,container:r,state:o},r.uuid)}function Ot({state:e={},children:r,container:o}){const{events:a,size:d,...v}=e,w=pe(),[g]=j.useState(()=>new Re),[l]=j.useState(()=>new je),m=j.useCallback((n,i)=>{const f={...n};Object.keys(n).forEach(h=>{(bt.includes(h)||n[h]!==i[h]&&i[h])&&delete f[h]});let p;if(i&&d){const h=i.camera;p=n.viewport.getCurrentViewport(h,new H,d),h!==n.camera&&Fe(h,d)}return{...f,scene:o,raycaster:g,pointer:l,mouse:l,previousRoot:w,events:{...n.events,...i==null?void 0:i.events,...a},size:{...n.size,...d},viewport:{...n.viewport,...p},...v}},[e]),[t]=j.useState(()=>{const n=w.getState();return Te((f,p)=>({...n,scene:o,raycaster:g,pointer:l,mouse:l,previousRoot:w,events:{...n.events,...a},size:{...n.size,...d},...v,set:f,get:p,setEvents:h=>f(u=>({...u,events:{...u.events,...h}}))}))});return j.useEffect(()=>{const n=w.subscribe(i=>t.setState(f=>m(i,f)));return()=>{n()}},[m]),j.useEffect(()=>{t.setState(n=>m(w.getState(),n))},[m]),j.useEffect(()=>()=>{t.destroy()},[]),N.jsx(N.Fragment,{children:W.createPortal(N.jsx(ue.Provider,{value:t,children:r}),t,null)})}W.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:j.version});export{Bt as B,vt as E,$t as a,L as b,Xt as c,qt as d,Ft as e,Nt as f,Ue as g,pt as h,X as i,Wt as j,It as k,xt as l,Ht as m,Ut as n,Gt as o,Vt as u};

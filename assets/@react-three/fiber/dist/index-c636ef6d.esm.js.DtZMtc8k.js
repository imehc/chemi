import{G as Z,T as Ue,R as Ve,f as We,J as xe,A as Re,V as H,K as Xe,X as Ke,q as Ye,O as Je,z as Ze,S as _e,Y as Q,Z as Qe,_ as et,a as tt,$ as rt,a0 as nt,a1 as ot,a2 as it,a3 as st}from"../../../three/build/three.module.js.CElijN_X.js";import{r as M}from"../../../react/index.js.CiILtb88.js";import{c as q}from"../../../react-reconciler/constants.js.cziiqKC3.js";import{c as Te}from"../../../zustand/esm/index.js.BKqfLw1g.js";import{R as at}from"../../../react-reconciler/index.js.eAUoQ0l6.js";import{s as ye}from"../../../scheduler/index.js.DPKlw4YW.js";import{s as lt,p as ct,c as ft}from"../../../suspend-react/index.js.BKIKQNXN.js";const ce={},zt=e=>void Object.assign(ce,e);function ut(e,t){function o(r,{args:n=[],attach:l,...s},c){let g=`${r[0].toUpperCase()}${r.slice(1)}`,m;if(r==="primitive"){if(s.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const i=s.object;m=I(i,{type:r,root:c,attach:l,primitive:!0})}else{const i=ce[g];if(!i)throw new Error(`R3F: ${g} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");m=I(new i(...n),{type:r,root:c,attach:l,memoizedProps:{args:n}})}return m.__r3f.attach===void 0&&(m instanceof Xe?m.__r3f.attach="geometry":m instanceof Ke&&(m.__r3f.attach="material")),g!=="inject"&&re(m,s),m}function d(r,n){let l=!1;if(n){var s,c;(s=n.__r3f)!=null&&s.attach?te(r,n,n.__r3f.attach):n.isObject3D&&r.isObject3D&&(r.add(n),l=!0),l||(c=r.__r3f)==null||c.objects.push(n),n.__r3f||I(n,{}),n.__r3f.parent=r,le(n),B(n)}}function u(r,n,l){let s=!1;if(n){var c,g;if((c=n.__r3f)!=null&&c.attach)te(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){n.parent=r,n.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:n});const m=r.children.filter(a=>a!==n),i=m.indexOf(l);r.children=[...m.slice(0,i),n,...m.slice(i)],s=!0}s||(g=r.__r3f)==null||g.objects.push(n),n.__r3f||I(n,{}),n.__r3f.parent=r,le(n),B(n)}}function v(r,n,l=!1){r&&[...r].forEach(s=>y(n,s,l))}function y(r,n,l){if(n){var s,c,g;if(n.__r3f&&(n.__r3f.parent=null),(s=r.__r3f)!=null&&s.objects&&(r.__r3f.objects=r.__r3f.objects.filter(b=>b!==n)),(c=n.__r3f)!=null&&c.attach)Ee(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){var m;r.remove(n),(m=n.__r3f)!=null&&m.root&&yt(J(n),n)}const a=(g=n.__r3f)==null?void 0:g.primitive,h=!a&&(l===void 0?n.dispose!==null:l);if(!a){var i;v((i=n.__r3f)==null?void 0:i.objects,n,h),v(n.children,n,h)}if(delete n.__r3f,h&&n.dispose&&n.type!=="Scene"){const b=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?ye.unstable_scheduleCallback(ye.unstable_IdlePriority,b):b()}B(r)}}function _(r,n,l,s){var c;const g=(c=r.__r3f)==null?void 0:c.parent;if(!g)return;const m=o(n,l,r.__r3f.root);if(r.children){for(const i of r.children)i.__r3f&&d(m,i);r.children=r.children.filter(i=>!i.__r3f)}r.__r3f.objects.forEach(i=>d(m,i)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||y(g,r),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),d(g,m),m.raycast&&m.__r3f.eventCount&&J(m).getState().internal.interaction.push(m),[s,s.alternate].forEach(i=>{i!==null&&(i.stateNode=m,i.ref&&(typeof i.ref=="function"?i.ref(m):i.ref.current=m))})}const f=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:at({createInstance:o,removeChild:y,appendChild:d,appendInitialChild:d,insertBefore:u,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,n)=>{if(!n)return;const l=r.getState().scene;l.__r3f&&(l.__r3f.root=r,d(l,n))},removeChildFromContainer:(r,n)=>{n&&y(r.getState().scene,n)},insertInContainerBefore:(r,n,l)=>{if(!n||!l)return;const s=r.getState().scene;s.__r3f&&u(s,n,l)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var n;return!!((n=r==null?void 0:r.__r3f)!=null?n:{}).handlers},prepareUpdate(r,n,l,s){var c;if(((c=r==null?void 0:r.__r3f)!=null?c:{}).primitive&&s.object&&s.object!==r)return[!0];{const{args:m=[],children:i,...a}=s,{args:h=[],children:b,...C}=l;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((O,R)=>O!==h[R]))return[!0];const S=ze(r,a,C,!0);return S.changes.length?[!1,S]:null}},commitUpdate(r,[n,l],s,c,g,m){n?_(r,s,g,m):re(r,l)},commitMount(r,n,l,s){var c;const g=(c=r.__r3f)!=null?c:{};r.raycast&&g.handlers&&g.eventCount&&J(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>I(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var n;const{attach:l,parent:s}=(n=r.__r3f)!=null?n:{};l&&s&&Ee(s,r,l),r.isObject3D&&(r.visible=!1),B(r)},unhideInstance(r,n){var l;const{attach:s,parent:c}=(l=r.__r3f)!=null?l:{};s&&c&&te(c,r,s),(r.isObject3D&&n.visible==null||n.visible)&&(r.visible=!0),B(r)},createTextInstance:f,hideTextInstance:f,unhideTextInstance:f,getCurrentEventPriority:()=>t?t():q.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&E.fun(performance.now)?performance.now:E.fun(Date.now)?Date.now:()=>0,scheduleTimeout:E.fun(setTimeout)?setTimeout:void 0,cancelTimeout:E.fun(clearTimeout)?clearTimeout:void 0}),applyProps:re}}var we,be;const ee=e=>"colorSpace"in e||"outputColorSpace"in e,Ae=()=>{var e;return(e=ce.ColorManagement)!=null?e:null},je=e=>e&&e.isOrthographicCamera,Lt=e=>e&&e.hasOwnProperty("current"),W=typeof window<"u"&&((we=window.document)!=null&&we.createElement||((be=window.navigator)==null?void 0:be.product)==="ReactNative")?M.useLayoutEffect:M.useEffect;function dt(e){const t=M.useRef(e);return W(()=>void(t.current=e),[e]),t}function Ft({set:e}){return W(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class pt extends M.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}pt.getDerivedStateFromError=()=>({error:!0});const ke="__default",Ce=new Map,vt=e=>e&&!!e.memoized&&!!e.changes;function De(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const $=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function J(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const E={obj:e=>e===Object(e)&&!E.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:d="reference",strict:u=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(E.str(e)||E.num(e))return e===t;const v=E.obj(e);if(v&&d==="reference")return e===t;const y=E.arr(e);if(y&&o==="reference")return e===t;if((y||v)&&e===t)return!0;let _;for(_ in e)if(!(_ in t))return!1;if(v&&o==="shallow"&&d==="shallow"){for(_ in u?t:e)if(!E.equ(e[_],t[_],{strict:u,objects:"reference"}))return!1}else for(_ in u?t:e)if(e[_]!==t[_])return!1;if(E.und(_)){if(y&&e.length===0&&t.length===0||v&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function mt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function ht(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function I(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function ae(e,t){let o=e;if(t.includes("-")){const d=t.split("-"),u=d.pop();return o=d.reduce((v,y)=>v[y],e),{target:o,key:u}}else return{target:o,key:t}}const Se=/-\d+$/;function te(e,t,o){if(E.str(o)){if(Se.test(o)){const v=o.replace(Se,""),{target:y,key:_}=ae(e,v);Array.isArray(y[_])||(y[_]=[])}const{target:d,key:u}=ae(e,o);t.__r3f.previousAttach=d[u],d[u]=t}else t.__r3f.previousAttach=o(e,t)}function Ee(e,t,o){var d,u;if(E.str(o)){const{target:v,key:y}=ae(e,o),_=t.__r3f.previousAttach;_===void 0?delete v[y]:v[y]=_}else(d=t.__r3f)==null||d.previousAttach==null||d.previousAttach(e,t);(u=t.__r3f)==null||delete u.previousAttach}function ze(e,{children:t,key:o,ref:d,...u},{children:v,key:y,ref:_,...f}={},p=!1){var r;const n=(r=e==null?void 0:e.__r3f)!=null?r:{},l=Object.entries(u),s=[];if(p){const g=Object.keys(f);for(let m=0;m<g.length;m++)u.hasOwnProperty(g[m])||l.unshift([g[m],ke+"remove"])}l.forEach(([g,m])=>{var i;if((i=e.__r3f)!=null&&i.primitive&&g==="object"||E.equ(m,f[g]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(g))return s.push([g,m,!0,[]]);let a=[];g.includes("-")&&(a=g.split("-")),s.push([g,m,!1,a]);for(const h in u){const b=u[h];h.startsWith(`${g}-`)&&s.push([h,b,!1,h.split("-")])}});const c={...u};return n.memoizedProps&&n.memoizedProps.args&&(c.args=n.memoizedProps.args),n.memoizedProps&&n.memoizedProps.attach&&(c.attach=n.memoizedProps.attach),{memoized:c,changes:s}}const gt=typeof process<"u"&&!1;function re(e,t){var o,d,u;const v=(o=e.__r3f)!=null?o:{},y=v.root,_=(d=y==null||y.getState==null?void 0:y.getState())!=null?d:{},{memoized:f,changes:p}=vt(t)?t:ze(e,t),r=v.eventCount;e.__r3f&&(e.__r3f.memoizedProps=f);for(let l=0;l<p.length;l++){let[s,c,g,m]=p[l];if(ee(e)){const b="srgb",C="srgb-linear";s==="encoding"?(s="colorSpace",c=c===3001?b:C):s==="outputEncoding"&&(s="outputColorSpace",c=c===3001?b:C)}let i=e,a=i[s];if(m.length&&(a=m.reduce((h,b)=>h[b],e),!(a&&a.set))){const[h,...b]=m.reverse();i=b.reverse().reduce((C,S)=>C[S],e),s=h}if(c===ke+"remove")if(i.constructor){let h=Ce.get(i.constructor);h||(h=new i.constructor,Ce.set(i.constructor,h)),c=h[s]}else c=0;if(g)c?v.handlers[s]=c:delete v.handlers[s],v.eventCount=Object.keys(v.handlers).length;else if(a&&a.set&&(a.copy||a instanceof Z)){if(Array.isArray(c))a.fromArray?a.fromArray(c):a.set(...c);else if(a.copy&&c&&c.constructor&&(gt?a.constructor.name===c.constructor.name:a.constructor===c.constructor))a.copy(c);else if(c!==void 0){const h=a instanceof Ye;!h&&a.setScalar?a.setScalar(c):a instanceof Z&&c instanceof Z?a.mask=c.mask:a.set(c),!Ae()&&!_.linear&&h&&a.convertSRGBToLinear()}}else if(i[s]=c,i[s]instanceof Ue&&i[s].format===Ve&&i[s].type===We){const h=i[s];ee(h)&&ee(_.gl)?h.colorSpace=_.gl.outputColorSpace:h.encoding=_.gl.outputEncoding}B(e)}if(v.parent&&e.raycast&&r!==v.eventCount){const l=J(e).getState().internal,s=l.interaction.indexOf(e);s>-1&&l.interaction.splice(s,1),v.eventCount&&l.interaction.push(e)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(u=e.__r3f)!=null&&u.parent&&le(e),e}function B(e){var t,o;const d=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();d&&d.internal.frames===0&&d.invalidate()}function le(e){e.onUpdate==null||e.onUpdate(e)}function Le(e,t){e.manual||(je(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function K(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function _t(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return q.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return q.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return q.ContinuousEventPriority;default:return q.DefaultEventPriority}}function Fe(e,t,o,d){const u=o.get(t);u&&(o.delete(t),o.size===0&&(e.delete(d),u.target.releasePointerCapture(d)))}function yt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(d=>d!==t),o.initialHits=o.initialHits.filter(d=>d!==t),o.hovered.forEach((d,u)=>{(d.eventObject===t||d.object===t)&&o.hovered.delete(u)}),o.capturedMap.forEach((d,u)=>{Fe(o.capturedMap,t,d,u)})}function It(e){function t(f){const{internal:p}=e.getState(),r=f.offsetX-p.initialClick[0],n=f.offsetY-p.initialClick[1];return Math.round(Math.sqrt(r*r+n*n))}function o(f){return f.filter(p=>["Move","Over","Enter","Out","Leave"].some(r=>{var n;return(n=p.__r3f)==null?void 0:n.handlers["onPointer"+r]}))}function d(f,p){const r=e.getState(),n=new Set,l=[],s=p?p(r.internal.interaction):r.internal.interaction;for(let i=0;i<s.length;i++){const a=$(s[i]);a&&(a.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(f,r);function c(i){const a=$(i);if(!a||!a.events.enabled||a.raycaster.camera===null)return[];if(a.raycaster.camera===void 0){var h;a.events.compute==null||a.events.compute(f,a,(h=a.previousRoot)==null?void 0:h.getState()),a.raycaster.camera===void 0&&(a.raycaster.camera=null)}return a.raycaster.camera?a.raycaster.intersectObject(i,!0):[]}let g=s.flatMap(c).sort((i,a)=>{const h=$(i.object),b=$(a.object);return!h||!b?i.distance-a.distance:b.events.priority-h.events.priority||i.distance-a.distance}).filter(i=>{const a=K(i);return n.has(a)?!1:(n.add(a),!0)});r.events.filter&&(g=r.events.filter(g,r));for(const i of g){let a=i.object;for(;a;){var m;(m=a.__r3f)!=null&&m.eventCount&&l.push({...i,eventObject:a}),a=a.parent}}if("pointerId"in f&&r.internal.capturedMap.has(f.pointerId))for(let i of r.internal.capturedMap.get(f.pointerId).values())n.has(K(i.intersection))||l.push(i.intersection);return l}function u(f,p,r,n){const l=e.getState();if(f.length){const s={stopped:!1};for(const c of f){const g=$(c.object)||l,{raycaster:m,pointer:i,camera:a,internal:h}=g,b=new H(i.x,i.y,0).unproject(a),C=x=>{var w,P;return(w=(P=h.capturedMap.get(x))==null?void 0:P.has(c.eventObject))!=null?w:!1},S=x=>{const w={intersection:c,target:p.target};h.capturedMap.has(x)?h.capturedMap.get(x).set(c.eventObject,w):h.capturedMap.set(x,new Map([[c.eventObject,w]])),p.target.setPointerCapture(x)},O=x=>{const w=h.capturedMap.get(x);w&&Fe(h.capturedMap,c.eventObject,w,x)};let R={};for(let x in p){let w=p[x];typeof w!="function"&&(R[x]=w)}let T={...c,...R,pointer:i,intersections:f,stopped:s.stopped,delta:r,unprojectedPoint:b,ray:m.ray,camera:a,stopPropagation(){const x="pointerId"in p&&h.capturedMap.get(p.pointerId);if((!x||x.has(c.eventObject))&&(T.stopped=s.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(w=>w.eventObject===c.eventObject))){const w=f.slice(0,f.indexOf(c));v([...w,c])}},target:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:O},currentTarget:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:O},nativeEvent:p};if(n(T),s.stopped===!0)break}}return f}function v(f){const{internal:p}=e.getState();for(const r of p.hovered.values())if(!f.length||!f.find(n=>n.object===r.object&&n.index===r.index&&n.instanceId===r.instanceId)){const l=r.eventObject.__r3f,s=l==null?void 0:l.handlers;if(p.hovered.delete(K(r)),l!=null&&l.eventCount){const c={...r,intersections:f};s.onPointerOut==null||s.onPointerOut(c),s.onPointerLeave==null||s.onPointerLeave(c)}}}function y(f,p){for(let r=0;r<p.length;r++){const n=p[r].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(f)}}function _(f){switch(f){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return p=>{const{internal:r}=e.getState();"pointerId"in p&&r.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(p.pointerId)&&(r.capturedMap.delete(p.pointerId),v([]))})}}return function(r){const{onPointerMissed:n,internal:l}=e.getState();l.lastEvent.current=r;const s=f==="onPointerMove",c=f==="onClick"||f==="onContextMenu"||f==="onDoubleClick",m=d(r,s?o:void 0),i=c?t(r):0;f==="onPointerDown"&&(l.initialClick=[r.offsetX,r.offsetY],l.initialHits=m.map(h=>h.eventObject)),c&&!m.length&&i<=2&&(y(r,l.interaction),n&&n(r)),s&&v(m);function a(h){const b=h.eventObject,C=b.__r3f,S=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(s){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const O=K(h),R=l.hovered.get(O);R?R.stopped&&h.stopPropagation():(l.hovered.set(O,h),S.onPointerOver==null||S.onPointerOver(h),S.onPointerEnter==null||S.onPointerEnter(h))}S.onPointerMove==null||S.onPointerMove(h)}else{const O=S[f];O?(!c||l.initialHits.includes(b))&&(y(r,l.interaction.filter(R=>!l.initialHits.includes(R))),O(h)):c&&l.initialHits.includes(b)&&y(r,l.interaction.filter(R=>!l.initialHits.includes(R)))}}u(m,r,i,a)}}return{handlePointer:_}}const wt=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],Ie=e=>!!(e!=null&&e.render),fe=M.createContext(null),bt=(e,t)=>{const o=Te((_,f)=>{const p=new H,r=new H,n=new H;function l(i=f().camera,a=r,h=f().size){const{width:b,height:C,top:S,left:O}=h,R=b/C;a instanceof H?n.copy(a):n.set(...a);const T=i.getWorldPosition(p).distanceTo(n);if(je(i))return{width:b/i.zoom,height:C/i.zoom,top:S,left:O,factor:1,distance:T,aspect:R};{const x=i.fov*Math.PI/180,w=2*Math.tan(x/2)*T,P=w*(b/C);return{width:P,height:w,top:S,left:O,factor:b/P,distance:T,aspect:R}}}let s;const c=i=>_(a=>({performance:{...a.performance,current:i}})),g=new Re;return{set:_,get:f,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(i=1)=>e(f(),i),advance:(i,a)=>t(i,a,f()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new st,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const i=f();s&&clearTimeout(s),i.performance.current!==i.performance.min&&c(i.performance.min),s=setTimeout(()=>c(f().performance.max),i.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:i=>_(a=>({...a,events:{...a.events,...i}})),setSize:(i,a,h,b,C)=>{const S=f().camera,O={width:i,height:a,top:b||0,left:C||0,updateStyle:h};_(R=>({size:O,viewport:{...R.viewport,...l(S,r,O)}}))},setDpr:i=>_(a=>{const h=De(i);return{viewport:{...a.viewport,dpr:h,initialDpr:a.viewport.initialDpr||h}}}),setFrameloop:(i="always")=>{const a=f().clock;a.stop(),a.elapsedTime=0,i!=="never"&&(a.start(),a.elapsedTime=0),_(()=>({frameloop:i}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:M.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(i,a,h)=>{const b=f().internal;return b.priority=b.priority+(a>0?1:0),b.subscribers.push({ref:i,priority:a,store:h}),b.subscribers=b.subscribers.sort((C,S)=>C.priority-S.priority),()=>{const C=f().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(a>0?1:0),C.subscribers=C.subscribers.filter(S=>S.ref!==i))}}}}}),d=o.getState();let u=d.size,v=d.viewport.dpr,y=d.camera;return o.subscribe(()=>{const{camera:_,size:f,viewport:p,gl:r,set:n}=o.getState();if(f.width!==u.width||f.height!==u.height||p.dpr!==v){var l;u=f,v=p.dpr,Le(_,f),r.setPixelRatio(p.dpr);const s=(l=f.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(f.width,f.height,s)}_!==y&&(y=_,n(s=>({viewport:{...s.viewport,...s.viewport.getCurrentViewport(_)}})))}),o.subscribe(_=>e(_)),o};function ue(e,t){const o={callback:e};return t.add(o),()=>void t.delete(o)}let Y,Be=new Set,He=new Set,qe=new Set;const Bt=e=>ue(e,Be),Ht=e=>ue(e,He),qt=e=>ue(e,qe);function ne(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function U(e,t){switch(e){case"before":return ne(Be,t);case"after":return ne(He,t);case"tail":return ne(qe,t)}}let oe,ie;function se(e,t,o){let d=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(d=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),oe=t.internal.subscribers,Y=0;Y<oe.length;Y++)ie=oe[Y],ie.ref.current(ie.store.getState(),d,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Ct(e){let t=!1,o=!1,d,u,v;function y(p){u=requestAnimationFrame(y),t=!0,d=0,U("before",p),o=!0;for(const n of e.values()){var r;v=n.store.getState(),v.internal.active&&(v.frameloop==="always"||v.internal.frames>0)&&!((r=v.gl.xr)!=null&&r.isPresenting)&&(d+=se(p,v))}if(o=!1,U("after",p),d===0)return U("tail",p),t=!1,cancelAnimationFrame(u)}function _(p,r=1){var n;if(!p)return e.forEach(l=>_(l.store.getState(),r));(n=p.gl.xr)!=null&&n.isPresenting||!p.internal.active||p.frameloop==="never"||(r>1?p.internal.frames=Math.min(60,p.internal.frames+r):o?p.internal.frames=2:p.internal.frames=1,t||(t=!0,requestAnimationFrame(y)))}function f(p,r=!0,n,l){if(r&&U("before",p),n)se(p,n,l);else for(const s of e.values())se(p,s.store.getState());r&&U("after",p)}return{loop:y,invalidate:_,advance:f}}function Nt(e){const t=M.useRef(null);return W(()=>void(t.current=e.current.__r3f),[e]),t}function de(){const e=M.useContext(fe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Gt(e=o=>o,t){return de()(e,t)}function $t(e,t=0){const o=de(),d=o.getState().internal.subscribe,u=dt(e);return W(()=>d(u,t,o),[t,d,o]),null}const Pe=new WeakMap;function Ne(e,t){return function(o,...d){let u=Pe.get(o);return u||(u=new o,Pe.set(o,u)),e&&e(u),Promise.all(d.map(v=>new Promise((y,_)=>u.load(v,f=>{f.scene&&Object.assign(f,mt(f.scene)),y(f)},t,f=>_(new Error(`Could not load ${v}: ${f==null?void 0:f.message}`))))))}}function Ge(e,t,o,d){const u=Array.isArray(t)?t:[t],v=lt(Ne(o,d),[e,...u],{equal:E.equ});return Array.isArray(t)?v:v[0]}Ge.preload=function(e,t,o){const d=Array.isArray(t)?t:[t];return ct(Ne(o),[e,...d])};Ge.clear=function(e,t){const o=Array.isArray(t)?t:[t];return ft([e,...o])};const N=new Map,{invalidate:Me,advance:Oe}=Ct(N),{reconciler:V,applyProps:L}=ut(N,_t),F={objects:"shallow",strict:!1},St=(e,t)=>{const o=typeof e=="function"?e(t):e;return Ie(o)?o:new tt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Et(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:d,height:u,top:v,left:y,updateStyle:_=o}=t;return{width:d,height:u,top:v,left:y,updateStyle:_}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:d,height:u,top:v,left:y}=e.parentElement.getBoundingClientRect();return{width:d,height:u,top:v,left:y,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Ut(e){const t=N.get(e),o=t==null?void 0:t.fiber,d=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const u=typeof reportError=="function"?reportError:console.error,v=d||bt(Me,Oe),y=o||V.createContainer(v,q.ConcurrentRoot,null,!1,null,"",u,null);t||N.set(e,{fiber:y,store:v});let _,f=!1,p;return{configure(r={}){let{gl:n,size:l,scene:s,events:c,onCreated:g,shadows:m=!1,linear:i=!1,flat:a=!1,legacy:h=!1,orthographic:b=!1,frameloop:C="always",dpr:S=[1,2],performance:O,raycaster:R,camera:T,onPointerMissed:x}=r,w=v.getState(),P=w.gl;w.gl||w.set({gl:P=St(n,e)});let D=w.raycaster;D||w.set({raycaster:D=new xe});const{params:pe,...ve}=R||{};if(E.equ(ve,D,F)||L(D,{...ve}),E.equ(pe,D.params,F)||L(D,{params:{...D.params,...pe}}),!w.camera||w.camera===p&&!E.equ(p,T,F)){p=T;const A=T instanceof rt,k=A?T:b?new Je(0,0,0,0,.1,1e3):new Ze(75,0,.1,1e3);A||(k.position.z=5,T&&L(k,T),!w.camera&&!(T!=null&&T.rotation)&&k.lookAt(0,0,0)),w.set({camera:k}),D.camera=k}if(!w.scene){let A;s instanceof _e?A=s:(A=new _e,s&&L(A,s)),w.set({scene:I(A)})}if(!w.xr){var me;const A=(j,$e)=>{const ge=v.getState();ge.frameloop!=="never"&&Oe(j,!0,ge,$e)},k=()=>{const j=v.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?A:null),j.gl.xr.isPresenting||Me(j)},X={connect(){const j=v.getState().gl;j.xr.addEventListener("sessionstart",k),j.xr.addEventListener("sessionend",k)},disconnect(){const j=v.getState().gl;j.xr.removeEventListener("sessionstart",k),j.xr.removeEventListener("sessionend",k)}};typeof((me=P.xr)==null?void 0:me.addEventListener)=="function"&&X.connect(),w.set({xr:X})}if(P.shadowMap){const A=P.shadowMap.enabled,k=P.shadowMap.type;if(P.shadowMap.enabled=!!m,E.boo(m))P.shadowMap.type=Q;else if(E.str(m)){var he;const X={basic:nt,percentage:ot,soft:Q,variance:it};P.shadowMap.type=(he=X[m])!=null?he:Q}else E.obj(m)&&Object.assign(P.shadowMap,m);(A!==P.shadowMap.enabled||k!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}const G=Ae();G&&("enabled"in G?G.enabled=!h:"legacyMode"in G&&(G.legacyMode=h)),f||L(P,{outputEncoding:i?3e3:3001,toneMapping:a?Qe:et}),w.legacy!==h&&w.set(()=>({legacy:h})),w.linear!==i&&w.set(()=>({linear:i})),w.flat!==a&&w.set(()=>({flat:a})),n&&!E.fun(n)&&!Ie(n)&&!E.equ(n,P,F)&&L(P,n),c&&!w.events.handlers&&w.set({events:c(v)});const z=Et(e,l);return E.equ(z,w.size,F)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),S&&w.viewport.dpr!==De(S)&&w.setDpr(S),w.frameloop!==C&&w.setFrameloop(C),w.onPointerMissed||w.set({onPointerMissed:x}),O&&!E.equ(O,w.performance,F)&&w.set(A=>({performance:{...A.performance,...O}})),_=g,f=!0,this},render(r){return f||this.configure(),V.updateContainer(M.createElement(Pt,{store:v,children:r,onCreated:_,rootElement:e}),y,null,()=>{}),v},unmount(){Mt(e)}}}function Pt({store:e,children:t,onCreated:o,rootElement:d}){return W(()=>{const u=e.getState();u.set(v=>({internal:{...v.internal,active:!0}})),o&&o(u),e.getState().events.connected||u.events.connect==null||u.events.connect(d)},[]),M.createElement(fe.Provider,{value:e},t)}function Mt(e,t){const o=N.get(e),d=o==null?void 0:o.fiber;if(d){const u=o==null?void 0:o.store.getState();u&&(u.internal.active=!1),V.updateContainer(null,d,null,()=>{u&&setTimeout(()=>{try{var v,y,_,f;u.events.disconnect==null||u.events.disconnect(),(v=u.gl)==null||(y=v.renderLists)==null||y.dispose==null||y.dispose(),(_=u.gl)==null||_.forceContextLoss==null||_.forceContextLoss(),(f=u.gl)!=null&&f.xr&&u.xr.disconnect(),ht(u),N.delete(e),t&&t(e)}catch{}},500)})}}function Vt(e,t,o){return M.createElement(Ot,{key:t.uuid,children:e,container:t,state:o})}function Ot({state:e={},children:t,container:o}){const{events:d,size:u,...v}=e,y=de(),[_]=M.useState(()=>new xe),[f]=M.useState(()=>new Re),p=M.useCallback((n,l)=>{const s={...n};Object.keys(n).forEach(g=>{(wt.includes(g)||n[g]!==l[g]&&l[g])&&delete s[g]});let c;if(l&&u){const g=l.camera;c=n.viewport.getCurrentViewport(g,new H,u),g!==n.camera&&Le(g,u)}return{...s,scene:o,raycaster:_,pointer:f,mouse:f,previousRoot:y,events:{...n.events,...l==null?void 0:l.events,...d},size:{...n.size,...u},viewport:{...n.viewport,...c},...v}},[e]),[r]=M.useState(()=>{const n=y.getState();return Te((s,c)=>({...n,scene:o,raycaster:_,pointer:f,mouse:f,previousRoot:y,events:{...n.events,...d},size:{...n.size,...u},...v,set:s,get:c,setEvents:g=>s(m=>({...m,events:{...m.events,...g}}))}))});return M.useEffect(()=>{const n=y.subscribe(l=>r.setState(s=>p(l,s)));return()=>{n(),r.destroy()}},[]),M.useEffect(()=>{r.setState(n=>p(y.getState(),n))},[p]),M.createElement(M.Fragment,null,V.createPortal(M.createElement(fe.Provider,{value:r},t),r,null))}V.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:M.version});export{Ft as B,pt as E,$t as a,L as b,Vt as c,Bt as d,zt as e,Ht as f,Ge as g,dt as h,W as i,Ut as j,Lt as k,Mt as l,It as m,Nt as n,qt as o,Gt as u};

import{e as U,h as V,i as $,j as q,k as G,E as J,B as K,l as Q,m as Z}from"./index-ba8afaa4.esm.js.CC8UC62r.js";import{r as t}from"../../../react/index.js.IuPGg7Py.js";import{a5 as ee}from"../../../three/build/three.module.js.jQmR1wrA.js";import{u as ne}from"../../../react-use-measure/dist/web.js.0CDZZggC.js";import{F as te,u as re}from"../../../its-fine/dist/index.js.CBEqHD9G.js";import{j as c}from"../../../react/jsx-runtime.js.Cm6upDnr.js";import"../../../react-reconciler/constants.js.cziiqKC3.js";import"../../../react-reconciler/index.js.DwfphOJC.js";import"../../../scheduler/index.js.DPKlw4YW.js";const x={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function oe(a){const{handlePointer:d}=Z(a);return{priority:1,enabled:!0,compute(n,e,r){e.pointer.set(n.offsetX/e.size.width*2-1,-(n.offsetY/e.size.height)*2+1),e.raycaster.setFromCamera(e.pointer,e.camera)},connected:void 0,handlers:Object.keys(x).reduce((n,e)=>({...n,[e]:d(e)}),{}),update:()=>{var n;const{events:e,internal:r}=a.getState();(n=r.lastEvent)!=null&&n.current&&e.handlers&&e.handlers.onPointerMove(r.lastEvent.current)},connect:n=>{var e;const{set:r,events:o}=a.getState();o.disconnect==null||o.disconnect(),r(i=>({events:{...i.events,connected:n}})),Object.entries((e=o.handlers)!=null?e:[]).forEach(([i,s])=>{const[f,m]=x[i];n.addEventListener(f,s,{passive:m})})},disconnect:()=>{const{set:n,events:e}=a.getState();if(e.connected){var r;Object.entries((r=e.handlers)!=null?r:[]).forEach(([o,i])=>{if(e&&e.connected instanceof HTMLElement){const[s]=x[o];e.connected.removeEventListener(s,i)}}),n(o=>({events:{...o.events,connected:void 0}}))}}}}const se=t.forwardRef(function({children:d,fallback:n,resize:e,style:r,gl:o,events:i=oe,eventSource:s,eventPrefix:f,shadows:m,linear:g,flat:y,legacy:M,orthographic:P,frameloop:z,dpr:B,performance:L,raycaster:F,camera:N,scene:O,onPointerMissed:D,onCreated:j,...H},I){t.useMemo(()=>U(ee),[]);const S=re(),[T,E]=ne({scroll:!0,debounce:{scroll:50,resize:0},...e}),v=t.useRef(null),C=t.useRef(null);t.useImperativeHandle(I,()=>v.current);const b=V(D),[w,W]=t.useState(!1),[R,X]=t.useState(!1);if(w)throw w;if(R)throw R;const h=t.useRef(null);$(()=>{const p=v.current;E.width>0&&E.height>0&&p&&(h.current||(h.current=q(p)),h.current.configure({gl:o,events:i,shadows:m,linear:g,flat:y,legacy:M,orthographic:P,frameloop:z,dpr:B,performance:L,raycaster:F,camera:N,scene:O,size:E,onPointerMissed:(...l)=>b.current==null?void 0:b.current(...l),onCreated:l=>{l.events.connect==null||l.events.connect(s?G(s)?s.current:s:C.current),f&&l.setEvents({compute:(k,u)=>{const _=k[f+"X"],A=k[f+"Y"];u.pointer.set(_/u.size.width*2-1,-(A/u.size.height)*2+1),u.raycaster.setFromCamera(u.pointer,u.camera)}}),j==null||j(l)}}),h.current.render(c.jsx(S,{children:c.jsx(J,{set:X,children:c.jsx(t.Suspense,{fallback:c.jsx(K,{set:W}),children:d})})})))}),t.useEffect(()=>{const p=v.current;if(p)return()=>Q(p)},[]);const Y=s?"none":"auto";return c.jsx("div",{ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Y,...r},...H,children:c.jsx("div",{ref:T,style:{width:"100%",height:"100%"},children:c.jsx("canvas",{ref:v,style:{display:"block"},children:n})})})}),he=t.forwardRef(function(d,n){return c.jsx(te,{children:c.jsx(se,{...d,ref:n})})});export{he as C};

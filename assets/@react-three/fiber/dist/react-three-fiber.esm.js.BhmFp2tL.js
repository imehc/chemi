import{e as U,h as V,i as $,j as q,k as G,E as J,B as K,l as Q,m as Z}from"./index-c636ef6d.esm.js.DtZMtc8k.js";import{_ as y}from"../../../@babel/runtime/helpers/esm/extends.js.CCbyfPlC.js";import{r as n}from"../../../react/index.js.CiILtb88.js";import{a4 as ee}from"../../../three/build/three.module.js.CElijN_X.js";import{u as ne}from"../../../react-use-measure/dist/web.js.BtTOEvoD.js";import{F as te,u as re}from"../../../its-fine/dist/index.js.DP1ChiJo.js";import"../../../react-reconciler/constants.js.cziiqKC3.js";import"../../../react-reconciler/index.js.eAUoQ0l6.js";import"../../../scheduler/index.js.DPKlw4YW.js";const E={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function oe(a){const{handlePointer:u}=Z(a);return{priority:1,enabled:!0,compute(t,e,r){e.pointer.set(t.offsetX/e.size.width*2-1,-(t.offsetY/e.size.height)*2+1),e.raycaster.setFromCamera(e.pointer,e.camera)},connected:void 0,handlers:Object.keys(E).reduce((t,e)=>({...t,[e]:u(e)}),{}),update:()=>{var t;const{events:e,internal:r}=a.getState();(t=r.lastEvent)!=null&&t.current&&e.handlers&&e.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var e;const{set:r,events:o}=a.getState();o.disconnect==null||o.disconnect(),r(c=>({events:{...c.events,connected:t}})),Object.entries((e=o.handlers)!=null?e:[]).forEach(([c,s])=>{const[d,p]=E[c];t.addEventListener(d,s,{passive:p})})},disconnect:()=>{const{set:t,events:e}=a.getState();if(e.connected){var r;Object.entries((r=e.handlers)!=null?r:[]).forEach(([o,c])=>{if(e&&e.connected instanceof HTMLElement){const[s]=E[o];e.connected.removeEventListener(s,c)}}),t(o=>({events:{...o.events,connected:void 0}}))}}}}const se=n.forwardRef(function({children:u,fallback:t,resize:e,style:r,gl:o,events:c=oe,eventSource:s,eventPrefix:d,shadows:p,linear:M,flat:P,legacy:x,orthographic:z,frameloop:B,dpr:L,performance:j,raycaster:F,camera:N,scene:O,onPointerMissed:_,onCreated:C,...D},H){n.useMemo(()=>U(ee),[]);const I=re(),[S,h]=ne({scroll:!0,debounce:{scroll:50,resize:0},...e}),m=n.useRef(null),b=n.useRef(null);n.useImperativeHandle(H,()=>m.current);const w=V(_),[R,T]=n.useState(!1),[k,W]=n.useState(!1);if(R)throw R;if(k)throw k;const v=n.useRef(null);$(()=>{const f=m.current;h.width>0&&h.height>0&&f&&(v.current||(v.current=q(f)),v.current.configure({gl:o,events:c,shadows:p,linear:M,flat:P,legacy:x,orthographic:z,frameloop:B,dpr:L,performance:j,raycaster:F,camera:N,scene:O,size:h,onPointerMissed:(...i)=>w.current==null?void 0:w.current(...i),onCreated:i=>{i.events.connect==null||i.events.connect(s?G(s)?s.current:s:b.current),d&&i.setEvents({compute:(g,l)=>{const Y=g[d+"X"],A=g[d+"Y"];l.pointer.set(Y/l.size.width*2-1,-(A/l.size.height)*2+1),l.raycaster.setFromCamera(l.pointer,l.camera)}}),C==null||C(i)}}),v.current.render(n.createElement(I,null,n.createElement(J,{set:W},n.createElement(n.Suspense,{fallback:n.createElement(K,{set:T})},u)))))}),n.useEffect(()=>{const f=m.current;if(f)return()=>Q(f)},[]);const X=s?"none":"auto";return n.createElement("div",y({ref:b,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:X,...r}},D),n.createElement("div",{ref:S,style:{width:"100%",height:"100%"}},n.createElement("canvas",{ref:m,style:{display:"block"}},t)))}),pe=n.forwardRef(function(u,t){return n.createElement(te,null,n.createElement(se,y({},u,{ref:t})))});export{pe as C};

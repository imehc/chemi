{"version":3,"file":"EffectComposer.js.04roKxei.js","sources":["../../../../../node_modules/.pnpm/@react-three+postprocessing@2.15.11_@react-three+fiber@8.15.11_@types+three@0.158.3_react@18.2.0_three@0.158.0/node_modules/@react-three/postprocessing/dist/EffectComposer.js"],"sourcesContent":["import { jsx } from \"react/jsx-runtime\";\nimport { HalfFloatType } from \"three\";\nimport React, { createContext, forwardRef, useMemo, useEffect, useRef, useLayoutEffect, useImperativeHandle } from \"react\";\nimport { useThree, useFrame, useInstanceHandle } from \"@react-three/fiber\";\nimport { EffectComposer as EffectComposer$1, RenderPass, NormalPass, DepthDownsamplingPass, Effect, EffectPass, EffectAttribute, Pass } from \"postprocessing\";\nimport { isWebGL2Available } from \"three-stdlib\";\nconst EffectComposerContext = createContext(null);\nconst isConvolution = (effect) => (effect.getAttributes() & EffectAttribute.CONVOLUTION) === EffectAttribute.CONVOLUTION;\nconst EffectComposer = React.memo(\n  forwardRef(\n    ({\n      children,\n      camera: _camera,\n      scene: _scene,\n      resolutionScale,\n      enabled = true,\n      renderPriority = 1,\n      autoClear = true,\n      depthBuffer,\n      disableNormalPass,\n      stencilBuffer,\n      multisampling = 8,\n      frameBufferType = HalfFloatType\n    }, ref) => {\n      const { gl, scene: defaultScene, camera: defaultCamera, size } = useThree();\n      const scene = _scene || defaultScene;\n      const camera = _camera || defaultCamera;\n      const [composer, normalPass, downSamplingPass] = useMemo(() => {\n        const webGL2Available = isWebGL2Available();\n        const effectComposer = new EffectComposer$1(gl, {\n          depthBuffer,\n          stencilBuffer,\n          multisampling: multisampling > 0 && webGL2Available ? multisampling : 0,\n          frameBufferType\n        });\n        effectComposer.addPass(new RenderPass(scene, camera));\n        let downSamplingPass2 = null;\n        let normalPass2 = null;\n        if (!disableNormalPass) {\n          normalPass2 = new NormalPass(scene, camera);\n          normalPass2.enabled = false;\n          effectComposer.addPass(normalPass2);\n          if (resolutionScale !== void 0 && webGL2Available) {\n            downSamplingPass2 = new DepthDownsamplingPass({ normalBuffer: normalPass2.texture, resolutionScale });\n            downSamplingPass2.enabled = false;\n            effectComposer.addPass(downSamplingPass2);\n          }\n        }\n        return [effectComposer, normalPass2, downSamplingPass2];\n      }, [\n        camera,\n        gl,\n        depthBuffer,\n        stencilBuffer,\n        multisampling,\n        frameBufferType,\n        scene,\n        disableNormalPass,\n        resolutionScale\n      ]);\n      useEffect(() => composer == null ? void 0 : composer.setSize(size.width, size.height), [composer, size]);\n      useFrame(\n        (_, delta) => {\n          if (enabled) {\n            const currentAutoClear = gl.autoClear;\n            gl.autoClear = autoClear;\n            if (stencilBuffer && !autoClear)\n              gl.clearStencil();\n            composer.render(delta);\n            gl.autoClear = currentAutoClear;\n          }\n        },\n        enabled ? renderPriority : 0\n      );\n      const group = useRef(null);\n      const instance = useInstanceHandle(group);\n      useLayoutEffect(() => {\n        const passes = [];\n        if (group.current && instance.current && composer) {\n          const children2 = instance.current.objects;\n          for (let i = 0; i < children2.length; i++) {\n            const child = children2[i];\n            if (child instanceof Effect) {\n              const effects = [child];\n              if (!isConvolution(child)) {\n                let next = null;\n                while ((next = children2[i + 1]) instanceof Effect) {\n                  if (isConvolution(next))\n                    break;\n                  effects.push(next);\n                  i++;\n                }\n              }\n              const pass = new EffectPass(camera, ...effects);\n              passes.push(pass);\n            } else if (child instanceof Pass) {\n              passes.push(child);\n            }\n          }\n          for (const pass of passes)\n            composer == null ? void 0 : composer.addPass(pass);\n          if (normalPass)\n            normalPass.enabled = true;\n          if (downSamplingPass)\n            downSamplingPass.enabled = true;\n        }\n        return () => {\n          for (const pass of passes)\n            composer == null ? void 0 : composer.removePass(pass);\n          if (normalPass)\n            normalPass.enabled = false;\n          if (downSamplingPass)\n            downSamplingPass.enabled = false;\n        };\n      }, [composer, children, camera, normalPass, downSamplingPass, instance]);\n      const state = useMemo(\n        () => ({ composer, normalPass, downSamplingPass, resolutionScale, camera, scene }),\n        [composer, normalPass, downSamplingPass, resolutionScale, camera, scene]\n      );\n      useImperativeHandle(ref, () => composer, [composer]);\n      return /* @__PURE__ */ jsx(EffectComposerContext.Provider, { value: state, children: /* @__PURE__ */ jsx(\"group\", { ref: group, children }) });\n    }\n  )\n);\nexport {\n  EffectComposer,\n  EffectComposerContext\n};\n//# sourceMappingURL=EffectComposer.js.map\n"],"names":["EffectComposerContext","createContext","isConvolution","effect","EffectAttribute","EffectComposer","React","forwardRef","children","_camera","_scene","resolutionScale","enabled","renderPriority","autoClear","depthBuffer","disableNormalPass","stencilBuffer","multisampling","frameBufferType","HalfFloatType","ref","gl","defaultScene","defaultCamera","size","useThree","scene","camera","composer","normalPass","downSamplingPass","useMemo","webGL2Available","isWebGL2Available","effectComposer","EffectComposer$1","RenderPass","downSamplingPass2","normalPass2","NormalPass","DepthDownsamplingPass","useEffect","useFrame","_","delta","currentAutoClear","group","useRef","instance","useInstanceHandle","useLayoutEffect","passes","children2","i","child","Effect","effects","next","pass","EffectPass","Pass","state","useImperativeHandle","jsx"],"mappings":"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","x_google_ignoreList":[0]}
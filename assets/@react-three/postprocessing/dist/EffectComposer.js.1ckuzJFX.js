import{j as O}from"../../../react/jsx-runtime.js.Uqq-hvb5.js";import{H as M}from"../../../three/build/three.module.js.mjdRT5l4.js";import{r as o,R as U}from"../../../react/index.js.4247Uq6c.js";import{E as V,R as k,N as y,D as S,a as j,b as W,c as A,P as _}from"../../../postprocessing/build/index.js.QRuosPLv.js";import{i as $}from"../../../three-stdlib/misc/WebGL.js.U3AGJX0J.js";import{u as q,a as J,m as K}from"../../fiber/dist/index-db8af450.esm.js.7UbIKsuw.js";const Q=o.createContext(null),L=m=>(m.getAttributes()&A.CONVOLUTION)===A.CONVOLUTION,ae=U.memo(o.forwardRef(({children:m,camera:N,scene:H,resolutionScale:i,enabled:E=!0,renderPriority:I=1,autoClear:h=!0,depthBuffer:v,disableNormalPass:x,stencilBuffer:d,multisampling:p=8,frameBufferType:g=M},D)=>{const{gl:l,scene:T,camera:z,size:P}=q(),u=H||T,r=N||z,[e,f,c]=o.useMemo(()=>{const n=$(),a=new V(l,{depthBuffer:v,stencilBuffer:d,multisampling:p>0&&n?p:0,frameBufferType:g});a.addPass(new k(u,r));let s=null,t=null;return x||(t=new y(u,r),t.enabled=!1,a.addPass(t),i!==void 0&&n&&(s=new S({normalBuffer:t.texture,resolutionScale:i}),s.enabled=!1,a.addPass(s))),[a,t,s]},[r,l,v,d,p,g,u,x,i]);o.useEffect(()=>e==null?void 0:e.setSize(P.width,P.height),[e,P]),J((n,a)=>{if(E){const s=l.autoClear;l.autoClear=h,d&&!h&&l.clearStencil(),e.render(a),l.autoClear=s}},E?I:0);const b=o.useRef(null),C=K(b);o.useLayoutEffect(()=>{const n=[];if(b.current&&C.current&&e){const a=C.current.objects;for(let s=0;s<a.length;s++){const t=a[s];if(t instanceof j){const R=[t];if(!L(t)){let w=null;for(;(w=a[s+1])instanceof j&&!L(w);)R.push(w),s++}const G=new W(r,...R);n.push(G)}else t instanceof _&&n.push(t)}for(const s of n)e==null||e.addPass(s);f&&(f.enabled=!0),c&&(c.enabled=!0)}return()=>{for(const a of n)e==null||e.removePass(a);f&&(f.enabled=!1),c&&(c.enabled=!1)}},[e,m,r,f,c,C]);const F=o.useMemo(()=>({composer:e,normalPass:f,downSamplingPass:c,resolutionScale:i,camera:r,scene:u}),[e,f,c,i,r,u]);return o.useImperativeHandle(D,()=>e,[e]),O.jsx(Q.Provider,{value:F,children:O.jsx("group",{ref:b,children:m})})}));export{Q as E,ae as a};
//# sourceMappingURL=EffectComposer.js.1ckuzJFX.js.map

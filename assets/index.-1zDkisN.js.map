{"version":3,"file":"index.-1zDkisN.js","sources":["../../src/demo2/08/use_keyboard.ts","../../src/demo2/08/Ball.tsx","../../src/demo2/08/Overlay.tsx","../../src/demo2/08/index.tsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\n\nexport const useKeyboard = () => {\n  const keyMap = useRef<Record<string, unknown>>({});\n\n  useEffect(() => {\n    const onDocumentKey = (e: KeyboardEvent) => {\n      keyMap.current[e.code] = e.type === 'keydown';\n    };\n    document.addEventListener('keydown', onDocumentKey);\n    document.addEventListener('keyup', onDocumentKey);\n    return () => {\n      document.removeEventListener('keydown', onDocumentKey);\n      document.removeEventListener('keyup', onDocumentKey);\n    };\n  });\n\n  return keyMap.current;\n};\n","import { useFrame } from '@react-three/fiber';\nimport { useMemo, useRef } from 'react';\nimport { Vector3, Quaternion, Mesh, GridHelper } from 'three';\nimport { useKeyboard } from './use_keyboard';\n\nexport const Ball: React.FC<{\n  floor: ReturnType<typeof useRef<GridHelper | null>>;\n}> = ({ floor }) => {\n  const ref = useRef<Mesh>(null);\n  const keyMap = useKeyboard();\n\n  const v = useMemo(() => new Vector3(), []);\n  const q = useMemo(() => new Quaternion(), []);\n  const angularVelocity = useMemo(() => new Vector3(), []);\n\n  useFrame((_, delta) => {\n    keyMap['KeyW'] && (angularVelocity.x -= delta * 5);\n    keyMap['KeyS'] && (angularVelocity.x += delta * 5);\n    keyMap['KeyA'] && (angularVelocity.z += delta * 5);\n    keyMap['KeyD'] && (angularVelocity.z -= delta * 5);\n\n    q.setFromAxisAngle(angularVelocity, delta).normalize();\n    if (!ref.current) return;\n    ref.current.applyQuaternion(q);\n\n    angularVelocity.lerp(v, 0.01); // slow down the roll\n    if (!floor.current) return;\n\n    floor.current.position.x += angularVelocity.z * delta;\n    floor.current.position.z -= angularVelocity.x * delta;\n\n    floor.current.position.x = floor.current.position.x % 10;\n    floor.current.position.z = floor.current.position.z % 10;\n  });\n\n  return (\n    <mesh ref={ref} position-y={1.0}>\n      <sphereGeometry />\n      <meshNormalMaterial wireframe />\n    </mesh>\n  );\n};\n","export const Overlay = () => {\n  return (\n    <div id=\"instructions\">\n      <kbd>W</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd> to roll.\n    </div>\n  );\n};\n","import { PointerLockControls, Environment, Stats } from '@react-three/drei';\nimport { Canvas } from '@react-three/fiber';\nimport { useRef } from 'react';\nimport { GridHelper, Mesh } from 'three';\nimport { Ball } from './Ball';\nimport { Overlay } from './Overlay';\n\n/**\n * 无限滚动\n */\nconst Demo2v08 = () => {\n  const ref = useRef<GridHelper>(null);\n  return (\n    <>\n      <Canvas\n        camera={{ position: [0, 2.5, 2.5] }}\n        onCreated={({ camera }) => camera.lookAt(0, 1, 0)}\n      >\n        <gridHelper ref={ref} args={[100, 100]} />\n        <Ball floor={ref} />\n        <Stats />\n      </Canvas>\n      <Overlay />\n    </>\n  );\n};\n\nexport default Demo2v08;\n"],"names":["useKeyboard","keyMap","useRef","useEffect","onDocumentKey","e","Ball","floor","ref","v","useMemo","Vector3","q","Quaternion","angularVelocity","useFrame","_","delta","jsxs","jsx","Overlay","Demo2v08","Fragment","Canvas","camera","Stats"],"mappings":"+sEAEO,MAAMA,EAAc,IAAM,CACzB,MAAAC,EAASC,SAAgC,CAAA,CAAE,EAEjDC,OAAAA,EAAAA,UAAU,IAAM,CACR,MAAAC,EAAiBC,GAAqB,CAC1CJ,EAAO,QAAQI,EAAE,IAAI,EAAIA,EAAE,OAAS,SAAA,EAE7B,gBAAA,iBAAiB,UAAWD,CAAa,EACzC,SAAA,iBAAiB,QAASA,CAAa,EACzC,IAAM,CACF,SAAA,oBAAoB,UAAWA,CAAa,EAC5C,SAAA,oBAAoB,QAASA,CAAa,CAAA,CACrD,CACD,EAEMH,EAAO,OAChB,ECbaK,EAER,CAAC,CAAE,MAAAC,KAAY,CACZ,MAAAC,EAAMN,SAAa,IAAI,EACvBD,EAASD,IAETS,EAAIC,EAAAA,QAAQ,IAAM,IAAIC,EAAW,CAAE,CAAA,EACnCC,EAAIF,EAAAA,QAAQ,IAAM,IAAIG,EAAc,CAAE,CAAA,EACtCC,EAAkBJ,EAAAA,QAAQ,IAAM,IAAIC,EAAW,CAAE,CAAA,EAE9C,OAAAI,EAAA,CAACC,EAAGC,IAAU,CACrBhB,EAAO,OAAYa,EAAgB,GAAKG,EAAQ,GAChDhB,EAAO,OAAYa,EAAgB,GAAKG,EAAQ,GAChDhB,EAAO,OAAYa,EAAgB,GAAKG,EAAQ,GAChDhB,EAAO,OAAYa,EAAgB,GAAKG,EAAQ,GAEhDL,EAAE,iBAAiBE,EAAiBG,CAAK,EAAE,UAAU,EAChDT,EAAI,UACLA,EAAA,QAAQ,gBAAgBI,CAAC,EAEbE,EAAA,KAAKL,EAAG,GAAI,EACvBF,EAAM,UAEXA,EAAM,QAAQ,SAAS,GAAKO,EAAgB,EAAIG,EAChDV,EAAM,QAAQ,SAAS,GAAKO,EAAgB,EAAIG,EAEhDV,EAAM,QAAQ,SAAS,EAAIA,EAAM,QAAQ,SAAS,EAAI,GACtDA,EAAM,QAAQ,SAAS,EAAIA,EAAM,QAAQ,SAAS,EAAI,IAAA,CACvD,EAGEW,EAAAA,KAAA,OAAA,CAAK,IAAAV,EAAU,aAAY,EAC1B,SAAA,CAAAW,EAAA,IAAC,iBAAe,EAAA,EAChBA,EAAAA,IAAC,qBAAmB,CAAA,UAAS,EAAC,CAAA,CAChC,CAAA,CAAA,CAEJ,ECzCaC,EAAU,IAEnBF,EAAA,KAAC,MAAI,CAAA,GAAG,eACN,SAAA,CAAAC,EAAAA,IAAC,OAAI,SAAC,GAAA,CAAA,EAAM,IAACA,EAAAA,IAAC,OAAI,SAAC,GAAA,CAAA,EAAM,IAACA,EAAAA,IAAC,OAAI,SAAC,GAAA,CAAA,EAAM,IAACA,EAAAA,IAAC,OAAI,SAAC,GAAA,CAAA,EAAM,WACrD,CAAA,CAAA,ECMEE,GAAW,IAAM,CACf,MAAAb,EAAMN,SAAmB,IAAI,EACnC,OAEIgB,EAAA,KAAAI,WAAA,CAAA,SAAA,CAAAJ,EAAA,KAACK,EAAA,CACC,OAAQ,CAAE,SAAU,CAAC,EAAG,IAAK,GAAG,CAAE,EAClC,UAAW,CAAC,CAAE,OAAAC,KAAaA,EAAO,OAAO,EAAG,EAAG,CAAC,EAEhD,SAAA,CAAAL,EAAA,IAAC,cAAW,IAAAX,EAAU,KAAM,CAAC,IAAK,GAAG,EAAG,EACxCW,EAAAA,IAACb,EAAK,CAAA,MAAOE,CAAK,CAAA,QACjBiB,EAAM,EAAA,CAAA,CAAA,CACT,QACCL,EAAQ,EAAA,CACX,CAAA,CAAA,CAEJ"}
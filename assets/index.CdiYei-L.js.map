{"version":3,"file":"index.CdiYei-L.js","sources":["../../src/components/component-preview-model/index.tsx"],"sourcesContent":["import { Html, OrbitControls, Select, Sky } from '@react-three/drei';\nimport { Canvas, useLoader, useThree } from '@react-three/fiber';\nimport { Suspense, useEffect, useMemo, useRef, useState } from 'react';\nimport { Box3, Vector3 } from 'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\nimport { OrbitControls as OrbitControlsProps } from 'three/examples/jsm/controls/OrbitControls';\nimport { FileButton, Button } from '@mantine/core';\n\nexport const SelectModel = () => {\n  const [localUrl, setLocalUrl] = useState<string>();\n  const handleFileChange = (file: File | null) => {\n    if (!file) {\n      throw new Error('未选择文件');\n    }\n    setLocalUrl(window.URL.createObjectURL(file));\n  };\n  return (\n    <div className=\"h-full relative w-full\">\n      <div className=\"absolute left-2 top-2 z-10\">\n        <FileButton\n          onChange={handleFileChange}\n          accept=\"model/gltf-binary,.glb,.gltf\"\n        >\n          {(props) => <Button {...props}>Upload image</Button>}\n        </FileButton>\n      </div>\n      <PreviewModel url={localUrl} />\n    </div>\n  );\n};\n\nexport default SelectModel;\n\ninterface Props {\n  /**\n   * 展示模型的地址\n   */\n  url?: string;\n  /**\n   * 只展示模型的快照\n   */\n  // isSnapshot?: boolean;\n}\n\nconst PreviewModel: React.FC<Props> = (props) => {\n  return (\n    <Canvas className=\"h-full w-full\">\n      <Sky />\n      <Suspense\n        fallback={\n          <Html className=\"flex flex-col h-full items-center justify-center w-full\">\n            <p className=\"text-lg whitespace-nowrap\">加载中...</p>\n          </Html>\n        }\n      >\n        {props.url && <Model url={props.url} />}\n      </Suspense>\n    </Canvas>\n  );\n};\n\nconst Model: React.FC<Required<Props>> = ({ url }) => {\n  const { scene } = useLoader(GLTFLoader, url, (progress) => {});\n  const { camera } = useThree();\n  const controlsRef = useRef<OrbitControlsProps>(null);\n  // 获取包围盒\n  const box = useMemo(() => new Box3().setFromObject(scene), [scene]);\n\n  // 获取中心点作为控制器目标\n  const target = useMemo(\n    () => new Vector3().copy(box.getCenter(new Vector3())),\n    [box]\n  );\n\n  useEffect(() => {\n    if (!controlsRef.current) {\n      return;\n    }\n    // 计算相机与模型的距离\n    const distance = box.getSize(new Vector3()).length();\n    // 根据模型大小调整相机位置\n    const offset =\n      distance /\n      Math.tan(\n        (Math.PI / 180.0) * (camera as THREE.PerspectiveCamera).fov * 0.5\n      );\n\n    // 设置相机位置和目标点\n    controlsRef.current.target.copy(target);\n    controlsRef.current.object.position.set(\n      target.x,\n      target.y,\n      target.z + offset\n    );\n    controlsRef.current.update();\n  }, [box, camera, target]);\n\n  return (\n    <primitive object={scene}>\n      <OrbitControls\n        ref={controlsRef as any}\n        target={target}\n        enableDamping // 是否启用阻尼效果,默认为false\n        dampingFactor={0.1} // 适中的缓动效果,范围是0到1\n      />\n    </primitive>\n  );\n};\n"],"names":["SelectModel","localUrl","setLocalUrl","useState","handleFileChange","file","jsxs","jsx","FileButton","props","Button","PreviewModel","Canvas","Sky","Suspense","Html","Model","url","scene","useLoader","GLTFLoader","progress","camera","useThree","controlsRef","useRef","box","useMemo","Box3","target","Vector3","useEffect","offset","OrbitControls"],"mappings":"4pTAQO,MAAMA,GAAc,IAAM,CAC/B,KAAM,CAACC,EAAUC,CAAW,EAAIC,EAAiB,SAAA,EAC3CC,EAAoBC,GAAsB,CAC9C,GAAI,CAACA,EACG,MAAA,IAAI,MAAM,OAAO,EAEzBH,EAAY,OAAO,IAAI,gBAAgBG,CAAI,CAAC,CAAA,EAG5C,OAAAC,EAAA,KAAC,MAAI,CAAA,UAAU,yBACb,SAAA,CAACC,EAAAA,IAAA,MAAA,CAAI,UAAU,6BACb,SAAAA,EAAA,IAACC,EAAA,CACC,SAAUJ,EACV,OAAO,+BAEN,SAACK,GAAUF,MAACG,EAAQ,CAAA,GAAGD,EAAO,SAAY,eAAA,CAAA,CAAA,EAE/C,EACAF,EAAAA,IAACI,EAAa,CAAA,IAAKV,CAAU,CAAA,CAC/B,CAAA,CAAA,CAEJ,EAeMU,EAAiCF,GAEnCH,EAAA,KAACM,EAAO,CAAA,UAAU,gBAChB,SAAA,CAAAL,EAAA,IAACM,EAAI,EAAA,EACLN,EAAA,IAACO,EAAA,SAAA,CACC,SACGP,EAAA,IAAAQ,EAAA,CAAK,UAAU,0DACd,eAAC,IAAE,CAAA,UAAU,4BAA4B,SAAA,QAAA,CAAM,CACjD,CAAA,EAGD,WAAM,KAAOR,EAAA,IAACS,EAAM,CAAA,IAAKP,EAAM,IAAK,CAAA,CACvC,CACF,CAAA,CAAA,EAIEO,EAAmC,CAAC,CAAE,IAAAC,KAAU,CACpD,KAAM,CAAE,MAAAC,CAAM,EAAIC,EAAUC,EAAYH,EAAMI,GAAa,CAAA,CAAE,EACvD,CAAE,OAAAC,GAAWC,IACbC,EAAcC,SAA2B,IAAI,EAE7CC,EAAMC,UAAQ,IAAM,IAAIC,EAAA,EAAO,cAAcV,CAAK,EAAG,CAACA,CAAK,CAAC,EAG5DW,EAASF,EAAA,QACb,IAAM,IAAIG,EAAA,EAAU,KAAKJ,EAAI,UAAU,IAAII,CAAS,CAAC,EACrD,CAACJ,CAAG,CAAA,EAGNK,OAAAA,EAAAA,UAAU,IAAM,CACV,GAAA,CAACP,EAAY,QACf,OAKI,MAAAQ,EAFWN,EAAI,QAAQ,IAAII,CAAS,EAAE,SAI1C,KAAK,IACF,KAAK,GAAK,IAAUR,EAAmC,IAAM,EAAA,EAItDE,EAAA,QAAQ,OAAO,KAAKK,CAAM,EAC1BL,EAAA,QAAQ,OAAO,SAAS,IAClCK,EAAO,EACPA,EAAO,EACPA,EAAO,EAAIG,CAAA,EAEbR,EAAY,QAAQ,QACnB,EAAA,CAACE,EAAKJ,EAAQO,CAAM,CAAC,EAGtBtB,EAAAA,IAAC,YAAU,CAAA,OAAQW,EACjB,SAAAX,EAAA,IAAC0B,EAAA,CACC,IAAKT,EACL,OAAAK,EACA,cAAa,GACb,cAAe,EAAA,CAEnB,CAAA,CAAA,CAEJ"}
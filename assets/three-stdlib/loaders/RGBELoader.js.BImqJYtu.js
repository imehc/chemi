import{aM as Y,H as B,F as I,aO as G,L as N}from"../../three/build/three.module.js.jQmR1wrA.js";class W extends Y{constructor(m){super(m),this.type=B}parse(m){const s=function(r,a){switch(r){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(a||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(a||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(a||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(a||""))}},f=`
`,D=function(r,a,n){a=a||1024;let l=r.pos,i=-1,e=0,_="",t=String.fromCharCode.apply(null,new Uint16Array(r.subarray(l,l+128)));for(;0>(i=t.indexOf(f))&&e<a&&l<r.byteLength;)_+=t,e+=t.length,l+=128,t+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(l,l+128)));return-1<i?(r.pos+=e+i+1,_+t.slice(0,i)):!1},u=function(r){const a=/^#\?(\S+)/,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,e={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let _,t;for((r.pos>=r.byteLength||!(_=D(r)))&&s(1,"no header found"),(t=_.match(a))||s(3,"bad initial token"),e.valid|=1,e.programtype=t[1],e.string+=_+`
`;_=D(r),_!==!1;){if(e.string+=_+`
`,_.charAt(0)==="#"){e.comments+=_+`
`;continue}if((t=_.match(n))&&(e.gamma=parseFloat(t[1])),(t=_.match(o))&&(e.exposure=parseFloat(t[1])),(t=_.match(l))&&(e.valid|=2,e.format=t[1]),(t=_.match(i))&&(e.valid|=4,e.height=parseInt(t[1],10),e.width=parseInt(t[2],10)),e.valid&2&&e.valid&4)break}return e.valid&2||s(3,"missing format specifier"),e.valid&4||s(3,"missing image size specifier"),e},v=function(r,a,n){const o=a;if(o<8||o>32767||r[0]!==2||r[1]!==2||r[2]&128)return new Uint8Array(r);o!==(r[2]<<8|r[3])&&s(3,"wrong scanline width");const l=new Uint8Array(4*a*n);l.length||s(4,"unable to allocate buffer space");let i=0,e=0;const _=4*o,t=new Uint8Array(4),E=new Uint8Array(_);let U=n;for(;U>0&&e<r.byteLength;){e+4>r.byteLength&&s(1),t[0]=r[e++],t[1]=r[e++],t[2]=r[e++],t[3]=r[e++],(t[0]!=2||t[1]!=2||(t[2]<<8|t[3])!=o)&&s(3,"bad rgbe scanline format");let R=0,c;for(;R<_&&e<r.byteLength;){c=r[e++];const h=c>128;if(h&&(c-=128),(c===0||R+c>_)&&s(3,"bad scanline data"),h){const g=r[e++];for(let V=0;V<c;V++)E[R++]=g}else E.set(r.subarray(e,e+c),R),R+=c,e+=c}const C=o;for(let h=0;h<C;h++){let g=0;l[i]=E[h+g],g+=o,l[i+1]=E[h+g],g+=o,l[i+2]=E[h+g],g+=o,l[i+3]=E[h+g],i+=4}U--}return l},P=function(r,a,n,o){const l=r[a+3],i=Math.pow(2,l-128)/255;n[o+0]=r[a+0]*i,n[o+1]=r[a+1]*i,n[o+2]=r[a+2]*i,n[o+3]=1},z=function(r,a,n,o){const l=r[a+3],i=Math.pow(2,l-128)/255;n[o+0]=G.toHalfFloat(Math.min(r[a+0]*i,65504)),n[o+1]=G.toHalfFloat(Math.min(r[a+1]*i,65504)),n[o+2]=G.toHalfFloat(Math.min(r[a+2]*i,65504)),n[o+3]=G.toHalfFloat(1)},w=new Uint8Array(m);w.pos=0;const d=u(w),k=d.width,H=d.height,y=v(w.subarray(w.pos),k,H);let L,F,p;switch(this.type){case I:p=y.length/4;const r=new Float32Array(p*4);for(let n=0;n<p;n++)P(y,n*4,r,n*4);L=r,F=I;break;case B:p=y.length/4;const a=new Uint16Array(p*4);for(let n=0;n<p;n++)z(y,n*4,a,n*4);L=a,F=B;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:k,height:H,data:L,header:d.string,gamma:d.gamma,exposure:d.exposure,type:F}}setDataType(m){return this.type=m,this}load(m,b,M,A){function S(s,T){switch(s.type){case I:case B:"colorSpace"in s?s.colorSpace="srgb-linear":s.encoding=3e3,s.minFilter=N,s.magFilter=N,s.generateMipmaps=!1,s.flipY=!0;break}b&&b(s,T)}return super.load(m,S,M,A)}}export{W as R};

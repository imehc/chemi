import{T as hr,ai as Sr,H as ie,F as he,R as pr,aj as Er,L as Ze,ak as me}from"../../three/build/three.module.js.mjdRT5l4.js";import{u as ve}from"../../fflate/esm/browser.js.AjTAyrFi.js";const re="colorSpace"in new hr;class Br extends Sr{constructor(L){super(L),this.type=ie}parse(L){const Me=Math.pow(2.7182818,2.2);function De(e,r){for(var n=0,a=0;a<65536;++a)(a==0||e[a>>3]&1<<(a&7))&&(r[n++]=a);for(var t=n-1;n<65536;)r[n++]=0;return t}function Fe(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const H={l:0,c:0,lc:0};function Ie(e,r,n,a,t){for(;n<e;)r=r<<8|ye(a,t),n+=8;n-=e,H.l=r>>n&(1<<e)-1,H.c=r,H.lc=n}const $=new Array(59);function fe(e){for(var r=0;r<=58;++r)$[r]=0;for(var r=0;r<65537;++r)$[e[r]]+=1;for(var n=0,r=58;r>0;--r){var a=n+$[r]>>1;$[r]=n,n=a}for(var r=0;r<65537;++r){var t=e[r];t>0&&(e[r]=t|$[t]++<<6)}}function be(e,r,n,a,t,i,l){for(var v=n,u=0,s=0;t<=i;t++){if(v.value-n.value>a)return!1;Ie(6,u,s,e,v);var c=H.l;if(u=H.c,s=H.lc,l[t]=c,c==63){if(v.value-n.value>a)throw"Something wrong with hufUnpackEncTable";Ie(8,u,s,e,v);var o=H.l+6;if(u=H.c,s=H.lc,t+o>i+1)throw"Something wrong with hufUnpackEncTable";for(;o--;)l[t++]=0;t--}else if(c>=59){var o=c-59+2;if(t+o>i+1)throw"Something wrong with hufUnpackEncTable";for(;o--;)l[t++]=0;t--}}fe(l)}function we(e){return e&63}function _e(e){return e>>6}function ke(e,r,n,a){for(;r<=n;r++){var t=_e(e[r]),i=we(e[r]);if(t>>i)throw"Invalid table entry";if(i>14){var l=a[t>>i-14];if(l.len)throw"Invalid table entry";if(l.lit++,l.p){var v=l.p;l.p=new Array(l.lit);for(var u=0;u<l.lit-1;++u)l.p[u]=v[u]}else l.p=new Array(1);l.p[l.lit-1]=r}else if(i)for(var s=0,u=1<<14-i;u>0;u--){var l=a[(t<<14-i)+s];if(l.len||l.p)throw"Invalid table entry";l.len=i,l.lit=r,s++}}return!0}const X={c:0,lc:0};function oe(e,r,n,a){e=e<<8|ye(n,a),r+=8,X.c=e,X.lc=r}const W={c:0,lc:0};function se(e,r,n,a,t,i,l,v,u,s){if(e==r){a<8&&(oe(n,a,t,l),n=X.c,a=X.lc),a-=8;var c=n>>a,c=new Uint8Array([c])[0];if(u.value+c>s)return!1;for(var o=v[u.value-1];c-- >0;)v[u.value++]=o}else if(u.value<s)v[u.value++]=e;else return!1;W.c=n,W.lc=a}function ue(e){return e&65535}function Ue(e){var r=ue(e);return r>32767?r-65536:r}const A={a:0,b:0};function K(e,r){var n=Ue(e),a=Ue(r),t=a,i=n+(t&1)+(t>>1),l=i,v=i-t;A.a=l,A.b=v}function d(e,r){var n=ue(e),a=ue(r),t=n-(a>>1)&65535,i=a+t-32768&65535;A.a=i,A.b=t}function Be(e,r,n,a,t,i,l){for(var v=l<16384,u=n>t?t:n,s=1,c;s<=u;)s<<=1;for(s>>=1,c=s,s>>=1;s>=1;){for(var o=0,y=o+i*(t-c),S=i*s,p=i*c,E=a*s,I=a*c,U,N,O,D;o<=y;o+=p){for(var g=o,z=o+a*(n-c);g<=z;g+=I){var T=g+E,Z=g+S,x=Z+E;v?(K(e[g+r],e[Z+r]),U=A.a,O=A.b,K(e[T+r],e[x+r]),N=A.a,D=A.b,K(U,N),e[g+r]=A.a,e[T+r]=A.b,K(O,D),e[Z+r]=A.a,e[x+r]=A.b):(d(e[g+r],e[Z+r]),U=A.a,O=A.b,d(e[T+r],e[x+r]),N=A.a,D=A.b,d(U,N),e[g+r]=A.a,e[T+r]=A.b,d(O,D),e[Z+r]=A.a,e[x+r]=A.b)}if(n&s){var Z=g+S;v?K(e[g+r],e[Z+r]):d(e[g+r],e[Z+r]),U=A.a,e[Z+r]=A.b,e[g+r]=U}}if(t&s)for(var g=o,z=o+a*(n-c);g<=z;g+=I){var T=g+E;v?K(e[g+r],e[T+r]):d(e[g+r],e[T+r]),U=A.a,e[T+r]=A.b,e[g+r]=U}c=s,s>>=1}return o}function ze(e,r,n,a,t,i,l,v,u,s){for(var c=0,o=0,y=v,S=Math.trunc(t.value+(i+7)/8);t.value<S;)for(oe(c,o,n,t),c=X.c,o=X.lc;o>=14;){var p=c>>o-14&16383,E=r[p];if(E.len)o-=E.len,se(E.lit,l,c,o,n,a,t,u,s,y),c=W.c,o=W.lc;else{if(!E.p)throw"hufDecode issues";var I;for(I=0;I<E.lit;I++){for(var U=we(e[E.p[I]]);o<U&&t.value<S;)oe(c,o,n,t),c=X.c,o=X.lc;if(o>=U&&_e(e[E.p[I]])==(c>>o-U&(1<<U)-1)){o-=U,se(E.p[I],l,c,o,n,a,t,u,s,y),c=W.c,o=W.lc;break}}if(I==E.lit)throw"hufDecode issues"}}var N=8-i&7;for(c>>=N,o-=N;o>0;){var E=r[c<<14-o&16383];if(E.len)o-=E.len,se(E.lit,l,c,o,n,a,t,u,s,y),c=W.c,o=W.lc;else throw"hufDecode issues"}return!0}function Ce(e,r,n,a,t,i){var l={value:0},v=n.value,u=F(r,n),s=F(r,n);n.value+=4;var c=F(r,n);if(n.value+=4,u<0||u>=65537||s<0||s>=65537)throw"Something wrong with HUF_ENCSIZE";var o=new Array(65537),y=new Array(16384);Fe(y);var S=a-(n.value-v);if(be(e,r,n,S,u,s,o),c>8*(a-(n.value-v)))throw"Something wrong with hufUncompress";ke(o,u,s,y),ze(o,y,e,r,n,c,s,i,t,l)}function Le(e,r,n){for(var a=0;a<n;++a)r[a]=e[r[a]]}function Ne(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function ge(e,r){for(var n=0,a=Math.floor((e.length+1)/2),t=0,i=e.length-1;!(t>i||(r[t++]=e[n++],t>i));)r[t++]=e[a++]}function Te(e){for(var r=e.byteLength,n=new Array,a=0,t=new DataView(e);r>0;){var i=t.getInt8(a++);if(i<0){var l=-i;r-=l+1;for(var v=0;v<l;v++)n.push(t.getUint8(a++))}else{var l=i;r-=2;for(var u=t.getUint8(a++),v=0;v<l+1;v++)n.push(u)}}return n}function He(e,r,n,a,t,i){var T=new DataView(i.buffer),l=n[e.idx[0]].width,v=n[e.idx[0]].height,u=3,s=Math.floor(l/8),c=Math.ceil(l/8),o=Math.ceil(v/8),y=l-(c-1)*8,S=v-(o-1)*8,p={value:0},E=new Array(u),I=new Array(u),U=new Array(u),N=new Array(u),O=new Array(u);for(let C=0;C<u;++C)O[C]=r[e.idx[C]],E[C]=C<1?0:E[C-1]+c*o,I[C]=new Float32Array(64),U[C]=new Uint16Array(64),N[C]=new Uint16Array(c*64);for(let C=0;C<o;++C){var D=8;C==o-1&&(D=S);var g=8;for(let R=0;R<c;++R){R==c-1&&(g=y);for(let _=0;_<u;++_)U[_].fill(0),U[_][0]=t[E[_]++],xe(p,a,U[_]),Ge(U[_],I[_]),Xe(I[_]);We(I);for(let _=0;_<u;++_)Pe(I[_],N[_],R*64)}let M=0;for(let R=0;R<u;++R){const _=n[e.idx[R]].type;for(let B=8*C;B<8*C+D;++B){M=O[R][B];for(let Y=0;Y<s;++Y){const f=Y*64+(B&7)*8;T.setUint16(M+0*2*_,N[R][f+0],!0),T.setUint16(M+1*2*_,N[R][f+1],!0),T.setUint16(M+2*2*_,N[R][f+2],!0),T.setUint16(M+3*2*_,N[R][f+3],!0),T.setUint16(M+4*2*_,N[R][f+4],!0),T.setUint16(M+5*2*_,N[R][f+5],!0),T.setUint16(M+6*2*_,N[R][f+6],!0),T.setUint16(M+7*2*_,N[R][f+7],!0),M+=8*2*_}}if(s!=c)for(let B=8*C;B<8*C+D;++B){const Y=O[R][B]+8*s*2*_,f=s*64+(B&7)*8;for(let P=0;P<g;++P)T.setUint16(Y+P*2*_,N[R][f+P],!0)}}}for(var z=new Uint16Array(l),T=new DataView(i.buffer),Z=0;Z<u;++Z){n[e.idx[Z]].decoded=!0;var x=n[e.idx[Z]].type;if(n[Z].type==2)for(var ee=0;ee<v;++ee){const C=O[Z][ee];for(var k=0;k<l;++k)z[k]=T.getUint16(C+k*2*x,!0);for(var k=0;k<l;++k)T.setFloat32(C+k*2*x,h(z[k]),!0)}}}function xe(e,r,n){for(var a,t=1;t<64;)a=r[e.value],a==65280?t=64:a>>8==255?t+=a&255:(n[t]=a,t++),e.value++}function Ge(e,r){r[0]=h(e[0]),r[1]=h(e[1]),r[2]=h(e[5]),r[3]=h(e[6]),r[4]=h(e[14]),r[5]=h(e[15]),r[6]=h(e[27]),r[7]=h(e[28]),r[8]=h(e[2]),r[9]=h(e[4]),r[10]=h(e[7]),r[11]=h(e[13]),r[12]=h(e[16]),r[13]=h(e[26]),r[14]=h(e[29]),r[15]=h(e[42]),r[16]=h(e[3]),r[17]=h(e[8]),r[18]=h(e[12]),r[19]=h(e[17]),r[20]=h(e[25]),r[21]=h(e[30]),r[22]=h(e[41]),r[23]=h(e[43]),r[24]=h(e[9]),r[25]=h(e[11]),r[26]=h(e[18]),r[27]=h(e[24]),r[28]=h(e[31]),r[29]=h(e[40]),r[30]=h(e[44]),r[31]=h(e[53]),r[32]=h(e[10]),r[33]=h(e[19]),r[34]=h(e[23]),r[35]=h(e[32]),r[36]=h(e[39]),r[37]=h(e[45]),r[38]=h(e[52]),r[39]=h(e[54]),r[40]=h(e[20]),r[41]=h(e[22]),r[42]=h(e[33]),r[43]=h(e[38]),r[44]=h(e[46]),r[45]=h(e[51]),r[46]=h(e[55]),r[47]=h(e[60]),r[48]=h(e[21]),r[49]=h(e[34]),r[50]=h(e[37]),r[51]=h(e[47]),r[52]=h(e[50]),r[53]=h(e[56]),r[54]=h(e[59]),r[55]=h(e[61]),r[56]=h(e[35]),r[57]=h(e[36]),r[58]=h(e[48]),r[59]=h(e[49]),r[60]=h(e[57]),r[61]=h(e[58]),r[62]=h(e[62]),r[63]=h(e[63])}function Xe(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),a=.5*Math.cos(3.14159/8),t=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(5*3.14159/16),l=.5*Math.cos(3*3.14159/8),v=.5*Math.cos(7*3.14159/16);for(var u=new Array(4),s=new Array(4),c=new Array(4),o=new Array(4),y=0;y<8;++y){var S=y*8;u[0]=a*e[S+2],u[1]=l*e[S+2],u[2]=a*e[S+6],u[3]=l*e[S+6],s[0]=n*e[S+1]+t*e[S+3]+i*e[S+5]+v*e[S+7],s[1]=t*e[S+1]-v*e[S+3]-n*e[S+5]-i*e[S+7],s[2]=i*e[S+1]-n*e[S+3]+v*e[S+5]+t*e[S+7],s[3]=v*e[S+1]-i*e[S+3]+t*e[S+5]-n*e[S+7],c[0]=r*(e[S+0]+e[S+4]),c[3]=r*(e[S+0]-e[S+4]),c[1]=u[0]+u[3],c[2]=u[1]-u[2],o[0]=c[0]+c[1],o[1]=c[3]+c[2],o[2]=c[3]-c[2],o[3]=c[0]-c[1],e[S+0]=o[0]+s[0],e[S+1]=o[1]+s[1],e[S+2]=o[2]+s[2],e[S+3]=o[3]+s[3],e[S+4]=o[3]-s[3],e[S+5]=o[2]-s[2],e[S+6]=o[1]-s[1],e[S+7]=o[0]-s[0]}for(var p=0;p<8;++p)u[0]=a*e[16+p],u[1]=l*e[16+p],u[2]=a*e[48+p],u[3]=l*e[48+p],s[0]=n*e[8+p]+t*e[24+p]+i*e[40+p]+v*e[56+p],s[1]=t*e[8+p]-v*e[24+p]-n*e[40+p]-i*e[56+p],s[2]=i*e[8+p]-n*e[24+p]+v*e[40+p]+t*e[56+p],s[3]=v*e[8+p]-i*e[24+p]+t*e[40+p]-n*e[56+p],c[0]=r*(e[p]+e[32+p]),c[3]=r*(e[p]-e[32+p]),c[1]=u[0]+u[3],c[2]=u[1]-u[2],o[0]=c[0]+c[1],o[1]=c[3]+c[2],o[2]=c[3]-c[2],o[3]=c[0]-c[1],e[0+p]=o[0]+s[0],e[8+p]=o[1]+s[1],e[16+p]=o[2]+s[2],e[24+p]=o[3]+s[3],e[32+p]=o[3]-s[3],e[40+p]=o[2]-s[2],e[48+p]=o[1]-s[1],e[56+p]=o[0]-s[0]}function We(e){for(var r=0;r<64;++r){var n=e[0][r],a=e[1][r],t=e[2][r];e[0][r]=n+1.5747*t,e[1][r]=n-.1873*a-.4682*t,e[2][r]=n+1.8556*a}}function Pe(e,r,n){for(var a=0;a<64;++a)r[n+a]=me.toHalfFloat(Ye(e[a]))}function Ye(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(Me,Math.abs(e)-1)}function Ae(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Ke(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(Te(r)),a=new Uint8Array(n.length);return Ne(n),ge(n,a),new DataView(a.buffer)}function ce(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=ve(r),a=new Uint8Array(n.length);return Ne(n),ge(n,a),new DataView(a.buffer)}function de(e){for(var r=e.viewer,n={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),t=new Uint8Array(8192),i=0,l=new Array(e.channels),v=0;v<e.channels;v++)l[v]={},l[v].start=i,l[v].end=l[v].start,l[v].nx=e.width,l[v].ny=e.lines,l[v].size=e.type,i+=l[v].nx*l[v].ny*l[v].size;var u=Q(r,n),s=Q(r,n);if(s>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(u<=s)for(var v=0;v<s-u+1;v++)t[v+u]=q(r,n);var c=new Uint16Array(65536),o=De(t,c),y=F(r,n);Ce(e.array,r,n,y,a,i);for(var v=0;v<e.channels;++v)for(var S=l[v],p=0;p<l[v].size;++p)Be(a,S.start+p,S.nx,S.size,S.ny,S.nx*S.size,o);Le(c,a,i);for(var E=0,I=new Uint8Array(a.buffer.byteLength),U=0;U<e.lines;U++)for(var N=0;N<e.channels;N++){var S=l[N],O=S.nx*S.size,D=new Uint8Array(a.buffer,S.end*2,O*2);I.set(D,E),E+=O*2,S.end+=O}return new DataView(I.buffer)}function qe(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=ve(r);const a=e.lines*e.channels*e.width,t=e.type==1?new Uint16Array(a):new Uint32Array(a);let i=0,l=0;const v=new Array(4);for(let u=0;u<e.lines;u++)for(let s=0;s<e.channels;s++){let c=0;switch(e.type){case 1:v[0]=i,v[1]=v[0]+e.width,i=v[1]+e.width;for(let o=0;o<e.width;++o){const y=n[v[0]++]<<8|n[v[1]++];c+=y,t[l]=c,l++}break;case 2:v[0]=i,v[1]=v[0]+e.width,v[2]=v[1]+e.width,i=v[2]+e.width;for(let o=0;o<e.width;++o){const y=n[v[0]++]<<24|n[v[1]++]<<16|n[v[2]++]<<8;c+=y,t[l]=c,l++}break}}return new DataView(t.buffer)}function Re(e){var r=e.viewer,n={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),t={version:b(r,n),unknownUncompressedSize:b(r,n),unknownCompressedSize:b(r,n),acCompressedSize:b(r,n),dcCompressedSize:b(r,n),rleCompressedSize:b(r,n),rleUncompressedSize:b(r,n),rleRawSize:b(r,n),totalAcUncompressedCount:b(r,n),totalDcUncompressedCount:b(r,n),acCompression:b(r,n)};if(t.version<2)throw"EXRLoader.parse: "+j.compression+" version "+t.version+" is unsupported";for(var i=new Array,l=Q(r,n)-2;l>0;){var v=ae(r.buffer,n),u=q(r,n),s=u>>2&3,c=(u>>4)-1,o=new Int8Array([c])[0],y=q(r,n);i.push({name:v,index:o,type:y,compression:s}),l-=v.length+3}for(var S=j.channels,p=new Array(e.channels),E=0;E<e.channels;++E){var I=p[E]={},U=S[E];I.name=U.name,I.compression=0,I.decoded=!1,I.type=U.pixelType,I.pLinear=U.pLinear,I.width=e.width,I.height=e.lines}for(var N={idx:new Array(3)},O=0;O<e.channels;++O)for(var I=p[O],E=0;E<i.length;++E){var D=i[E];I.name==D.name&&(I.compression=D.compression,D.index>=0&&(N.idx[D.index]=O),I.offset=O)}if(t.acCompressedSize>0)switch(t.acCompression){case 0:var T=new Uint16Array(t.totalAcUncompressedCount);Ce(e.array,r,n,t.acCompressedSize,T,t.totalAcUncompressedCount);break;case 1:var g=e.array.slice(n.value,n.value+t.totalAcUncompressedCount),z=ve(g),T=new Uint16Array(z.buffer);n.value+=t.totalAcUncompressedCount;break}if(t.dcCompressedSize>0){var Z={array:e.array,offset:n,size:t.dcCompressedSize},x=new Uint16Array(ce(Z).buffer);n.value+=t.dcCompressedSize}if(t.rleRawSize>0){var g=e.array.slice(n.value,n.value+t.rleCompressedSize),z=ve(g),ee=Te(z.buffer);n.value+=t.rleCompressedSize}for(var k=0,C=new Array(p.length),E=0;E<C.length;++E)C[E]=new Array;for(var M=0;M<e.lines;++M)for(var R=0;R<p.length;++R)C[R].push(k),k+=p[R].width*e.type*2;He(N,C,p,T,x,a);for(var E=0;E<p.length;++E){var I=p[E];if(!I.decoded)switch(I.compression){case 2:for(var _=0,B=0,M=0;M<e.lines;++M){for(var Y=C[E][_],f=0;f<I.width;++f){for(var P=0;P<2*I.type;++P)a[Y++]=ee[B+P*I.width*I.height];B++}_++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(a.buffer)}function ae(e,r){for(var n=new Uint8Array(e),a=0;n[r.value+a]!=0;)a+=1;var t=new TextDecoder().decode(n.slice(r.value,r.value+a));return r.value=r.value+a+1,t}function $e(e,r,n){var a=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,a}function Je(e,r){var n=J(e,r),a=F(e,r);return[n,a]}function Qe(e,r){var n=F(e,r),a=F(e,r);return[n,a]}function J(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+4,n}function F(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function ye(e,r){var n=e[r.value];return r.value=r.value+1,n}function q(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}const b=function(e,r){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(r.value,!0)):n=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,n};function m(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function Ve(e,r){return me.toHalfFloat(m(e,r))}function h(e){var r=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(r?r===31?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):6103515625e-14*(n/1024))}function Q(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function je(e,r){return h(Q(e,r))}function er(e,r,n,a){for(var t=n.value,i=[];n.value<t+a-1;){var l=ae(r,n),v=J(e,n),u=q(e,n);n.value+=3;var s=J(e,n),c=J(e,n);i.push({name:l,pixelType:v,pLinear:u,xSampling:s,ySampling:c})}return n.value+=1,i}function rr(e,r){var n=m(e,r),a=m(e,r),t=m(e,r),i=m(e,r),l=m(e,r),v=m(e,r),u=m(e,r),s=m(e,r);return{redX:n,redY:a,greenX:t,greenY:i,blueX:l,blueY:v,whiteX:u,whiteY:s}}function nr(e,r){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],a=q(e,r);return n[a]}function ar(e,r){var n=F(e,r),a=F(e,r),t=F(e,r),i=F(e,r);return{xMin:n,yMin:a,xMax:t,yMax:i}}function tr(e,r){var n=["INCREASING_Y"],a=q(e,r);return n[a]}function ir(e,r){var n=m(e,r),a=m(e,r);return[n,a]}function vr(e,r){var n=m(e,r),a=m(e,r),t=m(e,r);return[n,a,t]}function lr(e,r,n,a,t){if(a==="string"||a==="stringvector"||a==="iccProfile")return $e(r,n,t);if(a==="chlist")return er(e,r,n,t);if(a==="chromaticities")return rr(e,n);if(a==="compression")return nr(e,n);if(a==="box2i")return ar(e,n);if(a==="lineOrder")return tr(e,n);if(a==="float")return m(e,n);if(a==="v2f")return ir(e,n);if(a==="v3f")return vr(e,n);if(a==="int")return J(e,n);if(a==="rational")return Je(e,n);if(a==="timecode")return Qe(e,n);if(a==="preview")return n.value+=t,"skipped";n.value+=t}function or(e,r,n){const a={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";a.version=e.getUint8(4);const t=e.getUint8(5);a.spec={singleTile:!!(t&2),longName:!!(t&4),deepFormat:!!(t&8),multiPart:!!(t&16)},n.value=8;for(var i=!0;i;){var l=ae(r,n);if(l==0)i=!1;else{var v=ae(r,n),u=F(e,n),s=lr(e,r,n,v,u);s===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${v}'.`):a[l]=s}}if(t!=0)throw console.error("EXRHeader:",a),"THREE.EXRLoader: provided file is currently unsupported.";return a}function sr(e,r,n,a,t){const i={size:0,viewer:r,array:n,offset:a,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[re?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=Ae;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=Ke;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=ce;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=ce;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=de;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=qe;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=Re;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=Re;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,i.type==1)switch(t){case he:i.getter=je,i.inputSize=2;break;case ie:i.getter=Q,i.inputSize=2;break}else if(i.type==2)switch(t){case he:i.getter=m,i.inputSize=4;break;case ie:i.getter=Ve,i.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var l=0;l<i.blockCount;l++)b(r,a);i.outputChannels=i.channels==3?4:i.channels;const v=i.width*i.height*i.outputChannels;switch(t){case he:i.byteArray=new Float32Array(v),i.channels<i.outputChannels&&i.byteArray.fill(1,0,v);break;case ie:i.byteArray=new Uint16Array(v),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,v);break;default:console.error("THREE.EXRLoader: unsupported type: ",t);break}return i.bytesPerLine=i.width*i.inputSize*i.channels,i.outputChannels==4?i.format=pr:i.format=Er,re?i.colorSpace="srgb-linear":i.encoding=3e3,i}const te=new DataView(L),ur=new Uint8Array(L),V={value:0},j=or(te,L,V),w=sr(j,te,ur,V,this.type),Oe={value:0},cr={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<w.height/w.scanlineBlockSize;e++){const r=F(te,V);w.size=F(te,V),w.lines=r+w.scanlineBlockSize>w.height?w.height-r:w.scanlineBlockSize;const a=w.size<w.lines*w.bytesPerLine?w.uncompress(w):Ae(w);V.value+=w.size;for(let t=0;t<w.scanlineBlockSize;t++){const i=t+e*w.scanlineBlockSize;if(i>=w.height)break;for(let l=0;l<w.channels;l++){const v=cr[j.channels[l].name];for(let u=0;u<w.width;u++){Oe.value=(t*(w.channels*w.width)+l*w.width+u)*w.inputSize;const s=(w.height-1-i)*(w.width*w.outputChannels)+u*w.outputChannels+v;w.byteArray[s]=w.getter(a,Oe)}}}}return{header:j,width:w.width,height:w.height,data:w.byteArray,format:w.format,[re?"colorSpace":"encoding"]:w[re?"colorSpace":"encoding"],type:this.type}}setDataType(L){return this.type=L,this}load(L,le,Se,pe){function Ee(G,ne){re?G.colorSpace=ne.colorSpace:G.encoding=ne.encoding,G.minFilter=Ze,G.magFilter=Ze,G.generateMipmaps=!1,G.flipY=!1,le&&le(G,ne)}return super.load(L,Ee,Se,pe)}}export{Br as E};
//# sourceMappingURL=EXRLoader.js.eVEMXDI4.js.map

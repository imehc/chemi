{"version":3,"file":"index.dK-umQed.js","sources":["../../src/demo2/07/Overlay.tsx","../../src/demo2/07/use_octree.ts","../../src/demo2/07/use_octree_helper.ts","../../src/demo2/07/Constants.ts","../../src/demo2/07/SphereCollider.tsx","../../src/demo2/07/Ball.tsx","../../src/demo2/07/use_keyboard.ts","../../src/demo2/07/Player.tsx","../../src/demo2/07/Physics.tsx","../../src/demo2/07/index.tsx"],"sourcesContent":["import './index.css';\n\nexport const Overlay = () => {\n  return (\n    <div id=\"instructions\">\n      <kbd>W</kbd>\n      <kbd>A</kbd>\n      <kbd>S</kbd>\n      <kbd>D</kbd> to move.\n      <br />\n      Space to jump.\n      <br />\n      Mouse click to shoot.\n    </div>\n  );\n};\n","import { useMemo } from 'react';\nimport { Group, Object3DEventMap, Scene } from 'three';\nimport { Octree } from 'three/examples/jsm/math/Octree';\n\n/**\n * 用于从三维场景中构建八叉树,以支持更高效的空间查询需求\n */\nexport const useOctree = (scene: Group<Object3DEventMap>) => {\n  const octree = useMemo(() => {\n    console.log('new Octree');\n    return new Octree().fromGraphNode(scene);\n  }, [scene]);\n\n  return octree;\n};\n","import { useThree } from '@react-three/fiber';\nimport { useEffect } from 'react';\nimport { Octree } from 'three/examples/jsm/math/Octree';\nimport { OctreeHelper } from 'three/examples/jsm/helpers/OctreeHelper';\nimport { useControls } from 'leva';\n\nexport const useOctreeHelper = (octree: Octree) => {\n  const { scene } = useThree();\n\n  useEffect(() => {\n    console.log('new OctreeHelper');\n    const helper = new OctreeHelper(octree, 'hotpink');\n    helper.name = 'octreeHelper';\n    scene.add(helper);\n\n    return () => {\n      console.log('removing OctreeHelper');\n      scene.remove(helper);\n    };\n  }, [octree, scene]);\n\n  useControls('Octree Helper 八叉树', {\n    visible: {\n      value: false,\n      onChange: (v) => {\n        scene.getObjectByName('octreeHelper')!.visible = v;\n        if (document.getElementById('Octree Helper.visible'))\n          document.getElementById('Octree Helper.visible')!.blur();\n      },\n    },\n  });\n};\n","import { Vector3 } from 'three';\n\nexport const Gravity = 30;\nexport const ballCount = 100;\nexport const radius = 0.2;\nexport const balls = [...Array(ballCount)].map(() => ({\n  position: [Math.random() * 50 - 25, 20, Math.random() * 50 - 25],\n}));\nexport const v1 = new Vector3();\nexport const v2 = new Vector3();\nexport const v3 = new Vector3();\nexport const frameSteps = 5;\n","import { useFrame } from '@react-three/fiber';\nimport {\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n} from 'react';\nimport { Group, Sphere, Vector3 } from 'three';\nimport { Octree } from 'three/examples/jsm/math/Octree';\nimport * as Constants from './Constants';\nimport { Collider } from './Physics';\n\ninterface Prpos {\n  id: number;\n  radius: number;\n  octree: Octree;\n  position: number[];\n  colliders: Collider[];\n  /**\n   * 检测球体与球体之间的碰撞\n   */\n  checkSphereCollisions(sphere: Sphere, velocity: Vector3): void;\n}\n\n/**\n * 球形碰撞体\n */\nexport const SphereCollider: React.FC<PropsWithChildren<Prpos>> = ({\n  id,\n  radius,\n  octree,\n  position,\n  colliders,\n  checkSphereCollisions,\n  children,\n}) => {\n  const ref = useRef<Group>(null);\n  const sphere = useMemo(\n    () => new Sphere(new Vector3(...position), radius),\n    [position, radius]\n  );\n  const velocity = useMemo(() => new Vector3(), []);\n\n  useEffect(() => {\n    console.log('adding reference to this sphere collider');\n    colliders[id] = { sphere: sphere, velocity: velocity };\n  }, [colliders, id, sphere, velocity]);\n\n  const updateSphere = useCallback<\n    (delta: number, octree: Octree, sphere: Sphere, velocity: Vector3) => void\n  >(\n    (delta, octree, sphere, velocity) => {\n      // 使用向量加法更新球体中心位置,根据速度向量velocity和时间间隔delta\n      sphere.center.addScaledVector(velocity, delta);\n      // 检测球体与其他物体是否相交\n      const result = octree.sphereIntersect(sphere);\n      // 如果检测到相交\n      if (result) {\n        // 计算法向量和速度向量的点积,作为反弹系数\n        const factor = -result.normal.dot(velocity);\n        // 根据法向量和系数更新速度向量,实现反弹\n        velocity.addScaledVector(result.normal, factor * 1.5);\n        // 根据法向量和深度值调整球体位置\n        sphere.center.add(result.normal.multiplyScalar(result.depth));\n      } else {\n        // 考虑重力下落\n        velocity.y -= Constants.Gravity * delta;\n      }\n      const damping = Math.exp(-1.5 * delta) - 1;\n      velocity.addScaledVector(velocity, damping);\n\n      checkSphereCollisions(sphere, velocity);\n      if (!ref.current) return;\n      // 更新三维场景球体对象\n      ref.current.position.copy(sphere.center);\n    },\n    [checkSphereCollisions]\n  );\n\n  useFrame((_, delta) => {\n    const deltaSteps = Math.min(0.05, delta) / Constants.frameSteps;\n    for (let i = 0; i < Constants.frameSteps; i++) {\n      updateSphere(deltaSteps, octree, sphere, velocity);\n    }\n  });\n\n  return <group ref={ref}>{children}</group>;\n};\n","interface Props {\n  radius: number;\n}\n\n/**\n * 球\n */\nexport const Ball: React.FC<Props> = ({ radius }) => {\n  return (\n    <mesh castShadow>\n      <sphereGeometry args={[radius]} />\n      <meshStandardMaterial />\n    </mesh>\n  );\n};\n","import { useEffect, useRef } from 'react';\n\nexport const useKeyboard = () => {\n  const keyMap = useRef<Record<string, unknown>>({});\n\n  useEffect(() => {\n    const onDocumentKey = (e: KeyboardEvent) => {\n      keyMap.current[e.code] = e.type === 'keydown';\n    };\n    document.addEventListener('keydown', onDocumentKey);\n    document.addEventListener('keyup', onDocumentKey);\n    return () => {\n      document.removeEventListener('keydown', onDocumentKey);\n      document.removeEventListener('keyup', onDocumentKey);\n    };\n  });\n\n  return keyMap.current;\n};\n","import { useFrame, useThree } from '@react-three/fiber';\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { Camera, Vector3 } from 'three';\nimport { Octree } from 'three/examples/jsm/math/Octree';\nimport { Capsule } from 'three/examples/jsm/math/Capsule.js';\nimport { useKeyboard } from './use_keyboard';\nimport { Collider } from './Physics';\n\ninterface Props {\n  ballCount: number;\n  octree: Octree;\n  colliders: Collider[];\n}\n\nconst GRAVITY = 30;\nconst STEPS_PER_FRAME = 5;\n\nexport const Player: React.FC<Props> = ({ ballCount, octree, colliders }) => {\n  const playerOnFloor = useRef<boolean>(false);\n  const playerVelocity = useMemo(() => new Vector3(), []);\n  const playerDirection = useMemo(() => new Vector3(), []);\n  const capsule = useMemo(\n    () => new Capsule(new Vector3(0, 10, 0), new Vector3(0, 11, 0), 0.5),\n    []\n  );\n\n  const { camera } = useThree();\n  let clicked = 0;\n\n  const throwBall = useCallback<\n    (\n      camera: Camera,\n      capsule: Capsule,\n      playerDirection: Vector3,\n      playerVelocity: Vector3,\n      count: number\n    ) => void\n  >(\n    (camera, capsule, playerDirection, playerVelocity, count) => {\n      // 从colliders数组中获取第count个球体的数据\n      const { sphere, velocity } = colliders[count % ballCount];\n      // 获取摄像机当前世界坐标下的前方向量playerDirection\n      camera.getWorldDirection(playerDirection);\n      // 将球体中心位置设置为胶囊末端位置,并沿前方向量移动半径1.5倍长度\n      sphere?.center\n        .copy(capsule.end)\n        .addScaledVector(playerDirection, capsule.radius * 1.5);\n      // 将球体速度向量初始化为前方向量方向,并缩放为大小50\n      velocity.copy(playerDirection).multiplyScalar(50);\n      // 将玩家控制产生的速度向量playerVelocity以2倍缩放添加到球体速度上\n      velocity.addScaledVector(playerVelocity, 2);\n    },\n    [ballCount, colliders]\n  );\n\n  const onPointerDown = useCallback(() => {\n    throwBall(camera, capsule, playerDirection, playerVelocity, clicked++);\n  }, [camera, capsule, clicked, playerDirection, playerVelocity, throwBall]);\n\n  useEffect(() => {\n    document.addEventListener('pointerdown', onPointerDown);\n    return () => {\n      document.removeEventListener('pointerdown', onPointerDown);\n    };\n  }, [onPointerDown]);\n\n  useEffect(() => {\n    //console.log('adding reference to this capsule collider')\n    colliders[ballCount] = { capsule: capsule, velocity: playerVelocity };\n  }, [colliders, ballCount, capsule, playerVelocity]);\n\n  const keyboard = useKeyboard();\n\n  /**\n   * 获取摄像机前方向量\n   */\n  const getForwardVector = useCallback<\n    (camera: Camera, playerDirection: Vector3) => Vector3\n  >((camera, playerDirection) => {\n    // 获取摄像机当前世界坐标下的前方向量,存储到playerDirection参数中\n    camera.getWorldDirection(playerDirection);\n    // 将前方向量的y分量(垂直方向)置0\n    playerDirection.y = 0;\n    // 标准化前方向量,使其长度为1\n    playerDirection.normalize();\n    return playerDirection;\n  }, []);\n\n  const getSideVector = useCallback<\n    (camera: Camera, playerDirection: Vector3) => Vector3\n  >(() => {\n    camera.getWorldDirection(playerDirection);\n    playerDirection.y = 0;\n    playerDirection.normalize();\n    // 得到在摄像机平面上左方向的单位向量\n    playerDirection.cross(camera.up);\n    return playerDirection;\n  }, [camera, playerDirection]);\n\n  const controls = useCallback<\n    (\n      camera: Camera,\n      delta: number,\n      playerVelocity: Vector3,\n      playerOnFloor: boolean,\n      playerDirection: Vector3\n    ) => void\n  >(\n    (camera, delta, playerVelocity, playerOnFloor, playerDirection) => {\n      // 定义速度增量,是否在地面上影响速度\n      const speedDelta = delta * (playerOnFloor ? 25 : 8);\n      // A键左移,获取右向量取反乘速度累加到速度上\n      keyboard['KeyA'] &&\n        playerVelocity.add(\n          getSideVector(camera, playerDirection).multiplyScalar(-speedDelta)\n        );\n      // D键右移,获取右向量乘速度累加到速度上\n      keyboard['KeyD'] &&\n        playerVelocity.add(\n          getSideVector(camera, playerDirection).multiplyScalar(speedDelta)\n        );\n      keyboard['KeyW'] &&\n        playerVelocity.add(\n          getForwardVector(camera, playerDirection).multiplyScalar(speedDelta)\n        );\n      keyboard['KeyS'] &&\n        playerVelocity.add(\n          getForwardVector(camera, playerDirection).multiplyScalar(-speedDelta)\n        );\n      if (playerOnFloor) {\n        // 如果在地面,空格跳跃使速度上升\n        if (keyboard['Space']) {\n          playerVelocity.y = 15;\n        }\n      }\n    },\n    [getForwardVector, getSideVector, keyboard]\n  );\n\n  const playerCollisions = useCallback<\n    (capsule: Capsule, octree: Octree, playerVelocity: Vector3) => boolean\n  >((capsule, octree, playerVelocity) => {\n    // 使用octree检测胶囊体是否与场景中的任何物体相交\n    const result = octree.capsuleIntersect(capsule);\n    let playerOnFloor = false;\n    if (result) {\n      // playerOnFloor标记是否在地面上\n      playerOnFloor = result.normal.y > 0;\n      if (!playerOnFloor) {\n        // 如果不在地面上,进行反弹运动学计算更新速度\n        playerVelocity.addScaledVector(\n          result.normal,\n          -result.normal.dot(playerVelocity)\n        );\n      }\n      // 将胶囊体移动result.depth个单位,抵消相交深度\n      capsule.translate(result.normal.multiplyScalar(result.depth));\n    }\n    // 返回是否在地面标记\n    return playerOnFloor;\n  }, []);\n\n  const updatePlayer = useCallback<\n    (\n      camera: Camera,\n      delta: number,\n      octree: Octree,\n      capsule: Capsule,\n      playerVelocity: Vector3,\n      playerOnFloor: boolean\n    ) => boolean\n  >(\n    (camera, delta, octree, capsule, playerVelocity, playerOnFloor) => {\n      // 计算速度衰减\n      let damping = Math.exp(-4 * delta) - 1;\n      if (!playerOnFloor) {\n        // 考虑重力影响更新速度y分量\n        playerVelocity.y -= GRAVITY * delta;\n        // 应用速度衰减更新速度\n        damping *= 0.1; // small air resistance\n      }\n      // 根据速度和时间增量计算位置增量\n      playerVelocity.addScaledVector(playerVelocity, damping);\n      const deltaPosition = playerVelocity.clone().multiplyScalar(delta);\n      // 更新胶囊体位置\n      capsule.translate(deltaPosition);\n      // 调用碰撞检测函数,更新是否在地面状态\n      playerOnFloor = playerCollisions(capsule, octree, playerVelocity);\n      // 更新摄像机位置跟随胶囊体\n      camera.position.copy(capsule.end);\n      return playerOnFloor;\n    },\n    [playerCollisions]\n  );\n\n  const teleportPlayerIfOob = useCallback<\n    (camera: Camera, capsule: Capsule, playerVelocity: Vector3) => void\n  >((camera, capsule, playerVelocity) => {\n    // 检测摄像机位置y坐标是否小于-100,即掉出地图下限\n    if (camera.position.y <= -100) {\n      // 清零速度\n      playerVelocity.set(0, 0, 0);\n      // 将胶囊体重置到起始位置\n      capsule.start.set(0, 10, 0);\n      capsule.end.set(0, 11, 0);\n      // 将摄像机位置和旋转重置\n      camera.position.copy(capsule.end);\n      camera.rotation.set(0, 0, 0);\n    }\n  }, []);\n\n  useFrame(({ camera }, delta) => {\n    controls(\n      camera,\n      delta,\n      playerVelocity,\n      playerOnFloor.current,\n      playerDirection\n    );\n    const deltaSteps = Math.min(0.05, delta) / STEPS_PER_FRAME;\n    for (let i = 0; i < STEPS_PER_FRAME; i++) {\n      playerOnFloor.current = updatePlayer(\n        camera,\n        deltaSteps,\n        octree,\n        capsule,\n        playerVelocity,\n        playerOnFloor.current\n      );\n    }\n    teleportPlayerIfOob(camera, capsule, playerVelocity);\n  });\n\n  return null;\n};\n","import { useGLTF } from '@react-three/drei';\nimport { useCallback, useRef } from 'react';\nimport { GLTFResult } from '~/types/use_gltf';\nimport { useOctree } from './use_octree';\nimport { useOctreeHelper } from './use_octree_helper';\nimport * as Constants from './Constants';\nimport { SphereCollider } from './SphereCollider';\nimport { Ball } from './Ball';\nimport { Sphere, Vector3 } from 'three';\nimport { Capsule } from 'three/examples/jsm/math/Capsule';\nimport { Player } from './Player';\n\nexport type Collider = {\n  sphere?: Sphere;\n  velocity: Vector3;\n  capsule?: Capsule;\n};\n\nexport const Physics = () => {\n  const { nodes, scene } = useGLTF(\n    'models/scene-transformed.glb'\n  ) as GLTFResult;\n  const octree = useOctree(scene);\n  useOctreeHelper(octree);\n\n  const colliders = useRef<Collider[]>([]);\n\n  const checkSphereCollisions = useCallback<\n    (sphere: Sphere, velocity: Vector3) => void\n  >((sphere, velocity) => {\n    for (let i = 0, length = colliders.current.length; i < length; i++) {\n      const c = colliders.current[i];\n      // 监测是否发生碰撞\n      if (c.sphere) {\n        // 计算两个球体中心点距离的平方d2\n        const d2 = sphere.center.distanceToSquared(c.sphere.center);\n        const r = sphere.radius + c.sphere.radius;\n        // 计算两个球体半径之和的平方r2\n        const r2 = r * r;\n        // 判断d2是否小于r2,如果是则表示发生碰撞\n        if (d2 < r2) {\n          // 计算单位法向量normal\n          const normal = Constants.v1\n            .subVectors(sphere.center, c.sphere.center)\n            .normalize();\n          // 计算两个物体在normal方向上的相对速度分量impact1和impact2\n          const impact1 = Constants.v2\n            .copy(normal)\n            .multiplyScalar(normal.dot(velocity));\n          const impact2 = Constants.v3\n            .copy(normal)\n            .multiplyScalar(normal.dot(c.velocity));\n          // 根据impact对两个物体的速度velocity和c.velocity进行调整,实现碰撞后反弹\n          velocity.add(impact2).sub(impact1);\n          c.velocity.add(impact1).sub(impact2);\n          // 计算两个球体中心点需要移动的距离d\n          const d = (r - Math.sqrt(d2)) / 2;\n          // 根据法向量normal对两个球体中心点进行位置调整\n          sphere.center.addScaledVector(normal, d);\n          c.sphere.center.addScaledVector(normal, -d);\n        }\n      } else if (c.capsule) {\n        // 计算胶囊体的中心点center\n        const center = Constants.v1\n          .addVectors(c.capsule.start, c.capsule.end)\n          .multiplyScalar(0.5);\n        // 计算球体和胶囊体半径之和r\n        const r = sphere.radius + c.capsule.radius;\n        const r2 = r * r;\n        // 对胶囊体的两个端点和中心点进行循环\n        for (const point of [c.capsule.start, c.capsule.end, center]) {\n          // 对每个点计算与球体中心的距离平方d2\n          const d2 = point.distanceToSquared(sphere.center);\n          // 判断d2是否小于r2,如果是则发生碰撞\n          if (d2 < r2) {\n            const normal = Constants.v1\n              .subVectors(point, sphere.center)\n              .normalize();\n            // 计算单位法向量normal和速度分量impact\n            const impact1 = Constants.v2\n              .copy(normal)\n              .multiplyScalar(normal.dot(c.velocity));\n            const impact2 = Constants.v3\n              .copy(normal)\n              .multiplyScalar(normal.dot(velocity));\n            // 根据impact调整球体和胶囊体的速度velocity和c.velocity\n            c.velocity.add(impact2).sub(impact1);\n            velocity.add(impact1).sub(impact2);\n            // 计算球体中心需要移动的距离d\n            const d = (r - Math.sqrt(d2)) / 2;\n            // 根据normal移动球体中心\n            sphere.center.addScaledVector(normal, -d);\n          }\n        }\n      }\n    }\n  }, []);\n\n  return (\n    <>\n      <group dispose={null}>\n        <mesh\n          castShadow\n          receiveShadow\n          geometry={nodes.Suzanne007.geometry}\n          material={nodes.Suzanne007.material}\n          position={[1.74, 1.04, 24.97]}\n        />\n      </group>\n      {Constants.balls.map(({ position }, i) => (\n        <SphereCollider\n          key={i}\n          id={i}\n          radius={Constants.radius}\n          octree={octree}\n          position={position}\n          colliders={colliders.current}\n          checkSphereCollisions={checkSphereCollisions}\n        >\n          <Ball radius={Constants.radius} />\n        </SphereCollider>\n      ))}\n      <Player\n        ballCount={Constants.ballCount}\n        octree={octree}\n        colliders={colliders.current}\n      />\n    </>\n  );\n};\n","import { PointerLockControls, Environment, Stats } from '@react-three/drei';\nimport { Canvas } from '@react-three/fiber';\nimport { Overlay } from './Overlay';\nimport { Physics } from './Physics';\n\n/**\n * FPS 八叉树\n */\nconst Demo2v07 = () => {\n  return (\n    <>\n      <Canvas shadows>\n        <directionalLight\n          intensity={1}\n          castShadow={true}\n          shadow-bias={-0.00015}\n          shadow-radius={4}\n          shadow-blur={10}\n          shadow-mapSize={[2048, 2048]}\n          position={[85.0, 80.0, 70.0]}\n          shadow-camera-left={-30}\n          shadow-camera-right={30}\n          shadow-camera-top={30}\n          shadow-camera-bottom={-30}\n        />\n        <Environment\n          // files=\"https://cdn.jsdelivr.net/gh/Sean-Bradley/React-Three-Fiber-Boilerplate@octree/public/img/rustig_koppie_puresky_1k.hdr\"\n          files=\"/imgs/rustig_koppie_puresky_1k.hdr\"\n          background\n        />\n        <Physics />\n        <PointerLockControls />\n        <Stats />\n      </Canvas>\n      <Overlay />\n    </>\n  );\n};\n\nexport default Demo2v07;\n"],"names":["Overlay","jsxs","jsx","useOctree","scene","useMemo","Octree","useOctreeHelper","octree","useThree","useEffect","helper","OctreeHelper","useControls","v","Gravity","ballCount","radius","balls","v1","Vector3","v2","v3","frameSteps","SphereCollider","id","position","colliders","checkSphereCollisions","children","ref","useRef","sphere","Sphere","velocity","updateSphere","useCallback","delta","result","factor","Constants.Gravity","damping","useFrame","_","deltaSteps","Constants.frameSteps","i","Ball","useKeyboard","keyMap","onDocumentKey","e","GRAVITY","STEPS_PER_FRAME","Player","playerOnFloor","playerVelocity","playerDirection","capsule","Capsule","camera","clicked","throwBall","count","onPointerDown","keyboard","getForwardVector","getSideVector","controls","speedDelta","playerCollisions","updatePlayer","deltaPosition","teleportPlayerIfOob","Physics","nodes","useGLTF","length","c","d2","r","r2","normal","Constants.v1","impact1","Constants.v2","impact2","Constants.v3","d","center","point","Fragment","Constants.balls","Constants.radius","Constants.ballCount","Demo2v07","Canvas","Environment","PointerLockControls","Stats"],"mappings":"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"}